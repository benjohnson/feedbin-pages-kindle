[
  {
    "id": 2219344777,
    "feed_id": 1658782,
    "title": "Comparing Database Types: How Database Types Evolved to Meet Different Needs | Prisma",
    "author": null,
    "summary": "Database types, sometimes referred to as database models or database families, are the patterns and structures used to organize data within a database management system. Many different database types have been developed over the years. Some are mainly",
    "content": "<div>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Database types</strong>, sometimes referred to as database models or database families, are the patterns and structures used to organize data within a database management system. Many different database types have been developed over the years. Some are mainly historic predecessors to current databases, while others have stood the test of time. In the last few decades, new types have been developed to address changing requirements and different use patterns.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Your choice of database type can have a profound impact on what kind of operations your application can easily perform, how you conceptualize your data, and the features that your database management system offers you during development and runtime. In this guide, we'll take a look at how database types have evolved over time and what advantages and trade-offs are present in each design.</p>\n<h3 class=\"styles__H3-fvdpr4-10 fdlJWJ\" id=\"legacy-databases-paving-the-way-for-modern-systems\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#legacy-databases-paving-the-way-for-modern-systems\"><svg height=\"16\" width=\"16\"><path></path></svg></a>Legacy databases: paving the way for modern systems</h3>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Legacy database types represent milestones on the path to modern databases. These may still find a foothold in certain specialized environments, but have mostly been replaced by more robust alternatives for production environments.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">This section is dedicated to historic database types that aren't used much in modern development. You can <a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#relational-databases-working-with-tables-as-a-standard-solution-to-organize-well-structured-data\">skip ahead to the section on relational databases</a> if you aren't interested in that background.</p>\n<h4 class=\"styles__H4-fvdpr4-9 hpabDE\" id=\"flat-file-databases-simple-data-structures-for-organizing-small-amounts-of-local-data\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#flat-file-databases-simple-data-structures-for-organizing-small-amounts-of-local-data\"><svg height=\"16\" width=\"16\"><path></path></svg></a>Flat-file databases: simple data structures for organizing small amounts of local data</h4>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">The simplest way to manage data on a computer outside of an application is to store it in a basic file format. The first solutions for data management used this approach and it is still a popular option for storing small amounts of information without heavy requirements.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">The first flat file databases represented information in regular, machine parse-able structures within files. Data is stored in plain text, which limits the type of content that can be represented within the database itself. Sometimes, a special character or other indicator is chosen to use as a <em>delimiter</em>, or marker for when one field ends and the next begins. For example, a comma is used in CSV (comma-separated values) files, while colons or white-space are used in many data files in <a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://en.wikipedia.org/wiki/Unix-like\">Unix-like</a> systems. Other times, no delimiter is used and instead, fields are defined with a fixed length which can be padded for shorter values.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\"><code class=\"styles__InlineCode-fvdpr4-14 kPyZAF\">/etc/passwd</code> on *nix systems:</strong></p>\n<pre class=\"styles__Pre-fvdpr4-13 gqUzOk\"><code>root<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">:</span>root<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>root<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>bash\ndaemon<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span><span class=\"token number\">1</span><span class=\"token punctuation\">:</span>daemon<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nbin<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span><span class=\"token number\">2</span><span class=\"token punctuation\">:</span>bin<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>bin<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nsys<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span><span class=\"token number\">3</span><span class=\"token punctuation\">:</span>sys<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>dev<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nsync<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">4</span><span class=\"token punctuation\">:</span><span class=\"token number\">65534</span><span class=\"token punctuation\">:</span>sync<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>bin<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>sync\ngames<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">5</span><span class=\"token punctuation\">:</span><span class=\"token number\">60</span><span class=\"token punctuation\">:</span>games<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>games<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nman<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">6</span><span class=\"token punctuation\">:</span><span class=\"token number\">12</span><span class=\"token punctuation\">:</span>man<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>cache<span class=\"token operator\">/</span>man<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nlp<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">7</span><span class=\"token punctuation\">:</span><span class=\"token number\">7</span><span class=\"token punctuation\">:</span>lp<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>spool<span class=\"token operator\">/</span>lpd<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nmail<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">:</span><span class=\"token number\">8</span><span class=\"token punctuation\">:</span>mail<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>mail<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nnews<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">9</span><span class=\"token punctuation\">:</span><span class=\"token number\">9</span><span class=\"token punctuation\">:</span>news<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>spool<span class=\"token operator\">/</span>news<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nbackup<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">34</span><span class=\"token punctuation\">:</span><span class=\"token number\">34</span><span class=\"token punctuation\">:</span>backup<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>backups<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nlist<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">38</span><span class=\"token punctuation\">:</span><span class=\"token number\">38</span><span class=\"token punctuation\">:</span>Mailing List Manager<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span><span class=\"token keyword\">var</span><span class=\"token operator\">/</span>list<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nnobody<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">65534</span><span class=\"token punctuation\">:</span><span class=\"token number\">65534</span><span class=\"token punctuation\">:</span>nobody<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>nonexistent<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nsyslog<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">102</span><span class=\"token punctuation\">:</span><span class=\"token number\">106</span><span class=\"token punctuation\">:</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>syslog<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>usr<span class=\"token operator\">/</span>sbin<span class=\"token operator\">/</span>nologin\nbob<span class=\"token punctuation\">:</span>x<span class=\"token punctuation\">:</span><span class=\"token number\">1000</span><span class=\"token punctuation\">:</span><span class=\"token number\">1000</span><span class=\"token punctuation\">:</span>Bob Smith<span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>home<span class=\"token operator\">/</span>bob<span class=\"token punctuation\">:</span><span class=\"token operator\">/</span>bin<span class=\"token operator\">/</span>bash\n</code></pre>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><em>The <code class=\"styles__InlineCode-fvdpr4-14 kPyZAF\">/etc/passwd</code> file defines users, one per line. Each user has attributes like name, user and group IDs, home directory and default shell, each separated by a colon.</em></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">While flat file databases are simple, they are very limited in the level of complexity they can handle. The system that reads or manipulates the data cannot make easy connections between the data represented. File-based systems usually don't have any type of user or data concurrency features either. Flat file databases are usually only practical for systems with small read or write requirements. For example, many operating systems use flat-files to store configuration data.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">In spite of these limitations, flat-file databases are still widely used for scenarios where local processes need to store and organized small amounts of data. A good example of this is for configuration data for many applications on Linux and other Unix-like systems. In these cases, the flat-file format serves as an interface that both humans and applications can easily read and manage. Some advantages of this format are that it has robust, flexible tooling, is easily managed without specialized software, and is easy to understand and work with.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Examples:</p>\n<ul class=\"styles__Ul-fvdpr4-2 fpttBk\">\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\">\n<a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://en.wikipedia.org/wiki/Passwd#Password_file\"><code class=\"styles__InlineCode-fvdpr4-14 kPyZAF\">/etc/passwd</code></a> and <a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://en.wikipedia.org/wiki/Fstab\"><code class=\"styles__InlineCode-fvdpr4-14 kPyZAF\">/etc/fstab</code></a> on Linux and Unix-like systems</li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\">\n<a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://en.wikipedia.org/wiki/Comma-separated_values\">CSV</a> files</li>\n</ul>\n<h4 class=\"styles__H4-fvdpr4-9 hpabDE\" id=\"hierarchical-databases-using-parent-child-relationships-to-map-data-into-trees\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#hierarchical-databases-using-parent-child-relationships-to-map-data-into-trees\"><svg height=\"16\" width=\"16\"><path></path></svg></a>Hierarchical databases: using parent-child relationships to map data into trees</h4>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Initial introduction: 1960s</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Hierarchical databases were the next evolution in database management development. They encode a relationship between items where every record has a single parent. This builds a tree-like structure that can be used to categorize records according to their parent record.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><span class=\"Image__Wrapper-sc-152tu6s-0 iUrdCz\"><img class=\"Image-sc-152tu6s-1 cmQiWS\" src=\"https://d33wubrfki0l68.cloudfront.net/b55ec5eec5909adebf94917694dc264513b678ab/81681/blog/posts/database-type-comparison/hierarchical.png\" alt=\"Diagram of a hierarchical database\"><span class=\"Image__Title-sc-152tu6s-2 uHBje\">Diagram of a hierarchical database</span></span></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">This simple relationship mapping provides users with the ability to establish relationships between items in a tree structure. This is very useful for certain types of data, but does not allow for complex relationship management. Furthermore, the meaning of the parent-child relationship is implicit. One parent-child connection could be between a customer and their orders, while another might represent an employee and the equipment they have been allocated. The structure of the data itself does not distinguish between these relationships.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Hierarchical databases are the beginning of a movement towards thinking about data management in more complex terms. The trajectory of database management systems that were developed afterwards continues this trend.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Hierarchical databases are not used much today due to their limited ability to organize most data and because of the overhead of accessing data by traversing the hierarchy. However, a few incredibly important systems could be considered hierarchical databases. A filesystem, for instance, can be thought of as a specialized hierarchical database, as the system of files and directories fit neatly into the single-parent / multiple-child paradigm. Likewise, DNS and LDAP systems both act as databases for hierarchical datasets.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Examples:</p>\n<ul class=\"styles__Ul-fvdpr4-2 fpttBk\">\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://en.wikipedia.org/wiki/File_system\">Filesystems</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://en.wikipedia.org/wiki/Domain_Name_System\">DNS</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://en.wikipedia.org/wiki/Lightweight_Directory_Access_Protocol\">LDAP directories</a></li>\n</ul>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Initial introduction: late 1960s</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Network databases built on the foundation provided by hierarchical databases by adding additional flexibility. Instead of always having a single parent, as in hierarchical databases, network database entries can have more than one parent, which effectively allows them to model more complex relationships. When talking about network databases, it is important to realize that <em>network</em> is being used to refer to connections between different data entries, not connections between different computers or software.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><span class=\"Image__Wrapper-sc-152tu6s-0 iUrdCz\"><img class=\"Image-sc-152tu6s-1 cmQiWS\" src=\"https://d33wubrfki0l68.cloudfront.net/aa729517f8d420f8d36d1f984dea57b80343be07/748ae/blog/posts/database-type-comparison/network.png\" alt=\"Diagram of a network database\"><span class=\"Image__Title-sc-152tu6s-2 uHBje\">Diagram of a network database</span></span></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Network databases can be represented by a generic <em>graph</em> instead of a <em>tree</em>. The meaning of the graph was defined by a <strong class=\"styles__Strong-fvdpr4-15 eHeecn\">schema</strong>, which lays out what each data node and each relationship represents. This gave structure to the data in a way that could previously only be reached through inference.</p>\n<blockquote class=\"styles__Blockquote-fvdpr4-6 dEZflj\">\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Definition: Schema</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">A database schema is a description of the logical structure of a database or the elements it contains. Schemas often include declarations for the structure of individual entries, groups of entries, and the individual attributes that database entries are comprised of. These may also define data types and additional constraints to control the type of data that may be added to the structure.</p>\n</blockquote>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Network databases were a huge leap forward in terms of flexibility and the ability to map connections between information. However, they were still limited by the same access patterns and design mindset of hierarchical databases. For instance, to access data, you still needed to follow the network paths to the record in question. The parent-child relationship carried over from hierarchical databases also affected the way that items could connect to one another.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">It is difficult to find modern examples of network database systems. Setting up and working with network databases required a good deal of skill and specialized domain knowledge. Most systems that could be approximated using network databases found a better fit once relational databases appeared.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Examples:</p>\n<h3 class=\"styles__H3-fvdpr4-10 fdlJWJ\" id=\"relational-databases-working-with-tables-as-a-standard-solution-to-organize-well-structured-data\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#relational-databases-working-with-tables-as-a-standard-solution-to-organize-well-structured-data\"><svg height=\"16\" width=\"16\"><path></path></svg></a>Relational databases: working with tables as a standard solution to organize well-structured data</h3>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Initial introduction: 1969</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Relational databases are the oldest general purpose database type still widely used today. In fact, <a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://db-engines.com/en/ranking_categories\">relational databases comprise the majority of databases currently used in production</a>.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Relational databases organize data using <em>tables</em>. Tables are structures that impose a schema on the records that they hold. Each column within a table has a <em>name</em> and a <em>data type</em>. Each row represents an individual record or data item within the table, which contains values for each of the columns. Relational databases get their name from mathematical relationships that use tuples (like the rows in a table) to represent ordered sets of data.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><span class=\"Image__Wrapper-sc-152tu6s-0 iUrdCz\"><img class=\"Image-sc-152tu6s-1 cmQiWS\" src=\"https://d33wubrfki0l68.cloudfront.net/ecc7aa3cce3fc59da9a7fc71a27186f7093fa445/07559/blog/posts/database-type-comparison/relational.png\" alt=\"Diagram of relational schema used to map entities for a school\"><span class=\"Image__Title-sc-152tu6s-2 uHBje\">Diagram of relational schema used to map entities for a school</span></span></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Special fields in tables, called <em>foreign keys</em>, can contain references to columns in other tables. This allows the database to bridge the two tables on demand to bring different types of data together.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">The highly organized structure imparted by the rigid table structure, combined with the flexibility offered by the relations between tables makes relational databases very powerful and adaptable to many types of data. Conformity can be enforced at the table level, but database operations can combine and manipulate that data in novel ways.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">While not inherent to the design of relational databases, a querying language called SQL, or structured query language, was created to access and manipulate data stored with that format. It can query and join data from multiple tables within a single statement. SQL can also filter, aggregate, summarize, and limit the data that it returns. So while SQL is not a part of the relational system, it is often a fundamental part of working with these databases.</p>\n<blockquote class=\"styles__Blockquote-fvdpr4-6 dEZflj\">\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Definition: SQL</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">SQL, or structured querying language, is a language family used to query and manipulate data within relational databases. It excels at combining data from multiple tables and filtering based on constraints which allow it to be used to express complex queries. Variants of the language has been adopted by almost all relational databases due to its flexibility, power, and ubiquity.</p>\n</blockquote>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">In general, relational databases are often a good fit for any data that is regular, predictable, and benefits from the ability to flexibly compose information in various formats. Because relational databases work off of a schema, it can be more challenging to alter the structure of data after it is in the system. However, the schema also helps enforce the integrity of the data, making sure values match the expected formats, and that required information is included. Overall, relational databases are a solid choice for many applications because applications often generate well-ordered, structured data.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Examples:</p>\n<ul class=\"styles__Ul-fvdpr4-2 fpttBk\">\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://www.mysql.com\">MySQL</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://mariadb.org\">MariaDB</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://www.postgresql.org\">PostgreSQL</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://www.sqlite.org/index.html\">SQLite</a></li>\n</ul>\n<h3 class=\"styles__H3-fvdpr4-10 fdlJWJ\" id=\"nosql-databases-modern-alternatives-for-data-that-doesnt-fit-the-relational-paradigm\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#nosql-databases-modern-alternatives-for-data-that-doesnt-fit-the-relational-paradigm\"><svg height=\"16\" width=\"16\"><path></path></svg></a>NoSQL databases: modern alternatives for data that doesn't fit the relational paradigm</h3>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">NoSQL is a term for a varied collection of modern database types that offer approaches that differ from the standard relational pattern. The term NoSQL is somewhat of a misnomer since the databases within this category are more of a reaction against the relational archetype rather than the SQL querying language. NoSQL is said to stand for either \"non-SQL\" or \"not only SQL\" to sometimes clarify that they sometimes allow for SQL-like querying.</p>\n<h4 class=\"styles__H4-fvdpr4-9 hpabDE\" id=\"key-value-databases-simple-dictionary-style-lookups-for-basic-storage-and-retrieval\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#key-value-databases-simple-dictionary-style-lookups-for-basic-storage-and-retrieval\"><svg height=\"16\" width=\"16\"><path></path></svg></a>Key-value databases: simple, dictionary-style lookups for basic storage and retrieval</h4>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Initial introduction: 1970s | Rise in popularity: 2000-2010</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Key-value databases, or key-value stores, are one of the simplest database types. Key-value stores work by storing arbitrary data accessible through a specific <em>key</em>. To store data, you provide a key and the blob of data you wish to save, for example a JSON object, an image, or plain text. To retrieve data, you provide the key and will then be given the blob of data back. The database does not evaluate the data it is storing and allows limited ways of interacting with it.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><span class=\"Image__Wrapper-sc-152tu6s-0 iUrdCz\"><img class=\"Image-sc-152tu6s-1 cmQiWS\" src=\"https://d33wubrfki0l68.cloudfront.net/0aee61f5bb32b11ff51d6aedb636645c35e70b9d/7f22a/blog/posts/database-type-comparison/key-value.png\" alt=\"Diagram of key-value data store\"><span class=\"Image__Title-sc-152tu6s-2 uHBje\">Diagram of key-value data store</span></span></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">If key-value stores appear simple, it's because they are. But that simplicity is often an asset in the kinds of scenarios where they are most often deployed. Key-value stores are often used to store configuration data, state information, and any data that might be represented by a <em>dictionary</em> or <em>hash</em> in a programming language. Key-value stores provide fast, low-complexity access to this type of data.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Key-value databases don't prescribe any schema for the data they store, and as such, are often used to store many different types of data at the same time. The user is responsible for defining any naming scheme for the keys that will help identify the values and are responsible for ensuring the value is of the appropriate type and format. Key-value storage is most useful as a lightweight solution for storing simple values that can be operated on externally after retrieval.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">One of the most popular uses for key-value databases are to store configuration values and application variables and flags for websites and web applications. Programs can check the key-value store, which is usually very fast, for their configuration when they start. This allows you to alter the runtime behavior of your services by changing the data in the key-value store. Applications can also be configured to recheck periodically or to restart when they see changes. These configuration stores are often persisted to disk periodically to prevent loss of data in the event of a system crash.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Examples:</p>\n<h4 class=\"styles__H4-fvdpr4-9 hpabDE\" id=\"document-databases-storing-all-of-an-items-data-in-flexible-self-describing-structures\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#document-databases-storing-all-of-an-items-data-in-flexible-self-describing-structures\"><svg height=\"16\" width=\"16\"><path></path></svg></a>Document databases: Storing all of an item's data in flexible, self-describing structures</h4>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Rise in popularity: 2009</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Document databases, also known as document-oriented databases or document stores, share the basic access and retrieval semantics of key-value stores. Document databases also use a key to uniquely identify data within the database. In fact, the line between advanced key-value stores and document databases can be fairly unclear. However, instead of storing arbitrary blobs of data, document databases store data in structured formats called documents, often using formats like JSON, BSON, or XML.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><span class=\"Image__Wrapper-sc-152tu6s-0 iUrdCz\"><img class=\"Image-sc-152tu6s-1 cmQiWS\" src=\"https://d33wubrfki0l68.cloudfront.net/8d2bd5dcb7f55efcb3d59103706be7459f3664df/a7fc4/blog/posts/database-type-comparison/document.png\" alt=\"Diagram of document database\"><span class=\"Image__Title-sc-152tu6s-2 uHBje\">Diagram of document database</span></span></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Though the data within documents is organized within a structure, document databases do not prescribe any specific format or schema. Each document can have a different internal structure that the database interprets. So, unlike with key-value stores, the content stored in document databases can be queried and analyzed.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">In some ways, document databases sit in between relational databases and key-value stores. They use the simple key-value semantics and loose requirements on data that key-value stores are known for, but they also provide the ability to impose a structure that you can use to query and operate on the data in the future.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">The comparison with relational databases shouldn't be overstated, however. While document databases provide methods of structuring data within documents and operating on datasets based on those structures, the guarantees, relationships, and operations available are very different from relational databases.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Document databases are a good choice for rapid development because you can change the properties of the data you want to save at any point without altering existing structures or data. You only need to backfill records if you want to. Each document within the database stands on its own with its own system of organization. If you're still figuring out your data structure and your data is mainly composed discrete entries that don't include a lot of cross references, a document database might be a good place to start. Be careful, however, as the extra flexibility means that you are responsible for maintaining the consistency and structure of your data, which can be extremely challenging.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Examples:</p>\n<ul class=\"styles__Ul-fvdpr4-2 fpttBk\">\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://www.mongodb.com\">MongoDB</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://rethinkdb.com\">RethinkDB</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://www.couchbase.com\">Couchbase</a></li>\n</ul>\n<h4 class=\"styles__H4-fvdpr4-9 hpabDE\" id=\"graph-databases-mapping-relationships-by-focusing-on-how-connections-between-data-are-meaningful\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#graph-databases-mapping-relationships-by-focusing-on-how-connections-between-data-are-meaningful\"><svg height=\"16\" width=\"16\"><path></path></svg></a>Graph databases: mapping relationships by focusing on how connections between data are meaningful</h4>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Rise in popularity: 2000s</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Graph databases are a type of NoSQL database that takes a different approach to establishing relationships between data. Rather than mapping relationships with tables and foreign keys, graph databases establish connections using the concepts of <em>nodes</em>, <em>edges</em>, and <em>properties</em>.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><span class=\"Image__Wrapper-sc-152tu6s-0 iUrdCz\"><img class=\"Image-sc-152tu6s-1 cmQiWS\" src=\"https://d33wubrfki0l68.cloudfront.net/58c2b57b422a61234950932a5cb5f3ac9103913c/d0c9a/blog/posts/database-type-comparison/graph.png\" alt=\"Diagram of a graph database structure\"><span class=\"Image__Title-sc-152tu6s-2 uHBje\">Diagram of a graph database structure</span></span></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Graph databases represents data as individual nodes which can have any number of properties associated with them. Between these nodes, edges (also called relationships) are established to represent different types of connections. In this way, the database encodes information about the data items within the nodes and information about their relationship in the edges that connect the nodes.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">At a glance, graph databases appear similar to earlier network databases. Both types focus on the connections between items and allow for explicit mapping of relationships between different types of data. However, network databases require step-by-step traversal to travel between items and are limited in the types of relationships they can represent.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Graph databases are most useful when working with data where the relationships or connections are highly important. It is essential to understand that when talking about relational databases, the word \"relational\" refers to the ability to tie information in different tables together. On the other hand, with graph databases, the primary purpose is defining and managing relationships themselves.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">For example, querying for the connection between two users of a social media site in a relational database is likely to require multiple table joins and therefore be rather resource intensive. This same query would be straightforward in a graph database that directly maps connections. The focus of graph databases is to make working this type of data intuitive and powerful.</p>\n<h4 class=\"styles__H4-fvdpr4-9 hpabDE\" id=\"column-family-databases-databases-with-flexible-columns-to-bridge-the-gap-between-relational-and-document-databases\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#column-family-databases-databases-with-flexible-columns-to-bridge-the-gap-between-relational-and-document-databases\"><svg height=\"16\" width=\"16\"><path></path></svg></a>Column-family databases: databases with flexible columns to bridge the gap between relational and document databases</h4>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Rise in popularity: 2000s</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Column-family databases, also called non-relational column stores, wide-column databases, or simply column databases, are perhaps the NoSQL type that, on the surface, looks most similar to relational databases. Like relational databases, wide-column databases store data using concepts like rows and columns. However, in wide-column databases, the association between these elements is very different from how relational databases use them.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">In relational databases, a schema defines the column layout in a table by specifying what columns the table will have, their respective data types, and other criteria. All of the rows in a table must conform to this fixed schema.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Instead of tables, column-family databases have structures called <em>column families</em>. Column families contain rows of data, each of which define their own format. A row is composed of a unique row identifier — used to locate the row — followed by sets of column names and values.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">With this design, each row in a column family defines its own schema. That schema can be easily modified because it only affects that single row of data. Each row can have different numbers of columns with different types of data. Sometimes it helps to think of column family databases as key-value databases where each key (row identifier) returns a dictionary of arbitrary attributes and their values (the column names and their values).</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><span class=\"Image__Wrapper-sc-152tu6s-0 iUrdCz\"><img class=\"Image-sc-152tu6s-1 cmQiWS\" src=\"https://d33wubrfki0l68.cloudfront.net/af4de7c5814d0c3ebdf9b6b29fe7645a79799214/795c4/blog/posts/database-type-comparison/column.png\" alt=\"Diagram of column-family database structure\"><span class=\"Image__Title-sc-152tu6s-2 uHBje\">Diagram of column-family database structure</span></span></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Column-family databases are good when working with applications that requires great performance for row-based operations and highly scalability. Since all of the data and metadata for an entry is accessible with a single row identifier, no computationally expensive joins are required to find and pull the information. The database system also typically makes sure all of the data in a row is collocated on the same machine in a cluster, simplifying data sharding and scaling.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">However, column-family databases do not work well in all scenarios. If you have highly relational data that requires joins, this is not the right type of database for your application. Column-family databases are firmly oriented around row-based operations. This means that aggregate queries like summing, averaging, and other analytics-oriented processes can be difficult or impossible. This can have a great impact on how you design your applications and what types of usage patterns you can use.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Examples:</p>\n<h3 class=\"styles__H3-fvdpr4-10 fdlJWJ\" id=\"newsql-databases-bringing-modern-scalability-and-performance-to-the-traditional-relational-pattern\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#newsql-databases-bringing-modern-scalability-and-performance-to-the-traditional-relational-pattern\"><svg height=\"16\" width=\"16\"><path></path></svg></a>NewSQL databases: bringing modern scalability and performance to the traditional relational pattern</h3>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Rise in popularity: 2010s</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">NoSQL databases are great options for situations where your data does not fit neatly into the relational pattern. Since they were developed more recently, NoSQL systems tend to be designed with scalability and modern performance requirements in mind.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">However, until recently, no solution existed to easily <em>scale</em> relational data. To address this need, a new type of relational databases called NewSQL databases were developed.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">NewSQL databases follow the relational structure and semantics, but are built using more modern, scalable designs. The goal is to offer greater scalability than relational databases and greater <em>consistency guarantees</em> than NoSQL alternatives. They achieve this by sacrificing certain amounts of availability in the event of a networking partition. The trade offs between consistency and availability is a fundamental problem of distributed databases described by the <em>CAP theorem</em>.</p>\n<blockquote class=\"styles__Blockquote-fvdpr4-6 dEZflj\">\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\"><strong class=\"styles__Strong-fvdpr4-15 eHeecn\">Definition: CAP Theorem</strong></p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">The CAP theorem is a statement about the trade offs that distributed databases must make between availability and consistency. It asserts that in the event of a network partition, a distributed database can choose either to remain available or remain consistent, but it cannot do both. Cluster members in a partitioned network can continue operating, leading to at least temporary inconsistency. Alternatively, at least some of the disconnected members must refuse to alter their data during the partition to ensure data consistency.</p>\n</blockquote>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">To address the availability concern, new architectures were developed to minimize the impact of partitions. For instance, splitting data sets into smaller ranges called <em>shards</em> can minimize the amount of data that is unavailable during partitions. Furthermore, mechanisms to automatically alter the roles of various cluster members based on network conditions allow them to regain availability quickly.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Because of these qualities, NewSQL databases are best suited for use cases with high volumes of relational data in distributed, cloud-like environments.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">While NewSQL databases offer most of the familiar features of conventional relational databases, there are some important differences that prevent it from being a one-to-one replacement. NewSQL systems are typically less flexible and generalized than their more conventional relational counterparts. They also usually only offer a subset of full SQL and relational features, which means that they might not be able to handle certain kinds of usage. Many NewSQL implementations also store a large part of or their entire dataset in the computer's main memory. This improves performance at the cost of greater risk to unpersisted changes.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">NewSQL databases are a good fit for relational datasets that require scaling beyond what conventional relational databases can offer. Because they implement the relational abstraction and provide SQL interfaces, transitioning to a NewSQL database is often more straightforward than moving to a NoSQL alternative. However, it's important to keep in mind that although they mostly seek to replicate the conventional relational environments, there are differences that may affect your deployments. Be sure to research these differences and identify situations where the resemblance breaks down.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Examples:</p>\n<ul class=\"styles__Ul-fvdpr4-2 fpttBk\">\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://www.memsql.com\">MemSQL</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://www.voltdb.com\">VoltDB</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://en.wikipedia.org/wiki/Spanner_(database)\">Spanner</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://blog.acolyer.org/2019/03/29/calvin-fast-distributed-transactions-for-partitioned-database-systems/\">Calvin</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://www.cockroachlabs.com\">CockroachDB</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://fauna.com\">FaunaDB</a></li>\n<li class=\"styles__Li-fvdpr4-4 lcXSUH\"><a class=\"styles__A-fvdpr4-7 hLlHFt\" href=\"https://www.yugabyte.com\">yugabyteDB</a></li>\n</ul>\n<h3 class=\"styles__H3-fvdpr4-10 fdlJWJ\" id=\"conclusion\">\n<a class=\"autolink-headers-anchor styles__A-fvdpr4-7 hLlHFt\" href=\"https://dbweekly.com/link/77728/81d0a6608a#conclusion\"><svg height=\"16\" width=\"16\"><path></path></svg></a>Conclusion</h3>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Database types have changed a lot since their initial introduction and new database ideas are actively being developed today. Each of the types used in modern systems have distinct advantages that are worth exploring given the right access patterns, data properties, and requirements. One of the first and most important decisions when starting a new project is evaluating your needs and finding the type that matches your project's demands.</p>\n<p class=\"styles__Paragraph-fvdpr4-5 hNKcsf\">Many times, using a mixture of different database types is the best approach for handling the data of your projects. Your applications and services will influence the type of data being generated as well as the features and access patterns you require. For example, user information for your system might fit best in a relational database, while the configuration values for your services might benefit from an in-memory key-value store. Learning what each type of database offers can help you recognize which systems are best for all of your different types of data.</p>\n</div>",
    "url": "https://dbweekly.com/link/77728/81d0a6608a",
    "published": "2019-09-28T14:14:41.448296Z",
    "created_at": "2019-09-28T14:14:41.451175Z",
    "original": null,
    "twitter_id": null,
    "twitter_thread_ids": [],
    "extracted_content_url": "https://extract.feedbin.com/parser/feedbin/8f337034e0ba17fd5ccdf77b483f78dba66a1a7d?base64_url=aHR0cHM6Ly9kYndlZWtseS5jb20vbGluay83NzcyOC84MWQwYTY2MDhh",
    "images": null,
    "enclosure": null,
    "extracted_articles": [],
    "json_feed": null
  },
  {
    "id": 2219289536,
    "feed_id": 1658782,
    "title": "Slack Is a Hell of Our Own Making",
    "author": null,
    "summary": "Photo: Gary S. Chapman/Getty Images On Tuesday evening, Vox Media announced that it had acquired New York Magazine and its associated brands. This includes Intelligencer, the website you are reading right now. In an all-hands meeting at New York ’s Canal",
    "content": "<div><div class=\"article-content inline\">\n      <div class=\"lede-image-wrapper inline horizontal\">\n          <picture> <source srcset=\"https://pixel.nymag.com/imgs/daily/intelligencer/2019/09/26/26-shredder.w700.h467.2x.jpg 2x\"> <source srcset=\"https://pixel.nymag.com/imgs/daily/intelligencer/2019/09/26/26-shredder.w700.h467.jpg\"> <source srcset=\"https://pixel.nymag.com/imgs/daily/intelligencer/2019/09/26/26-shredder.w700.h467.2x.jpg 2x\"> <source srcset=\"https://pixel.nymag.com/imgs/daily/intelligencer/2019/09/26/26-shredder.w700.h467.jpg\"> <source srcset=\"https://pixel.nymag.com/imgs/daily/intelligencer/2019/09/26/26-shredder.w700.h700.2x.jpg\"> <img src=\"https://pixel.nymag.com/imgs/daily/intelligencer/2019/09/26/26-shredder.w700.h700.jpg\" class=\"lede-image\" alt> </source></source></source></source></source></picture>\n            <div class=\"lede-image-data\">\n              <div class=\"attribution\">\n                <span class=\"credit\">Photo: Gary S. Chapman/Getty Images</span>\n              </div>\n            </div>\n      </div>\n          <p class=\"clay-paragraph\">On Tuesday evening, Vox Media announced that it had acquired <em>New York</em> Magazine and its associated brands. This includes Intelligencer, the website you are reading right now. In an all-hands meeting at <em>New York</em>’s Canal Street office at noon yesterday, Vox head honcho Jim Bankoff and New York Media CEO Pam Wasserstein addressed the tension floating throughout the company. There will not be any layoffs, they stressed. It’s, supposedly, business as usual. Still, uncertainty lingered in the air.</p>\n        \n          <p class=\"clay-paragraph\">Of the many known unknowns, a few centered around Slack, the workplace communication software popular in media circles. Anxiety regarding Slack yesterday was exacerbated by rumors and murmurs. In the afternoon, a similar all-hands meeting occurred at Vox’s headquarters in the Financial District, and a harrowing detail of the acquisition emerged. The gossip, as conveyed in a group chat of NYMag employees, was: “They told Vox we’re all gonna be on one Slack.” Absolutely devastating.</p>\n        \n          \n        \n          \n        \n          <p class=\"clay-paragraph\">Slack, if you are unfamiliar, is a chat-room service aimed at enterprise customers, a communication system that facilitates real-time communication without having to actually, you know, speak to anyone or write a complete email. It is particularly popular among start-ups, tech-savvy companies, and digital-media newsrooms. For companies with a lot of remote workers, Slack <em>is</em> the newsroom — the vast majority of meaningful interactions I’ve had with my editor for this piece, for instance, occurred on Slack.</p>\n        \n          \n        \n          <p class=\"clay-paragraph\">Slack serves many functions, large and small. You can be summoned to HR over Slack, you can share news or workshop ideas, or you can gossip and banter. There are public, official rooms for certain divisions, and private equivalents for select members. Low-ranking employees might have a channel separate from management. Maybe there’s a channel just for sharing pet pics, or one for alerting the office to leftovers and snacks that are up for grabs. BuzzFeed (in)famously had a Slack channel dedicated to freaking out about the musical <em>Hamilton</em>.</p>\n        \n          \n        \n          \n        \n          <p class=\"clay-paragraph\">You might often see transcripts of Slack conversations posted on Twitter by media employees hoping to convey how cool and hip their work culture is. “We’re colleagues, but we can also laugh as friends!” The Slack screenshot is shorthand: We can be serious and also fun; aren’t you jealous you don’t work with us?</p>\n        \n          <p class=\"clay-paragraph\">Just as companies develop their own idiosyncratic office culture, which is shaped by official policies and unofficial norms, every company also has its own Slack culture. In contrast to <em>New York</em> magazine, Vox Media has a policy that employees must use photos of their actual faces as their avatars. One NYMag staffer described the policy as “cop culture.”</p>\n        \n          \n        \n          \n        \n          <p class=\"clay-paragraph\">Other <em>New York</em> employees vowed to resist. “I refuse to change my profile pic from a Jigglypuff,” Jackson McHenry told me. “I will remain Beanie Feldstein,” Madison Malone Kircher pledged. I, since 2015, have never had an avatar in <em>New York</em>’s Slack and, frankly, it would be weird if I did it now.</p>\n        \n          \n        \n          <p class=\"clay-paragraph\">Because it is enterprise software, and mergers and acquisitions happen in business, Slack has a built-in functionality for <a href=\"https://slack.com/help/articles/217872578\">merging two separate accounts</a>, slamming two discrete worlds together with the click of a button. Imagine if Coca-Cola and Pepsi each made all of their internal discussions accessible to the other’s workforce at once. This is what Bankoff reportedly told his employees would happen eventually with Vox and <em>New York</em>, though he apparently gave no timetable or technical specifics on how the two would glom together. Survivors of other merger processes have described it as a stressful one.</p>\n        \n        <aside class=\"clay-tweet\">\n            <blockquote class=\"twitter-tweet\">\n<p>just to warn all my ny mag and vox media friends: when they merge the slacks, it will be terrible and you will hate it</p>— aleksander chan (@aleksnotalex) <a href=\"https://twitter.com/aleksnotalex/status/1176683883473121281?ref_src=twsrc%5Etfw\">September 25, 2019</a>\n</blockquote>\n        \n        \n            \n        </aside>\n        \n          \n        \n          \n        \n          <p class=\"clay-paragraph\">A lesser known fact about Slack is that its name is, according to the company’s founder Stewart Butterfield, an <a href=\"https://qz.com/794524/messaging-startup-slack-is-secretly-an-acronym-for-searchable-log-of-all-communication-and-knowledge/\">acronym</a>. It stands for “Searchable Log of All Communication and Knowledge.” Not menacing at all.</p>\n        \n          <p class=\"clay-paragraph\">The software lives up to its name. If you’re a certain type of masochist, you can drop into your new employer’s Slack and search your name (from NYMag’s Slack chat on August 19, 2014: “who’s brian feldman”). In 2016, my colleague Max Read had his innocuous Slack joke about Hulk Hogan read out in court during the lawsuit that eventually bankrupted Gawker Media. The communication logs were included in the discovery process, a good demonstration of why lawyers would always rather talk on the phone.</p>\n        \n          \n        \n          <p class=\"clay-paragraph\">Writing for <em>New York</em>’s nascent tech vertical at the time, Read <a href=\"https://nymag.com/intelligencer/2016/03/what-hulk-hogan-taught-me-about-slack.html\">assessed</a>, “There’s a bible’s worth of casual (or joking) shit-talking I’ve done in Gawker’s chat archives, some of which would make me very uncomfortable (if not unemployable) if it got out — a wealth of gossip and prattle I should have just conducted in person.” Unfortunately, the lessons of Hogan were soon forgotten.</p>\n        \n          \n        \n          \n        \n          <p class=\"clay-paragraph\">Shortly after word got out that Bankoff had pledged to merge Vox’s and <em>New York</em>’s Slack channels, the staff of <em>New York</em>’s defunct tech vertical, Select All, agreed that we would request that chief product officer Daniel Hallac, our Slack admin, wipe the #select-all chatroom. (Slack has a function that auto-wipes messages on a regular interval, but in a workplace context, I think most have the understandable instinct to retain as much data as possible.) “I don’t think I can nuke it entirely but definitely make it hard to access,” he said. I’ll take it.</p>\n        \n          <p class=\"clay-paragraph\">I will not say what was contained within, nor, honestly, can I even recall specific comments. But there were certainly ungenerous through lines in our insular chat bubble. There were comments aimed at competitors that were legitimate critiques. I’m not too proud to admit that others were remarks borne of petty jealousy. Most were probably a bit of both. Some comments were probably extremely funny, incredible, solid-gold quips. The thought of those targets combing through our Slack archives is so remote a possibility that it’s easy to put it out of mind. What fools we were.</p>\n        \n          <p class=\"clay-paragraph\">No doubt on the other side of the Vox–<em>New York</em> gulf, similar anxieties had presented themselves. One source warned me not to search for my name in the Vox logs. “Some interesting stuff in here,” deadpanned another employee who searched my name in Vox’s Slack and instantly pulled up a tweet of mine that one Vox employee deemed a “bad fucking take” (the poster’s name was redacted; I forgive you; I’ve never written a bad take). They told me they’d had similar discussions about chat archives.</p>\n        \n          \n        \n          \n        \n          \n        \n          <p class=\"clay-paragraph\">That the workplace chat room has become more than a workplace chat room is by design. With Slack, work ostensibly never ends, it’s just a perpetual conversation that you are a part of. That employees feel comfortable letting loose in the confines of an ostensibly private chat room is not an anomaly, it’s the entire point. But when personal conversations and professional obligations collide, a Slack between friends becomes a ticking time bomb.</p>\n        \n          <aside class=\"newsletter-flex-text initially-hidden opacity-zero\">\n          <div class=\"wrapper-style\">\n        \n        \n            <div>\n              <div class=\"text-form-wrapper\">\n                <div class=\"text\">\n                  \n                  <div class=\"description\">Daily news about the politics, business, and technology shaping our world.</div>\n                </div>\n        \n                \n                \n              </div>\n              \n              <div class=\"terms-and-policy-wrapper\">\n                \n                <span class=\"expanded-terms\">By submitting your email, you agree to our <a href=\"http://nymag.com/newyork/terms/\">Terms</a> and <a href=\"http://nymag.com/newyork/privacy/\">Privacy Notice</a> and to receive email correspondence from us.</span>\n              </div>\n            </div>\n          </div>\n        </aside>\n        \n    </div></div>",
    "url": "http://nymag.com/intelligencer/2019/09/the-anxiety-inducing-peril-of-old-slack-posts.html",
    "published": "2019-09-26T18:09:09.898000Z",
    "created_at": "2019-09-28T12:31:54.982764Z",
    "original": null,
    "twitter_id": null,
    "twitter_thread_ids": [],
    "extracted_content_url": "https://extract.feedbin.com/parser/feedbin/e1f305f7414ae992f396883c65b3fb16e037ff0b?base64_url=aHR0cDovL255bWFnLmNvbS9pbnRlbGxpZ2VuY2VyLzIwMTkvMDkvdGhlLWFueGlldHktaW5kdWNpbmctcGVyaWwtb2Ytb2xkLXNsYWNrLXBvc3RzLmh0bWw=",
    "images": {
      "original_url": "https://pixel.nymag.com/imgs/daily/intelligencer/2019/09/26/26-shredder.w700.h700.jpg",
      "size_1": {
        "cdn_url": "https://images.feedbinusercontent.com/4804810/480481077bfe3a0660f6f5aadd9f12ffe38be72e.jpg",
        "width": 542,
        "height": 304
      }
    },
    "enclosure": null,
    "extracted_articles": [],
    "json_feed": null
  },
  {
    "id": 2218975002,
    "feed_id": 1658782,
    "title": "From the archives: How the Watergate crisis eroded public support for Richard Nixon",
    "author": "Andrew Kohut (1942-2015)",
    "summary": "Andrew Kohut, the founding director of Pew Research Center and its president from 2004 to 2012, was one of the nation’s leading pollsters. He died in 2015. His work, over three decades, won him wide respect for his expertise and ability to craft stories",
    "content": "<div class=\"post-content\"> <figure id=\"attachment_320708\" class=\"wp-caption alignleft\"><img class=\"wp-image-320708\" src=\"https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg\" alt width=\"640\" srcset=\"https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg 1280w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=300,169 300w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=768,432 768w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=1024,576 1024w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=160,90 160w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=720,405 720w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=200,113 200w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=260,146 260w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=310,174 310w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=420,236 420w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=640,360 640w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=740,416 740w, https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg?resize=540,304 540w\" sizes=\"(max-width: 640px) 100vw, 640px\"><figcaption id=\"caption-attachment-320708\" class=\"wp-caption-text\">President Richard Nixon delivers remarks to the White House staff on his final day in office, Aug. 9, 1974. Credit: White House photo, courtesy Richard Nixon Presidential Library</figcaption></figure>\n<p><em>Andrew Kohut, the founding director of Pew Research Center and its president from 2004 to 2012, was one of the nation’s leading pollsters. He died in 2015. His work, over three decades, won him wide respect for his expertise and ability to craft stories about what people could learn from survey research. One of his particular talents was to reach back in time to take a snapshot of the mood of Americans in another era to show how much times had changed. </em></p>\n<p><em>Here is one of those articles, originally published on Aug. 8, 2014.</em></p>\n<p>Forty years ago today, Richard Nixon announced his resignation from the nation’s highest office, making that decision in the face of almost certain impeachment by the House and plummeting public support, as a majority of Americans called for his removal from office. But it happened in stages.</p> <p>Nixon had won reelection in 1972 by a landslide and began his second term with a lofty 68% Gallup Poll approval rating in January 1973. But the Watergate scandal – which started with an effort to bug the Democratic National Committee office at the Watergate Hotel and subsequent efforts to cover it up – quickly took a heavy toll on those ratings, especially when coupled with a ramp-up in public concerns about inflation. By April, a resounding 83% of the American public had heard or read about Watergate, as the president accepted the resignations of his top aides John Ehrlichman and H.R. Haldeman. And in turn, Nixon’s approval ratings fell to 48%.</p>\n<p><a href=\"https://www.pewresearch.org/fact-tank/2019/09/25/how-the-watergate-crisis-eroded-public-support-for-richard-nixon/ft_14-08-08_nixonresignation_2x/\"><img class=\"alignleft wp-image-315307\" src=\"https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png\" alt=\"How Watergate Changed Public Opinion of Richard Nixon\" width=\"640\" srcset=\"https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png 1280w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=300,281 300w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=768,719 768w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=1024,958 1024w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=160,150 160w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=433,405 433w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=200,187 200w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=260,243 260w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=310,290 310w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=420,393 420w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=640,599 640w, https://www.pewresearch.org/wp-content/uploads/2019/06/FT_14.08.08_NixonResignation_2x.png?resize=740,693 740w\" sizes=\"(max-width: 640px) 100vw, 640px\"></a>But that was just the beginning of the toll the scandal would take on the president that year. The <a href=\"https://abcnews.go.com/Politics/video/may-17-1973-televised-watergate-hearings-begin-19171632\">televised Watergate hearings</a> that began in May 1973, chaired by Sen. Samuel Ervin, commanded a large national audience – 71% told Gallup they watched the hearings live. And as many as 21% reported watching 10 hours or more of the Ervin proceedings. Not too surprisingly, Nixon’s popularity took a severe hit. His ratings fell as low as 31%, in Gallup’s early August survey.</p>\n<p>The public had changed its view of the scandal. A 53% majority came to the view that Watergate was a serious matter, not just politics, up from 31% who believed that before the hearings. Indeed, an overwhelming percentage of the public (71%) had come to see Nixon as culpable in the wrongdoing, at least to some extent. About four-in-ten (37%) thought he found out about the bugging and tried to cover it up; 29% went further in saying that he knew about the bugging beforehand, but did not plan it; and 8% went all the way, saying he planned it from beginning to end. Only 15% of Americans thought that the president had no prior knowledge and spoke up as soon as he learned of it.</p>\n<p>Yet, despite the increasingly negative views of Nixon at that time, most Americans continued to reject the notion that Nixon should leave office, according to Gallup. Just 26% thought he should be impeached and forced to resign, while 61% did not.</p>\n<p>A lot of key scandal events were to follow that year and into 1974, but public opinion about Watergate was slow to change further, despite the high drama of what was taking place. For example, October 1973 was a crucial month as the <a href=\"https://www.nytimes.com/1973/10/13/archives/judges-rule-52-historic-decision-finds-president-not-above-laws.html\">courts ruled</a> that the president had to turn over his taped conversations to special prosecutor Archibald Cox, and subsequently Nixon ordered for the dismissal of Cox in what came to be known as the <a href=\"https://www.pbs.org/video/american-experience-nixon-and-abusing-power-the-saturday-night-massacre/\">Saturday Night Massacre</a>. The public reacted, but in a measured way. In November, Gallup showed the percentage of Americans thinking that the president should leave office jumping from 19% in June to 38%, but still, 51% did not support impeachment and an end to Nixon’s presidency.</p>\n<p>In the spring of 1974, despite the <a href=\"http://news.google.com/newspapers?id=6BIRAAAAIBAJ&amp;sjid=NOADAAAAIBAJ&amp;pg=5967%2C5489\">indictment of top former White House aides</a>, and Nixon’s release of what were seen as “heavily edited” transcripts of tapes of his aides plotting to get White House enemies, the public was still divided over what to do about the president. For example, by June, 44% in the Gallup Poll thought he should be removed from office, while 41% disagreed.</p>\n<p>Only in early August, following the <a href=\"http://www.washingtonpost.com/wp-srv/national/longterm/watergate/articles/072874-1.htm\">House Judiciary Committee’s recommendation</a> in July that Nixon be impeached and the <a href=\"http://www.washingtonpost.com/politics/court-orders-nixon-to-yield-tapes-president-promises-to-comply-fully/2012/06/04/gJQAZSw0IV_story.html\">Supreme Court’s decision</a> that he surrender his audio tapes, did a clear majority – 57% – come to the view that the president should be removed from office.</p>\n<p>But once he was gone, the Americans were not quick to forgive and forget. In September, a 58% majority said Nixon should be tried for possible criminal charges. And they took the view that he should not be let off the hook easily, if found guilty. By a margin of 53% to 38%, the public thought that President Ford should not pardon Nixon, if he was found guilty.</p>\n<p>The latter sentiment of course, would carry on, and be crucial to the outcome of the next presidential election. Ford did pardon Nixon in September, an act that was followed by a plummet of his own poll numbers, and later was seen as a factor in his loss to Democrat Jimmy Carter in the 1976 presidential election.</p> <div class=\"taxonomies\"> <div class=\"ui small horizontal comma-seperated list\"> <p class=\"item\">Topics</p> <a class=\"item\" href=\"https://www.pewresearch.org/topics/federal-government/\">Federal Government</a><a class=\"item\" href=\"https://www.pewresearch.org/topics/scandals/\">Scandals</a><a class=\"item\" href=\"https://www.pewresearch.org/topics/presidential-approval/\">Presidential Approval</a> </div> </div> </div>",
    "url": "https://www.pewresearch.org/fact-tank/2019/09/25/how-the-watergate-crisis-eroded-public-support-for-richard-nixon/",
    "published": "2019-09-25T00:00:00.000000Z",
    "created_at": "2019-09-28T00:29:59.704962Z",
    "original": null,
    "twitter_id": null,
    "twitter_thread_ids": [],
    "extracted_content_url": "https://extract.feedbin.com/parser/feedbin/1463bd3d4379a008dc8e51e6ecfabb9ae5ade890?base64_url=aHR0cHM6Ly93d3cucGV3cmVzZWFyY2gub3JnL2ZhY3QtdGFuay8yMDE5LzA5LzI1L2hvdy10aGUtd2F0ZXJnYXRlLWNyaXNpcy1lcm9kZWQtcHVibGljLXN1cHBvcnQtZm9yLXJpY2hhcmQtbml4b24v",
    "images": {
      "original_url": "https://www.pewresearch.org/wp-content/uploads/2019/09/FT_19.09.25_NixonResignation.jpg",
      "size_1": {
        "cdn_url": "https://images.feedbinusercontent.com/f122f07/f122f07afa46563a5fb862d76d9117b967ef6f2a.jpg",
        "width": 542,
        "height": 304
      }
    },
    "enclosure": null,
    "extracted_articles": [],
    "json_feed": null
  },
  {
    "id": 2217754497,
    "feed_id": 1658782,
    "title": "How Airbnb is Moving 10x Faster at Scale with GraphQL and Apollo",
    "author": "Adam Neary",
    "summary": "The existing state for the product at the beginning of the talk presupposes we have built a system where a very dynamic page is constructed based on a query that will return an array of some set of possible “sections.” These sections are responsive and",
    "content": "<div>\n<div class=\"ae jp ab dm v w\">\n<p id=\"62b6\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">The existing state for the product at the beginning of the talk presupposes we have built a system where a very dynamic page is constructed based on a query that will return an array of some set of possible “sections.” These sections are responsive and define the UI completely.</p>\n<p id=\"5681\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">The central file that manages this would be a generated file (later, we will get to how to generate it) that looks something like this:</p>\n<figure class=\"mf mg mh mi mj ev\"><div class=\"mk l ej\"><p class=\"nn\"><iframe src=\"https://medium.com/media/a4c3a26501481c66b1c480ba86695e9f\" height=\"0\" width=\"0\" class=\"gi n o gh ab\"></iframe></p></div></figure><p id=\"f59d\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Since the list of possible sections is quite large (~50 sections today for Search), it also presumes we have a sane mechanism for lazy-loading components with server rendering, which is a topic for another post. Suffice it to say, we do not need to package all possible sections in a massive bundle to account for everything up front.</p>\n<p id=\"dba1\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Each section component defines its own query fragment, colocated with the section’s component code. That looks something like this:</p>\n<figure class=\"mf mg mh mi mj ev\"><div class=\"mk l ej\"><p class=\"nn\"><iframe src=\"https://medium.com/media/932a1121d3af34ef9a8f42ce84945042\" height=\"0\" width=\"0\" class=\"gi n o gh ab\"></iframe></p></div></figure><p id=\"2432\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">This is the general idea of Backend-Driven UI at Airbnb. It’s used in a number of places, including Search, Trip Planner, Host tools, and various landing pages. We use this as our starting point, and then in the demo show how to (1) make and update to an existing section, and (2) add a new section.</p>\n<h2 id=\"13bd\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">Explore Your Schema With Playground</h2>\n<p id=\"8c70\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">While building your product, you want to be able to explore your schema, discovering field names and testing out potential queries on live development data. We achieve that today with <a href=\"https://github.com/prisma/graphql-playground\" class=\"dc bt no np nq nr\">GraphQL Playground</a>, the work of our friends at <a href=\"https://www.prisma.io/\" class=\"dc bt no np nq nr\">Prisma</a>. The tools come standard with Apollo Server.</p>\n<p id=\"a6f0\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">In our case, backend services are primarily written in Java, and their schemas are stitched together by our Apollo Server, which we call Niobe. For now, since Apollo Gateway and Schema Composition are not yet live, all our backend services are name-spaced by service. This is why exploring the playground begins with a list of service names. The next level down in the tree is the service method. In this case, <code class=\"ns nt nu nv nw b\">getJourney()</code>. As I mention in the talk, Schema Composition, a new concept unveiled by the Apollo team, should help us build a more sane schema model. More on that in the coming months.</p>\n<h2 id=\"d0be\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">View Your Schema in VS Code with the Apollo Plugin</h2>\n<p id=\"0c0e\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">One of the joys I wanted to demonstrate in the talk is having so many helpful tools at my fingertips while building our product. This includes access to Git in VS Code, as well as the integrated terminal and tasks for running frequently-needed commands.</p>\n<p id=\"efd4\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Of course, we also had some fun stuff to show for GraphQL and Apollo! The part that most people had not seen was the new <a href=\"https://marketplace.visualstudio.com/items?itemName=apollographql.vscode-apollo\" class=\"dc bt no np nq nr\">Apollo GraphQL VS Code Extension</a>. There is no need for me to copy over all juicy features from their marketing site (there are many!), but I will elaborate on one feature: <strong class=\"ll nx\">Schema Tags</strong>.</p>\n<p id=\"03dd\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">If you are going to lint your queries against the schema you are working on, you will invariably be presented with the decision of “which schema?” The default may be your production schema (“current,” by convention), but as we discuss in the demo, if you need to iterate and explore new ideas, you need the flexibility of targeting a provisional schema.</p>\n<p id=\"f52b\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Since we are using Apollo Engine, publishing multiple schemas using tags allows us this flexibility, and multiple engineers can collaborate on a single proposed schema. Once proposed schema changes for a service are merged upstream and those changes are naturally flowing down in the current production schema, we can flip back to “current” in VS Code. Very cool.</p>\n<h2 id=\"8b86\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">Automatically Generate Types</h2>\n<p id=\"5043\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">The goal with Codegen is to benefit from strong type safety without having to manually create TypeScript types or React PropTypes. This is critical because our query fragments are distributed among the components that use them. This is why making a 1-line change to a query fragment results in 6–7 files being updated; because that same fragment appears in numerous places in the query hierarchy — in parallel to the component hierarchy.</p>\n<p id=\"d80d\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">This part is nothing but Apollo CLI functionality. We are working on a particularly fancy file watcher (named “<strong class=\"ll nx\">Sauron</strong>,” obviously), but for now it is no trouble at all to run <code class=\"ns nt nu nv nw b\">apollo client:codegen --target=typescript --watch --queries=frontend/luxury-guest/**/*.{ts,tsx}</code> as needed. It is good to be able to flip off the codegen during rebases, and I typically filter my scope down to the project I am working on.</p>\n<p id=\"de2d\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">My favorite part is that since we are co-locating our fragments with our components, changing a single file results in many files in the query being updated as we move up the component hierarchy. This means that higher up in the tree near the route component, we can see the consolidated query and all the various types of data it can pass through.</p>\n<p id=\"6a46\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">No magic there at all. Just Apollo CLI.</p>\n<h2 id=\"33e4\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">Isolate your UI Changes with Storybook</h2>\n<p id=\"0531\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">The tool we use for editing UI is <a href=\"https://storybook.js.org/\" class=\"dc bt no np nq nr\"><strong class=\"ll nx\">Storybook</strong></a>. It is the perfect place to make sure your work aligns with designs to the pixel across breakpoints. You get fast hot module reloading and a couple checkboxes to enable/disable browser features like Flexbox.</p>\n<p id=\"c381\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">The only tricks I apply to Storybook are loading the stories with the mock data we’ve extracted from the API. If your mock data really covers all the various various possible states for your UI, you are good to go. Beyond that, if you have alternative states you want to account for, perhaps loading or error states, you can add them in manually.</p>\n<figure class=\"mf mg mh mi mj ev\"><div class=\"mk l ej\"><p class=\"nn\"><iframe src=\"https://medium.com/media/8178327d0d9083765cb9b2c07b637662\" height=\"0\" width=\"0\" class=\"gi n o gh ab\"></iframe></p></div></figure><p id=\"6170\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">This is the crux of the matter for Storybook. This file is entirely generated from Yeoman (discussed below), and it delivers the examples from the Alps Journey by default. <code class=\"ns nt nu nv nw b\">getSectionsFromJourney()</code> just filters the sections.</p>\n<p id=\"03ba\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">One other hack you’ll notice is that I added a pair of divs to bookend my component vertically, since Storybook renders with whitespace around the component. That is fine for buttons or UI with borders, but it’s hard to tell precisely where your component starts and ends, so I hacked them in there.</p>\n<p id=\"8baa\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Since we are talking about how all these fabulous tools work so well together to help you be productive, can I just say what a delight it is to work on UI with <em class=\"ny\">Zeplin or Figma side by side with Storybook</em>. Digging into UI in this abstract way takes all the chaos of this madcap world away one breakpoint at a time, and in that quiet realm, you are good down to the pixel every time.</p>\n<h2 id=\"1bab\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">Automatically Retrieve Mock Data</h2>\n<p id=\"d4ec\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">To supply Storybook and our unit tests with realistic mock data, we want to extract the mock data directly from our Shared Development Environment. As with codegen, even a small change in a query fragment should also trigger many small changes in mock data. And here, similarly, the hard part is tackled entirely by Apollo CLI, and you can stitch it together with your own code in no time.</p>\n<p id=\"20fb\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">The first step is simply to run <code class=\"ns nt nu nv nw b\">apollo client:extract frontend/luxury-guest/apollo-manifest.json</code>, and you will have a manifest file with the all the queries from your product code. One thing you may notice is that the command is name-spaced to this “luxury guest” project because I do not want to be refresh all possible mock data for all possible teams.</p>\n<p id=\"df10\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">This command is lovely because my queries are all distributed among many TypeScript files, but this command will execute on source and combine all the imports. I don’t have to run it on babel/webpack output.</p>\n<p id=\"08f8\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">The piece we then add to this is short and mechanical:</p>\n<figure class=\"mf mg mh mi mj ev\"><div class=\"mk l ej\"><p class=\"nn\"><iframe src=\"https://medium.com/media/f87e44117f231d0d31114dba941bd7dc\" height=\"0\" width=\"0\" class=\"gi n o gh ab\"></iframe></p></div></figure><p id=\"3d02\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">We are currently working with the Apollo team to extract this logic to the Apollo CLI, as well. I could imagine a world where the only thing you need to specify is the array of examples you want, and co-locating them in a folder with a query would automatically codegen the mocks on demand. Imagine specifying the mocks you need thusly:</p>\n<figure class=\"mf mg mh mi mj ev\"><div class=\"mk l ej\"><p class=\"nn\"><iframe src=\"https://medium.com/media/9972d95ebbbb1a63f0a66340421964f1\" height=\"0\" width=\"0\" class=\"gi n o gh ab\"></iframe></p></div></figure><p id=\"4db2\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">If you have some ideas for how you would want to use this, please don’t hesitate to reach out!</p>\n<h2 id=\"81e9\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">Add Screenshot Testing to Code Review with Happo</h2>\n<p id=\"4d53\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\"><a href=\"https://happo.io/\" class=\"dc bt no np nq nr\"><strong class=\"ll nx\">Happo</strong></a> is a straight up life-saver. It is the only screenshot testing tool I’ve ever used, so I would not be sophisticated enough to compare it to alternatives, if there are any, but the essential idea is that you push code, and it goes off and renders all the components in your PR, comparing it with the version on master.</p>\n<p id=\"0fab\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">This means if you edit a component like <code class=\"ns nt nu nv nw b\">&lt;Input /&gt;</code> it will show you the impact on components that use Input, including the <em class=\"ny\">Search Bar </em>you accidentally modified. It. Is. Fabulous.</p>\n<p id=\"8749\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">How many times did you think your change was contained only to discover that ten other teams started using what you built, and your change breaks three of the ten? Without Happo, you might not know.</p>\n<p id=\"3e28\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Until lately, the only downside with Happo was that our Storybook variations (the input to the screenshot testing process) did not always reflect reliable data adequately. Now that Storybook is leveraging API data, we can feel much more confident. Plus, as our demo explores, it is automatic. If you add a field to the query and then the component, Happo will automatically post the diff to your PR, letting the engineers, designers, and product managers sitting next to you see the visual consequences of the change you have made.</p>\n<h2 id=\"9661\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">Generate New Files with Yeoman</h2>\n<p id=\"690b\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">If you need to scaffold a bunch of files multiple times, you should build a generator. It will turn you into an army of you. I was shocked following the talk by how many people thought we had a flotilla of infrastructure engineers working on what I showed in that video. Other than the AST Transformations (which I will address next), this was just three template files and this puppy:</p>\n<figure class=\"mf mg mh mi mj ev\"><div class=\"mk l ej\"><p class=\"nn\"><iframe src=\"https://medium.com/media/9ea70c8965b923c6315ad41a647a106e\" height=\"0\" width=\"0\" class=\"gi n o gh ab\"></iframe></p></div></figure><p id=\"580b\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">You could imagine creating something like the above in 2–3 minutes for a project that was only going to last the afternoon. Yeoman generators don’t need to wait for infrastructure teams or massive multi-quarter projects.</p>\n<h2 id=\"7127\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">Use AST Explorer to Learn How to Edit Existing Files</h2>\n<p id=\"56c0\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">The tricky part for Yeoman generators is to edit <em class=\"ny\">existing</em> files. But with Abstract Syntax Tree (AST) transformations, the task is made much easier.</p>\n<p id=\"3c16\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Here is how we achieve the desired transformation of Sections.tsx, which we discuss at the top of this post:</p>\n<figure class=\"mf mg mh mi mj ev\"><div class=\"mk l ej\"><p class=\"nn\"><iframe src=\"https://medium.com/media/bc0aa6f9eda80dfc88b95a237d1a7165\" height=\"0\" width=\"0\" class=\"gi n o gh ab\"></iframe></p></div></figure><p id=\"34cc\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\"><code class=\"ns nt nu nv nw b\">_updateFile</code> is boilerplate for using Babel to apply an AST transformation. The crux of the work is <code class=\"ns nt nu nv nw b\">_addToSectionMapping</code>, and you see:</p>\n<ol class>\n<li id=\"3589\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw nz oa ob\">At the Program level, it inserts a new Import Declaration.</li>\n<li id=\"bef1\" class=\"lj lk ch ap ll b lm oc lo od lq oe ls of lu og lw nz oa ob\">Of the two Object Expressions, the one with multiple properties is our Section Mapping, and we will insert a key/value pair there.</li>\n<li id=\"91bf\" class=\"lj lk ch ap ll b lm oc lo od lq oe ls of lu og lw nz oa ob\">The Tagged Template Literal is our gql fragment, and we want to insert 2 lines there, the first being a Member Expression and the second being one of a set of “quasi” expressions. (Hmm…)</li>\n</ol>\n<p id=\"b02a\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">If the code performing the transformation looks intimidating, I can only say the same is true for me. Prior to writing this transformation, I had not encountered quasis, and it would be fair to say I found them quasi-confusing (#DadJokes).</p>\n<p id=\"46f0\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">The good news is that AST Explorer makes it easy to hammer this sort of thing out. Here’s <a href=\"https://astexplorer.net/#/gist/e675b0068a8b74098c213b8065d7583c/dac289f77e481e68fdff052392aa789ee05d4e78\" class=\"dc bt no np nq nr\">that same transformation in Explorer</a>. Of the four panes, the upper left contains the source file, the upper right contains the parsed tree, the lower left contains the proposed transformation, and the lower right contains the transformed result.</p>\n<p id=\"a3bd\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Looking at the parsed tree immediately tells you the structure of the code you’ve written in Babel terms (you knew that was a Tagged Template Literal, right?), and that gives you what you need to figure out how to apply transformations and test them.</p>\n<p id=\"f0b3\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">AST transformations also play a crucial role in Codemods. Check out <a class=\"dc bt no np nq nr\" href=\"https://medium.com/airbnb-engineering/turbocharged-javascript-refactoring-with-codemods-b0cae8b326b9\">this post</a> from my friend, <a class=\"dc bt no np nq nr\" href=\"https://medium.com/@lencioni\">Joe Lencioni</a>, on the matter.</p>\n<h2 id=\"4b8c\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">Extract Mock Content from Zeplin or Figma</h2>\n<p id=\"42a5\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">Zeplin and Figma are both built to allow engineers to extract content directly to facilitate product development.</p>\n<figure class=\"mf mg mh mi mj ev x y paragraph-image\"><div class=\"oi oj ej ok ab\"><div class=\"x y oh\"><div class=\"mk l ej ns\"><div class=\"oo l\">\n<div class=\"do ol gi n o gh ab bx om on\"><img alt class=\"gi n o gh ab op oq or\" src=\"https://miro.medium.com/max/60/1*-_KzHG5cPzyJDr7JmfsSkw.png?q=20\" width=\"1072\"></div>\n<img alt class=\"do ol gi n o gh ab gf\" width=\"1072\">\n</div></div></div></div></figure><p id=\"26ff\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">In the case of the image above, extracting the copy for an entire paragraph is as simple as selecting the content in Zeplin and clicking the “copy” icon in the Content section of the sidebar.</p>\n</div>\n<div class=\"ae jp ab dm v w\">\n<p id=\"b940\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">In the case of Zeplin, images can be extracted by selecting and clicking the “download” icon in the Assets section of the sidebar.</p>\n<h2 id=\"8d15\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">Automate Photo Processing…By Building Media Squirrel?</h2>\n<p id=\"8364\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">The photo processing pipeline is most certainly an Airbnb-specific thing. The piece I wanted to highlight was actually <a href=\"https://twitter.com/briebunge?lang=en\" class=\"dc bt no np nq nr\">Brie</a>’s contribution in creating “Media Squirrel” to wrap an existing API endpoint. Without Media Squirrel, we didn’t have a good way to convert raw images on our machines to JSON objects containing the content from our image processing pipeline, to say nothing for having static URLs we could use as image sources.</p>\n<p id=\"ff66\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">The takeaway for Media Squirrel is that when you need something routine that many people will need, never hesitate to build a useful tool everyone can use moving forward. It’s part of Airbnb’s zany culture, and it’s a habit I value deeply.</p>\n<h2 id=\"09f9\" class=\"mv mw ch ap ao bz mx my mz na nb nc nd ne nf ng nh\">Intercept Schema and Data in Apollo Server</h2>\n<p id=\"0bac\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">This part is still a work in progress as concerns the final API. The key things we wanted to do were (a) intercept a remote schema and modify it, and (b) intercept a remote response and modify it. The reason is that while the remote service is the source of truth, we want to be able to iterate on the product before formalizing something like a schema change in the upstream service.</p>\n<p id=\"e985\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">This is the only place in the demo where we got a little cheeky and took liberties with API. With Schema Composition and Distributed Execution in Apollo’s near-term roadmap, we didn’t want to guess how everything would work precisely, so we just presented the basic concept.</p>\n<p id=\"5544\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">In reality, Schema Composition should give us the ability to define a type and do something along the lines of:</p>\n<figure class=\"mf mg mh mi mj ev\"><div class=\"mk l ej\"><p class=\"nn\"><iframe src=\"https://medium.com/media/9e37b22c6e97a8fb64fbec9f449c0d3f\" height=\"0\" width=\"0\" class=\"gi n o gh ab\"></iframe></p></div></figure><p id=\"5152\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Note: In this case, the schema knows that EditorialContent is a union, and so by extending it, we’re really asking it to be aware of another possible type.</p>\n<p id=\"445b\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">The code for modifying the Berzerker response looks like this:</p>\n<figure class=\"mf mg mh mi mj ev\"><div class=\"mk l ej\"><p class=\"nn\"><iframe src=\"https://medium.com/media/71cf735ea8dc3bb52321e69ada5ebed3\" height=\"0\" width=\"0\" class=\"gi n o gh ab\"></iframe></p></div></figure><p id=\"2953\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">The idea is a play on what you find in <a href=\"https://www.apollographql.com/docs/apollo-server/features/mocking.html#Using-MockList-in-resolvers\" class=\"dc bt no np nq nr\">Apollo Server Mock API</a>. Here, instead of the mocks filling any gaps in your API, it actually leaves any gaps in place and proactively overrides the content based on what you provide. This is more likely to be the sort of API for mocking that we would want.</p>\n<p id=\"d790\" class=\"lj lk ch ap ll b lm ni lo nj lq nk ls nl lu nm lw\">Much more important than any one of these tricks is the broader point about moving exceptionally fast and automating as much of the process as possible, particularly around boilerplate, types, and file creation.</p>\n<p id=\"9aa1\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Apollo CLI takes care of all the Apollo-specific domain, which free you up to wire those utilities up in a way that makes sense for your use case.</p>\n<p id=\"ad77\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">Some of those use cases, like codegen for types, are universal and end up part of your overall infrastructure. But many of them are just as disposable as the components you use them to build. And none of them involved a product engineer waiting for an infrastructure engineer to build something for them!</p>\n<p id=\"b6ff\" class=\"lj lk ch ap ll b lm ln lo lp lq lr ls lt lu lv lw\">So I hope this post explains what you’re seeing in the video, and I hope you have the chance to apply some of these techniques in your day to day work.</p>\n</div>\n</div>",
    "url": "https://medium.com/airbnb-engineering/how-airbnb-is-moving-10x-faster-at-scale-with-graphql-and-apollo-aa4ec92d69e2",
    "published": "2018-12-05T17:35:07.315000Z",
    "created_at": "2019-09-26T19:56:13.255968Z",
    "original": null,
    "twitter_id": null,
    "twitter_thread_ids": [],
    "extracted_content_url": "https://extract.feedbin.com/parser/feedbin/91d6221df953930885282403518c93603ffe14f5?base64_url=aHR0cHM6Ly9tZWRpdW0uY29tL2FpcmJuYi1lbmdpbmVlcmluZy9ob3ctYWlyYm5iLWlzLW1vdmluZy0xMHgtZmFzdGVyLWF0LXNjYWxlLXdpdGgtZ3JhcGhxbC1hbmQtYXBvbGxvLWFhNGVjOTJkNjllMg==",
    "images": null,
    "enclosure": null,
    "extracted_articles": [],
    "json_feed": null
  },
  {
    "id": 2215845918,
    "feed_id": 1658782,
    "title": "7 mistakes when using Apache Cassandra - SoftwareMill Tech Blog",
    "author": "Michał Matłoka",
    "summary": "Apache Cassandra is one of the most popular NoSQL databases. It offers great performance and scalability without sacrificing availability. It has no Single Point of Failure (SPOF). The biggest, publicly announced cluster contains over 115k nodes and over",
    "content": "<div><section class=\"jd je jf jg jh\"><div class=\"ae ji ab df v w\">\n<div><div class=\"ju\"><div class=\"ag af\">\n<div><a href=\"https://blog.softwaremill.com/@mmatloka?source=post_page-----51d2cf6df519----------------------\"><img alt=\"Michał Matłoka\" class=\"l fn jv jw\" src=\"https://miro.medium.com/fit/c/96/96/1*9Y66P19rQG9D7hsovL9yWA.png\" width=\"48\"></a></div>\n<div class=\"jx ab l\"><span class=\"ao b ap aq ar as l at au\"><span class=\"ao cr dw aq bx ka dy dz kb eb at\"></span></span></div>\n</div></div></div>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/3840/1*weN2UFi722K2B_xtg7CU3g.jpeg\" width=\"1920\"><figcaption class=\"at dw lg lh hh df x y li lj ao cr\">Photo by <a href=\"https://unsplash.com/@rojekilian?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\" class=\"cv bt lk ll lm ln\">Sarah Kilian</a> on <a href=\"https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\" class=\"cv bt lk ll lm ln\">Unsplash</a></figcaption></figure><p id=\"4175\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\"><a href=\"http://cassandra.apache.org/\" class=\"cv bt lk ll lm ln\">Apache Cassandra</a> is one of the most popular NoSQL databases. It offers great performance and scalability without sacrificing availability. It has no <a href=\"https://en.wikipedia.org/wiki/Single_point_of_failure\" class=\"cv bt lk ll lm ln\">Single Point of Failure (SPOF)</a>. The biggest, publicly announced cluster contains over 115k nodes and over 10PB of data. However, Cassandra data format differs from what you got used to in the SQL world. There are tables with special keys but without relations. What is the most important, it is not possible to query data using any arbitrary column. Cassandra is not perfect for every project, there are many mistakes which can be made when working with it. Let’s analyze a few of them.</p>\n<blockquote class=\"mc md me\"><p id=\"b565\" class=\"lo lp dt mf lq b lr ls lt lu lv lw lx ly lz ma mb\">Note: This blogpost is based on my presentation: Cassandra — How to fail?</p></blockquote>\n<figure class=\"kq kr ks kt ku et\"></figure><h2 id=\"0a17\" class=\"mi\">Mistake 1 — We will have a lot of data, Cassandra worked for others, so let’s use it</h2>\n<p id=\"f4a5\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">We’ve already heard people saying “we will have a lot of data”, “it worked for Apple” or “it worked for Walmart”. However, in practice, it means nothing. Cassandra is not a typical database which fits in every Big Data use case. ThoughtWorks warns in their <a href=\"https://www.thoughtworks.com/radar/platforms/cassandra-carefully\" class=\"cv bt lk ll lm ln\">Technology Radar</a>:</p>\n<blockquote class=\"mc md me\"><p id=\"6615\" class=\"lo lp dt mf lq b lr ls lt lu lv lw lx ly lz ma mb\">It’s a great tool and we like it, but too often we see teams run into trouble using it. We recommend using <strong class=\"lq na\">Cassandra carefully</strong>. Teams often misunderstand the use case for Cassandra, attempting to use it as a general-purpose data store when <strong class=\"lq na\">in fact it is optimized for fast reads on large data sets based on predefined keys</strong> or indexes. (…)</p></blockquote>\n<p id=\"8b24\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">So, be careful. Why? Let’s take a look at the next mistake.</p>\n<h2 id=\"c08f\" class=\"mi\">Mistake 2 — Let’s start from implementing a domain model (in Cassandra)</h2>\n<p id=\"9126\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">It’s a pretty common approach, to start from implementing the domain model in the database, right? In Cassandra’s case, it’s not that simple. You need to start with <strong class=\"lq na\">queries</strong>. Yes, you should know all important access patterns to data beforehand. You don’t? Maybe then, Cassandra is not (yet) for you. In many situations, projects may be startups, without fully known requirements. Cassandra usage in such situation is just risky, because later it may appear that it hasn’t really been a fit.</p>\n<p id=\"1fcf\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">The recommended <a href=\"https://ieeexplore.ieee.org/abstract/document/7207225/\" class=\"cv bt lk ll lm ln\">modeling methodology</a> includes a few steps:</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/7114/1*uAEHRrJb62xFfhY1WGpeaw.png\" width=\"3557\"><figcaption class=\"at dw lg lh hh df x y li lj ao cr\">Cassandra Modelling Methodology</figcaption></figure><p id=\"60c7\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">You need to start with two diagrams:</p>\n<ul class>\n<li id=\"d97f\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb nd ne nf\">Conceptual Data Model — in the form of a standard entity-relationship diagram</li>\n<li id=\"557e\" class=\"lo lp dt ap lq b lr ng lt nh lv ni lx nj lz nk mb nd ne nf\">Application Workflow — graph of all transitions in the application</li>\n</ul>\n<p id=\"a96d\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Then by applying specific mapping rules combine those graphs into a Logical Data Model represented by the Chebotko Diagram. It includes all views in the application together with data being presented on them and queries made to retrieve them.</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/3532/1*-gw6LjN0IR1z11CnwJh00w.png\" width=\"1766\"><figcaption class=\"at dw lg lh hh df x y li lj ao cr\">Chebotko Diagram</figcaption></figure><p id=\"9b4d\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">After optimizations, the Chebotko Diagram can be transformed into the Physical Data Model in CQL (Cassandra Query Language).</p>\n<h2 id=\"66b2\" class=\"mi\">Mistake 3 — We have that data, so we can query by it, right?</h2>\n<p id=\"3d41\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">No, unfortunately not. Let’s say that <code class=\"lb nn no np nq b\">Potato</code> table on the previous screen would contain a few dimension related columns and customer would like to add a filtering feature using those columns. In SQL that would be pretty simple, so why is that difficult here?</p>\n<ol class><li id=\"6572\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb nr ne nf\">Every row in Cassandra is identified by a primary key consisting of two parts:</li></ol>\n<ul class><li id=\"524d\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb nd ne nf\">partition key — defining location in the cluster. Partition key hash indicates on which node on the Cassandra cluster the partition is located</li></ul>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/1970/1*L_DOpIBTjl6UVjlH2CBmrw.png\" width=\"985\"><figcaption class=\"at dw lg lh hh df x y li lj ao cr\">Hash values are assigned to each Cassandra node</figcaption></figure><ul class><li id=\"2c54\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb nd ne nf\">clustering key — defining row location inside of the partition</li></ul>\n<p id=\"568a\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Queries by partition key or by partition key and clustering key are fast &amp; efficient. However those are usually equality comparisons (non-equality comparison can be performed only on the last part of clustering key), and the dimensions columns do not really fit the key.</p>\n<p id=\"112f\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">2. Secondary indexes offer equality comparisons as well, but they are not recommended due to poor performance. They are kept on each Cassandra node and to use them Cassandra needs to send the query to all nodes in the cluster.</p>\n<p id=\"da1d\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">3. Newer Cassandra versions allow usage of special keywords <code class=\"lb nn no np nq b\">allow filtering</code>. They indicate that you agree that the query may perform in-memory filtering, which is not efficient. It is highly not recommended to use those keywords in production.</p>\n<p id=\"37ae\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">4. Materialized views are not suitable for production</p>\n<p id=\"45bc\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">5. SSTable Attached Secondary Indexes (SASI) — improved secondary indexes. They could really work for dimensions filtering. However, e.g. DataStax, the company supporting Cassandra, still marks them as experimental and does not recommend for production usage.</p>\n<p id=\"cf36\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">As you can see simple filtering by a few numbers, which initially looks simple is not that simple in the Cassandra world!</p>\n<h2 id=\"1886\" class=\"mi\">Mistake 4 — Let’s add a new column with values based on other columns</h2>\n<p id=\"e6a0\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">In SQL you can always add a new column, and then execute a query similar to the following one:</p>\n<pre class=\"kq kr ks kt ku hf fh cg\"><span id=\"57e6\" class=\"nu mj dt ap nq b dw nv nw l nx\">UPDATE  table1 <br>SET     new_column = column1 + column2</span></pre>\n<p id=\"265d\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Simple sum of two other column values. Can we do this in Cassandra? Not really. CQL does not allow such operations. Generally, Cassandra does not allow any inefficient operation. Setting values for all rows in the table can be quite heavy when you have terabytes of data.</p>\n<p id=\"267b\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">So what can we do for schema changes and data migrations? Often you may need to write a separate data migrating application. Another choice is to use Apache Spark. It’s quite easy to define their input table, transformations, and schema of the new table which will be automatically created. Just remember that operating on TB of data may take a lot of time.</p>\n<h2 id=\"ba60\" class=\"mi\">Mistake 5— Wrong hardware</h2>\n<p id=\"8a25\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">People tend to choose less but bigger machines. Huge slow disks make the Compaction process longer.</p>\n<blockquote class=\"mc md me\">\n<p id=\"a79a\" class=\"lo lp dt mf lq b lr ls lt lu lv lw lx ly lz ma mb\">Compaction is about merging sstables, since partitions in sstables are sorted based on the hash of the partition key it is possible to efficiently merge separate sstables. Content of each partition is also sorted so each partition can be merged efficiently.</p>\n<p id=\"4732\" class=\"lo lp dt mf lq b lr ls lt lu lv lw lx ly lz ma mb\"><a href=\"http://cassandra.apache.org/doc/latest/operating/compaction.html\" class=\"cv bt lk ll lm ln\">http://cassandra.apache.org/doc/latest/operating/compaction.html</a></p>\n</blockquote>\n<p id=\"baca\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Assigning tons of RAM &amp; huge heap spaces also may increase Garbage Collection times. Remember that it may be better for you to have more smaller nodes, than few large ones. Take a look also at <a href=\"http://cassandra.apache.org/doc/latest/operating/hardware.html\" class=\"cv bt lk ll lm ln\">Apache </a>and <a href=\"https://docs.datastax.com/en/dse-planning/doc/planning/capacityPlanning.html\" class=\"cv bt lk ll lm ln\">DataStax </a>hardware recommendations.</p>\n<h2 id=\"7bbd\" class=\"mi\">Mistake 6 — Missing monitoring &amp; maintenance</h2>\n<p id=\"24f2\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">It is not enough, just to run the database and forget about it. You have to monitor cluster state, how replication works and others. However, the most important is to… run the repair process. In current versions, it is not run automatically, but it is greatly recommended, why? To avoid… rise of the zombies!</p>\n<p id=\"8985\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Let’s say that you have a cluster with replication factor 3 and consistency level quorum. Your row is stored on 3 nodes.</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/4302/1*42RUxnYPrzMC8g2zj8_hCA.png\" width=\"2151\"></figure><p id=\"50d8\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">And now you want to delete it. But wait, something went wrong, one of the nodes is not responding!</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/4138/1*kREk-xmirylF08ApLNvsig.png\" width=\"2069\"></figure><p id=\"e77a\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Let’s say that V2 means deleted row (with a tombstone). Application still has a correct view on the data, because the coordinator can return data from other copies, but what Cassandra can do now to achieve consistency?</p>\n<ol class>\n<li id=\"063b\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb nr ne nf\">Hinted handoff-when node is off by up to <code class=\"lb nn no np nq b\">max_hint_window_in_ms</code> the query coordinator will store operations for it. They would be reapplied after node is up. But let’s say our outage lasts longer.</li>\n<li id=\"2d58\" class=\"lo lp dt ap lq b lr ng lt nh lv ni lx nj lz nk mb nr ne nf\">Read repair-when data is read, with <code class=\"lb nn no np nq b\">read_repair_chance</code> probability, the coordinator will query all of the replicas and compare fetched data. This way client will get V2. But let’s say our row wasn’t queried and this mechanism couldn’t be applied.</li>\n</ol>\n<p id=\"4b9b\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">So what now? It gets worse! Tombstones are kept for <code class=\"lb nn no np nq b\">gc_grace_seconds</code> which is by default 10 days. What happens when after more than 10 days compaction will be run? Two old replicas will no longer have any idea that our row has ever existed.</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/1500/1*L7wRE1QGbnxVSTnANz03fg.png\" width=\"750\"></figure><p id=\"b12e\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">And now let’s say someone runs repair. The repair process has noticed that one node contains row which should appear on other replicas, result?</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/1488/1*_oH7NCA8Bvk6WETPa7gjJw.png\" width=\"744\"></figure><p id=\"36d8\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Our deleted row exists on all replicas! How to avoid that? Quite simply, run repairs more often than <code class=\"lb nn no np nq b\">gc_grace_seconds</code>, e.g. every 7 days. To get more detailed info on this process, take a look at “<a href=\"https://thelastpickle.com/blog/2016/07/27/about-deletes-and-tombstones.html\" class=\"cv bt lk ll lm ln\">About Deletes and Tombstones in Cassandra</a>” blogpost from The Last Pickle.</p>\n<h2 id=\"8391\" class=\"mi\">Mistake 7 — It’s so fast, let’s use it as a queue</h2>\n<p id=\"a458\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">Let’s say you have a table with short-lived tasks to be performed. Rows are often added and often deleted. Looks simple. However, in practice, this is the worst thing which can happen to Cassandra. SSTables are immutable. Delete is actually a write of a tombstone. This means that although your tasks table may be empty, the disk may be actually full! The only way to free space is to perform compaction, which, as said before, is using CPU and disk throughput. Finishing compaction does not guarantee that all tombstones are deleted. Depending on the algorithm, e.g. only tables with similar size are compacted together. If row A information is located in a large old SSTable and a tombstone is in some small fresh SSTable, this means they won’t be compacted together, and they may occupy disk for days or weeks.</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/3020/1*8BaIFHkTTh8VZ4OcYg8gTQ.png\" width=\"1510\"><figcaption class=\"at dw lg lh hh df x y li lj ao cr\">Tombstone may be located in table which won’t be compacted with original data</figcaption></figure><h2 id=\"7ff7\" class=\"mi\">Other mistakes</h2>\n<ul class>\n<li id=\"3c44\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb nd ne nf\">Let’s use external Load Balancer — Cassandra driver applies a client-side load balancing. External Load Balancer may become a Single Point of Failure.</li>\n<li id=\"a9db\" class=\"lo lp dt ap lq b lr ng lt nh lv ni lx nj lz nk mb nd ne nf\">Let’s use Cassandra as a search engine— having a lot of queries is very difficult to implement in Cassandra. A search engine would be just difficult and expensive to achieve.</li>\n<li id=\"8674\" class=\"lo lp dt ap lq b lr ng lt nh lv ni lx nj lz nk mb nd ne nf\">Let’s use Cassandra as a filestore — Cassandra does not like too big rows. If you want to store big files, then you need to split them into multiple parts. You may also just consider using some dedicated file storages, like e.g. <a href=\"https://ceph.io/\" class=\"cv bt lk ll lm ln\">Ceph</a>.</li>\n</ul>\n<p id=\"535b\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">Apache Cassandra is not the easiest database to learn on the market. You need to take a thoughtful decision about its usage in your project. Be careful-check if Cassandra is really a database for you. Start from analyzing your domain form the perspective of the queries. Remember that there are no full transactions here. If all of the tradeoffs are acceptable then choose the right environment for the deployment. Keep away from too large disks. Avoid deletes in your application (or if possible even updates). Also remember to monitor the cluster, keep it healthy and run the repairs.</p>\n<p id=\"daba\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">When Cassandra works the best? In append-only scenarios, like time-series data or Event Sourcing architecture (e.g. based on Akka Persistence).</p>\n<p id=\"72e3\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Be careful, it’s not a general-purpose database.</p>\n</div></section></div><hr><h4>Page 2</h4><div><section class=\"jd je jf jg jh\"><div class=\"ae ji ab df v w\">\n<div><div class=\"ju\"><div class=\"ag af\">\n<div><a href=\"https://blog.softwaremill.com/@mmatloka?source=post_page-----51d2cf6df519----------------------\"><img alt=\"Michał Matłoka\" class=\"l fn jv jw\" src=\"https://miro.medium.com/fit/c/96/96/1*9Y66P19rQG9D7hsovL9yWA.png\" width=\"48\"></a></div>\n<div class=\"jx ab l\"><span class=\"ao b ap aq ar as l at au\"><span class=\"ao cr dw aq bx ka dy dz kb eb at\"></span></span></div>\n</div></div></div>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/3840/1*weN2UFi722K2B_xtg7CU3g.jpeg\" width=\"1920\"><figcaption class=\"at dw lg lh hh df x y li lj ao cr\">Photo by <a href=\"https://unsplash.com/@rojekilian?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\" class=\"cv bt lk ll lm ln\">Sarah Kilian</a> on <a href=\"https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText\" class=\"cv bt lk ll lm ln\">Unsplash</a></figcaption></figure><p id=\"4175\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\"><a href=\"http://cassandra.apache.org/\" class=\"cv bt lk ll lm ln\">Apache Cassandra</a> is one of the most popular NoSQL databases. It offers great performance and scalability without sacrificing availability. It has no <a href=\"https://en.wikipedia.org/wiki/Single_point_of_failure\" class=\"cv bt lk ll lm ln\">Single Point of Failure (SPOF)</a>. The biggest, publicly announced cluster contains over 115k nodes and over 10PB of data. However, Cassandra data format differs from what you got used to in the SQL world. There are tables with special keys but without relations. What is the most important, it is not possible to query data using any arbitrary column. Cassandra is not perfect for every project, there are many mistakes which can be made when working with it. Let’s analyze a few of them.</p>\n<blockquote class=\"mc md me\"><p id=\"b565\" class=\"lo lp dt mf lq b lr ls lt lu lv lw lx ly lz ma mb\">Note: This blogpost is based on my presentation: Cassandra — How to fail?</p></blockquote>\n<figure class=\"kq kr ks kt ku et\"></figure><h2 id=\"0a17\" class=\"mi\">Mistake 1 — We will have a lot of data, Cassandra worked for others, so let’s use it</h2>\n<p id=\"f4a5\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">We’ve already heard people saying “we will have a lot of data”, “it worked for Apple” or “it worked for Walmart”. However, in practice, it means nothing. Cassandra is not a typical database which fits in every Big Data use case. ThoughtWorks warns in their <a href=\"https://www.thoughtworks.com/radar/platforms/cassandra-carefully\" class=\"cv bt lk ll lm ln\">Technology Radar</a>:</p>\n<blockquote class=\"mc md me\"><p id=\"6615\" class=\"lo lp dt mf lq b lr ls lt lu lv lw lx ly lz ma mb\">It’s a great tool and we like it, but too often we see teams run into trouble using it. We recommend using <strong class=\"lq na\">Cassandra carefully</strong>. Teams often misunderstand the use case for Cassandra, attempting to use it as a general-purpose data store when <strong class=\"lq na\">in fact it is optimized for fast reads on large data sets based on predefined keys</strong> or indexes. (…)</p></blockquote>\n<p id=\"8b24\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">So, be careful. Why? Let’s take a look at the next mistake.</p>\n<h2 id=\"c08f\" class=\"mi\">Mistake 2 — Let’s start from implementing a domain model (in Cassandra)</h2>\n<p id=\"9126\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">It’s a pretty common approach, to start from implementing the domain model in the database, right? In Cassandra’s case, it’s not that simple. You need to start with <strong class=\"lq na\">queries</strong>. Yes, you should know all important access patterns to data beforehand. You don’t? Maybe then, Cassandra is not (yet) for you. In many situations, projects may be startups, without fully known requirements. Cassandra usage in such situation is just risky, because later it may appear that it hasn’t really been a fit.</p>\n<p id=\"1fcf\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">The recommended <a href=\"https://ieeexplore.ieee.org/abstract/document/7207225/\" class=\"cv bt lk ll lm ln\">modeling methodology</a> includes a few steps:</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/7114/1*uAEHRrJb62xFfhY1WGpeaw.png\" width=\"3557\"><figcaption class=\"at dw lg lh hh df x y li lj ao cr\">Cassandra Modelling Methodology</figcaption></figure><p id=\"60c7\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">You need to start with two diagrams:</p>\n<ul class>\n<li id=\"d97f\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb nd ne nf\">Conceptual Data Model — in the form of a standard entity-relationship diagram</li>\n<li id=\"557e\" class=\"lo lp dt ap lq b lr ng lt nh lv ni lx nj lz nk mb nd ne nf\">Application Workflow — graph of all transitions in the application</li>\n</ul>\n<p id=\"a96d\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Then by applying specific mapping rules combine those graphs into a Logical Data Model represented by the Chebotko Diagram. It includes all views in the application together with data being presented on them and queries made to retrieve them.</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/3532/1*-gw6LjN0IR1z11CnwJh00w.png\" width=\"1766\"><figcaption class=\"at dw lg lh hh df x y li lj ao cr\">Chebotko Diagram</figcaption></figure><p id=\"9b4d\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">After optimizations, the Chebotko Diagram can be transformed into the Physical Data Model in CQL (Cassandra Query Language).</p>\n<h2 id=\"66b2\" class=\"mi\">Mistake 3 — We have that data, so we can query by it, right?</h2>\n<p id=\"3d41\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">No, unfortunately not. Let’s say that <code class=\"lb nn no np nq b\">Potato</code> table on the previous screen would contain a few dimension related columns and customer would like to add a filtering feature using those columns. In SQL that would be pretty simple, so why is that difficult here?</p>\n<ol class><li id=\"6572\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb nr ne nf\">Every row in Cassandra is identified by a primary key consisting of two parts:</li></ol>\n<ul class><li id=\"524d\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb nd ne nf\">partition key — defining location in the cluster. Partition key hash indicates on which node on the Cassandra cluster the partition is located</li></ul>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/1970/1*L_DOpIBTjl6UVjlH2CBmrw.png\" width=\"985\"><figcaption class=\"at dw lg lh hh df x y li lj ao cr\">Hash values are assigned to each Cassandra node</figcaption></figure><ul class><li id=\"2c54\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb nd ne nf\">clustering key — defining row location inside of the partition</li></ul>\n<p id=\"568a\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Queries by partition key or by partition key and clustering key are fast &amp; efficient. However those are usually equality comparisons (non-equality comparison can be performed only on the last part of clustering key), and the dimensions columns do not really fit the key.</p>\n<p id=\"112f\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">2. Secondary indexes offer equality comparisons as well, but they are not recommended due to poor performance. They are kept on each Cassandra node and to use them Cassandra needs to send the query to all nodes in the cluster.</p>\n<p id=\"da1d\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">3. Newer Cassandra versions allow usage of special keywords <code class=\"lb nn no np nq b\">allow filtering</code>. They indicate that you agree that the query may perform in-memory filtering, which is not efficient. It is highly not recommended to use those keywords in production.</p>\n<p id=\"37ae\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">4. Materialized views are not suitable for production</p>\n<p id=\"45bc\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">5. SSTable Attached Secondary Indexes (SASI) — improved secondary indexes. They could really work for dimensions filtering. However, e.g. DataStax, the company supporting Cassandra, still marks them as experimental and does not recommend for production usage.</p>\n<p id=\"cf36\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">As you can see simple filtering by a few numbers, which initially looks simple is not that simple in the Cassandra world!</p>\n<h2 id=\"1886\" class=\"mi\">Mistake 4 — Let’s add a new column with values based on other columns</h2>\n<p id=\"e6a0\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">In SQL you can always add a new column, and then execute a query similar to the following one:</p>\n<pre class=\"kq kr ks kt ku hf fh cg\"><span id=\"57e6\" class=\"nu mj dt ap nq b dw nv nw l nx\">UPDATE  table1 <br>SET     new_column = column1 + column2</span></pre>\n<p id=\"265d\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Simple sum of two other column values. Can we do this in Cassandra? Not really. CQL does not allow such operations. Generally, Cassandra does not allow any inefficient operation. Setting values for all rows in the table can be quite heavy when you have terabytes of data.</p>\n<p id=\"267b\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">So what can we do for schema changes and data migrations? Often you may need to write a separate data migrating application. Another choice is to use Apache Spark. It’s quite easy to define their input table, transformations, and schema of the new table which will be automatically created. Just remember that operating on TB of data may take a lot of time.</p>\n<h2 id=\"ba60\" class=\"mi\">Mistake 5— Wrong hardware</h2>\n<p id=\"8a25\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">People tend to choose less but bigger machines. Huge slow disks make the Compaction process longer.</p>\n<blockquote class=\"mc md me\">\n<p id=\"a79a\" class=\"lo lp dt mf lq b lr ls lt lu lv lw lx ly lz ma mb\">Compaction is about merging sstables, since partitions in sstables are sorted based on the hash of the partition key it is possible to efficiently merge separate sstables. Content of each partition is also sorted so each partition can be merged efficiently.</p>\n<p id=\"4732\" class=\"lo lp dt mf lq b lr ls lt lu lv lw lx ly lz ma mb\"><a href=\"http://cassandra.apache.org/doc/latest/operating/compaction.html\" class=\"cv bt lk ll lm ln\">http://cassandra.apache.org/doc/latest/operating/compaction.html</a></p>\n</blockquote>\n<p id=\"baca\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Assigning tons of RAM &amp; huge heap spaces also may increase Garbage Collection times. Remember that it may be better for you to have more smaller nodes, than few large ones. Take a look also at <a href=\"http://cassandra.apache.org/doc/latest/operating/hardware.html\" class=\"cv bt lk ll lm ln\">Apache </a>and <a href=\"https://docs.datastax.com/en/dse-planning/doc/planning/capacityPlanning.html\" class=\"cv bt lk ll lm ln\">DataStax </a>hardware recommendations.</p>\n<h2 id=\"7bbd\" class=\"mi\">Mistake 6 — Missing monitoring &amp; maintenance</h2>\n<p id=\"24f2\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">It is not enough, just to run the database and forget about it. You have to monitor cluster state, how replication works and others. However, the most important is to… run the repair process. In current versions, it is not run automatically, but it is greatly recommended, why? To avoid… rise of the zombies!</p>\n<p id=\"8985\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Let’s say that you have a cluster with replication factor 3 and consistency level quorum. Your row is stored on 3 nodes.</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/4302/1*42RUxnYPrzMC8g2zj8_hCA.png\" width=\"2151\"></figure><p id=\"50d8\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">And now you want to delete it. But wait, something went wrong, one of the nodes is not responding!</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/4138/1*kREk-xmirylF08ApLNvsig.png\" width=\"2069\"></figure><p id=\"e77a\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Let’s say that V2 means deleted row (with a tombstone). Application still has a correct view on the data, because the coordinator can return data from other copies, but what Cassandra can do now to achieve consistency?</p>\n<ol class>\n<li id=\"063b\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb nr ne nf\">Hinted handoff-when node is off by up to <code class=\"lb nn no np nq b\">max_hint_window_in_ms</code> the query coordinator will store operations for it. They would be reapplied after node is up. But let’s say our outage lasts longer.</li>\n<li id=\"2d58\" class=\"lo lp dt ap lq b lr ng lt nh lv ni lx nj lz nk mb nr ne nf\">Read repair-when data is read, with <code class=\"lb nn no np nq b\">read_repair_chance</code> probability, the coordinator will query all of the replicas and compare fetched data. This way client will get V2. But let’s say our row wasn’t queried and this mechanism couldn’t be applied.</li>\n</ol>\n<p id=\"4b9b\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">So what now? It gets worse! Tombstones are kept for <code class=\"lb nn no np nq b\">gc_grace_seconds</code> which is by default 10 days. What happens when after more than 10 days compaction will be run? Two old replicas will no longer have any idea that our row has ever existed.</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/1500/1*L7wRE1QGbnxVSTnANz03fg.png\" width=\"750\"></figure><p id=\"b12e\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">And now let’s say someone runs repair. The repair process has noticed that one node contains row which should appear on other replicas, result?</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/1488/1*_oH7NCA8Bvk6WETPa7gjJw.png\" width=\"744\"></figure><p id=\"36d8\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Our deleted row exists on all replicas! How to avoid that? Quite simply, run repairs more often than <code class=\"lb nn no np nq b\">gc_grace_seconds</code>, e.g. every 7 days. To get more detailed info on this process, take a look at “<a href=\"https://thelastpickle.com/blog/2016/07/27/about-deletes-and-tombstones.html\" class=\"cv bt lk ll lm ln\">About Deletes and Tombstones in Cassandra</a>” blogpost from The Last Pickle.</p>\n<h2 id=\"8391\" class=\"mi\">Mistake 7 — It’s so fast, let’s use it as a queue</h2>\n<p id=\"a458\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">Let’s say you have a table with short-lived tasks to be performed. Rows are often added and often deleted. Looks simple. However, in practice, this is the worst thing which can happen to Cassandra. SSTables are immutable. Delete is actually a write of a tombstone. This means that although your tasks table may be empty, the disk may be actually full! The only way to free space is to perform compaction, which, as said before, is using CPU and disk throughput. Finishing compaction does not guarantee that all tombstones are deleted. Depending on the algorithm, e.g. only tables with similar size are compacted together. If row A information is located in a large old SSTable and a tombstone is in some small fresh SSTable, this means they won’t be compacted together, and they may occupy disk for days or weeks.</p>\n<figure class=\"kq kr ks kt ku et x y paragraph-image\"><img alt class=\"gg n o gf ab\" src=\"https://miro.medium.com/max/3020/1*8BaIFHkTTh8VZ4OcYg8gTQ.png\" width=\"1510\"><figcaption class=\"at dw lg lh hh df x y li lj ao cr\">Tombstone may be located in table which won’t be compacted with original data</figcaption></figure><h2 id=\"7ff7\" class=\"mi\">Other mistakes</h2>\n<ul class>\n<li id=\"3c44\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb nd ne nf\">Let’s use external Load Balancer — Cassandra driver applies a client-side load balancing. External Load Balancer may become a Single Point of Failure.</li>\n<li id=\"a9db\" class=\"lo lp dt ap lq b lr ng lt nh lv ni lx nj lz nk mb nd ne nf\">Let’s use Cassandra as a search engine— having a lot of queries is very difficult to implement in Cassandra. A search engine would be just difficult and expensive to achieve.</li>\n<li id=\"8674\" class=\"lo lp dt ap lq b lr ng lt nh lv ni lx nj lz nk mb nd ne nf\">Let’s use Cassandra as a filestore — Cassandra does not like too big rows. If you want to store big files, then you need to split them into multiple parts. You may also just consider using some dedicated file storages, like e.g. <a href=\"https://ceph.io/\" class=\"cv bt lk ll lm ln\">Ceph</a>.</li>\n</ul>\n<p id=\"535b\" class=\"lo lp dt ap lq b lr mv lt mw lv mx lx my lz mz mb\">Apache Cassandra is not the easiest database to learn on the market. You need to take a thoughtful decision about its usage in your project. Be careful-check if Cassandra is really a database for you. Start from analyzing your domain form the perspective of the queries. Remember that there are no full transactions here. If all of the tradeoffs are acceptable then choose the right environment for the deployment. Keep away from too large disks. Avoid deletes in your application (or if possible even updates). Also remember to monitor the cluster, keep it healthy and run the repairs.</p>\n<p id=\"daba\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">When Cassandra works the best? In append-only scenarios, like time-series data or Event Sourcing architecture (e.g. based on Akka Persistence).</p>\n<p id=\"72e3\" class=\"lo lp dt ap lq b lr ls lt lu lv lw lx ly lz ma mb\">Be careful, it’s not a general-purpose database.</p>\n</div></section></div>",
    "url": "https://blog.softwaremill.com/7-mistakes-when-using-apache-cassandra-51d2cf6df519",
    "published": "2019-09-05T06:21:48.863000Z",
    "created_at": "2019-09-25T03:27:03.455629Z",
    "original": null,
    "twitter_id": null,
    "twitter_thread_ids": [],
    "extracted_content_url": "https://extract.feedbin.com/parser/feedbin/dcd546f5a39bc573146188e73e7d808db39647e6?base64_url=aHR0cHM6Ly9ibG9nLnNvZnR3YXJlbWlsbC5jb20vNy1taXN0YWtlcy13aGVuLXVzaW5nLWFwYWNoZS1jYXNzYW5kcmEtNTFkMmNmNmRmNTE5",
    "images": {
      "original_url": "https://miro.medium.com/max/3840/1*weN2UFi722K2B_xtg7CU3g.jpeg",
      "size_1": {
        "cdn_url": "https://images.feedbinusercontent.com/c10b8bd/c10b8bde470a4e1049e41190f53d3a6a0d39d686.jpg",
        "width": 542,
        "height": 304
      }
    },
    "enclosure": null,
    "extracted_articles": [],
    "json_feed": null
  },
  {
    "id": 2215845762,
    "feed_id": 1658782,
    "title": "How Yelp uses Flink for predicting store visits in real time",
    "author": null,
    "summary": "I recently presented at Flink Forward San Francisco 2019 and showcased how the User Location Intelligence team at Yelp uses Apache Flink for predicting real-time store visits. In the following sections, I will give an overview of our stream processing",
    "content": "<div id=\"hs_cos_wrapper_post_body\" class=\"hs_cos_wrapper\">\n<p>I recently presented at <a href=\"https://www.flink-forward.org/\">Flink Forward</a> San Francisco 2019 and showcased how the User Location Intelligence team at <a href=\"https://www.yelp.com/\">Yelp</a> uses <a href=\"https://flink.apache.org/\">Apache Flink</a> for predicting real-time store visits. In the following sections, I will give an overview of our stream processing journey with Flink, describing the product that we built, the algorithms that we used to resolve specific problems and how Flink enabled us to overcome some limitations we faced with our legacy systems and code execution. Let’s first showcase the product that we built based on Flink. </p> <h2><span>Real-time store visits prediction at Yelp</span></h2>\n<p>Yelp’s mission is to connect people with great local businesses and part of what the Yelp Engineering team does is build products and experiences to help our users find, connect and interact with those businesses on the Yelp app.</p>\n<p>To do that, we built a new mobile notification with the primary objective to inform and suggest the best nearby local businesses to Yelp users. As simple as it might sound, this feature requires a lot of background work to ensure that any push notification sent to a user is timely and relevant. </p>\n<p>The product requires <strong>low latency data processing</strong> since any communication with the user should take place while the user is in close proximity to these local stores. That, in turn, provides great response rates and ensures an optimal user experience. At the same time, notifications need to be relevant and tailored to the specific user, at this designated place in the specific moment to ensure that any recommendation is personalized for the user and their current and previous interaction with the Yelp app. To accomplish this, we built a <strong>Machine Learning model</strong> tightly <strong>coupled with a Flink stream processing application</strong>. </p>\n<p>One important thing to note about the product is that notifications are only sent to users who explicitly share their location data with Yelp. Users can choose between sharing their location data or not and can easily update their preferences and user settings on the Yelp app at any time. </p>\n<p><img src=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-notification.png?width=286&amp;name=Yelp-realtime%20store%20predictions-notification.png\" alt=\"Yelp-realtime store predictions-notification\" width=\"286\" srcset=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-notification.png?width=143&amp;name=Yelp-realtime%20store%20predictions-notification.png 143w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-notification.png?width=286&amp;name=Yelp-realtime%20store%20predictions-notification.png 286w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-notification.png?width=429&amp;name=Yelp-realtime%20store%20predictions-notification.png 429w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-notification.png?width=572&amp;name=Yelp-realtime%20store%20predictions-notification.png 572w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-notification.png?width=715&amp;name=Yelp-realtime%20store%20predictions-notification.png 715w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-notification.png?width=858&amp;name=Yelp-realtime%20store%20predictions-notification.png 858w\" sizes=\"(max-width: 286px) 100vw, 286px\"></p>\n<p>Let’s now look at our data input and how we process it to enable real-time store predictions at Yelp. As illustrated in the following picture,  our input data consists of geospatial location data from mobile devices of Yelp users. In order to make sense of the data, we need to first determine whether there is an ongoing user visit (as illustrated within the blue circle where various samples from the same device are in close proximity to each other at a selected timeframe). Once we have determined a visit (or stopover), we use a Machine Learning algorithm to rank and predict the best candidate business nearby and finally send timely notifications with suggestions to Yelp users.</p> <p><img src=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-nearby%20places-1.png?width=568&amp;name=Yelp-realtime%20store%20predictions-nearby%20places-1.png\" alt=\"Yelp-realtime store predictions-nearby places-1\" width=\"568\" srcset=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-nearby%20places-1.png?width=284&amp;name=Yelp-realtime%20store%20predictions-nearby%20places-1.png 284w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-nearby%20places-1.png?width=568&amp;name=Yelp-realtime%20store%20predictions-nearby%20places-1.png 568w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-nearby%20places-1.png?width=852&amp;name=Yelp-realtime%20store%20predictions-nearby%20places-1.png 852w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-nearby%20places-1.png?width=1136&amp;name=Yelp-realtime%20store%20predictions-nearby%20places-1.png 1136w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-nearby%20places-1.png?width=1420&amp;name=Yelp-realtime%20store%20predictions-nearby%20places-1.png 1420w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-nearby%20places-1.png?width=1704&amp;name=Yelp-realtime%20store%20predictions-nearby%20places-1.png 1704w\" sizes=\"(max-width: 568px) 100vw, 568px\"></p>\n<p>The user's store visit is predicted in real-time leveraging a XGBoost Machine Learning Model that is trained to match businesses given the specific locations and users.</p> <h2><span>System Overview</span></h2>\n<p>Our system overview includes the <strong>Yelp Data Pipeline</strong> ingesting tens of thousands of pings per second into the Flink job for real-time clustering. Our clustering bundles raw location data into visits that will be linked to business IDs later on. Flink delegates the Machine Learning inference to an external Python service using <strong>Flink’s Async I/O</strong> in combination with <span>scala_dispatch</span> — for efficient execution of HTTP calls. The online model will then return the predictions back to Flink which sends them downstream as “store visits” for other teams to use.</p>\n<p><img src=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-Flink%20clustering-1.png?width=600&amp;name=Yelp-realtime%20store%20predictions-Flink%20clustering-1.png\" alt=\"Yelp-realtime store predictions-Flink clustering-1\" width=\"600\" srcset=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-Flink%20clustering-1.png?width=300&amp;name=Yelp-realtime%20store%20predictions-Flink%20clustering-1.png 300w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-Flink%20clustering-1.png?width=600&amp;name=Yelp-realtime%20store%20predictions-Flink%20clustering-1.png 600w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-Flink%20clustering-1.png?width=900&amp;name=Yelp-realtime%20store%20predictions-Flink%20clustering-1.png 900w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-Flink%20clustering-1.png?width=1200&amp;name=Yelp-realtime%20store%20predictions-Flink%20clustering-1.png 1200w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-Flink%20clustering-1.png?width=1500&amp;name=Yelp-realtime%20store%20predictions-Flink%20clustering-1.png 1500w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-Flink%20clustering-1.png?width=1800&amp;name=Yelp-realtime%20store%20predictions-Flink%20clustering-1.png 1800w\" sizes=\"(max-width: 600px) 100vw, 600px\"></p>\n<p>For data clustering, we customize Flink’s <strong><span><a href=\"https://ci.apache.org/projects/flink/flink-docs-stable/dev/stream/operators/windows.html#processwindowfunction\">ProcessWindowFunction</a></span></strong> and utilize a <span>GlobalWindow</span> keyed by “<span>user_id</span>” to continuously analyze pairs of consecutive pings from the same user as shown in the diagram below. Using stateful operations in Flink, we assign each new ping to the <span>GlobalWindow</span>, we evict the old ping and run the clustering to detect when the new ping refers to an arrival, a visit, or a departure from a local store. </p>\n<p><img src=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20visits.png?width=600&amp;name=Yelp-realtime%20store%20predictions%20-%20visits.png\" alt=\"Yelp-realtime store predictions - visits\" width=\"600\" srcset=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20visits.png?width=300&amp;name=Yelp-realtime%20store%20predictions%20-%20visits.png 300w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20visits.png?width=600&amp;name=Yelp-realtime%20store%20predictions%20-%20visits.png 600w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20visits.png?width=900&amp;name=Yelp-realtime%20store%20predictions%20-%20visits.png 900w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20visits.png?width=1200&amp;name=Yelp-realtime%20store%20predictions%20-%20visits.png 1200w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20visits.png?width=1500&amp;name=Yelp-realtime%20store%20predictions%20-%20visits.png 1500w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20visits.png?width=1800&amp;name=Yelp-realtime%20store%20predictions%20-%20visits.png 1800w\" sizes=\"(max-width: 600px) 100vw, 600px\"></p>\n<h2> </h2>\n<h2><span>Handling time and out-of-order data</span></h2>\n<p>One of the biggest <strong>challenges</strong> in building this product feature was <strong>handling time</strong> and dealing with <strong>out-of-order or late data</strong>. Mobile devices showcase a very particular behavior in that they are far from the backend, can go offline for hours or even days and have mobile clocks that can be set up incorrectly. Flink’s ability to handle different notions of time (event, ingestion or processing time) at once simplified our approach significantly. The team developed a <span>LatePingEvictor</span> that prevents any late arriving ping to see the global window as illustrated in the diagram below. Using Flink’s <span>GlobalWindow, Evictors</span> and <span>ProcessWindowFunction</span>, we can see if the event time of a ping is later than the one of the previous to evict it and exclude it from  the clustering. </p>\n<p><img src=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png?width=600&amp;name=Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png\" alt=\"Yelp-realtime store predictions - LatePingEvictor\" width=\"600\" srcset=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png?width=300&amp;name=Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png 300w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png?width=600&amp;name=Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png 600w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png?width=900&amp;name=Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png 900w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png?width=1200&amp;name=Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png 1200w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png?width=1500&amp;name=Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png 1500w, https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png?width=1800&amp;name=Yelp-realtime%20store%20predictions%20-%20LatePingEvictor.png 1800w\" sizes=\"(max-width: 600px) 100vw, 600px\"></p>\n<h2> </h2>\n<h2><span>Why we chose Flink </span></h2>\n<p>To understand why we chose Flink and the features that turned Flink into an absolute breakthrough for us, let’s first discuss our legacy systems and operations. Firstly, before migrating to Flink, the team was heavily reliant on <strong>Amazon SQS</strong> as a queue processing mechanism. Amazon SQS does not support state so the team had to work off a fragile, in-house-built state that could not support our use case. With the use of <strong><a href=\"https://ci.apache.org/projects/flink/flink-docs-stable/dev/stream/state/state.html\">Flink’s stateful computations</a></strong> we could easily retain in Flink state the past (arrival) ping, necessary to successfully run the clustering algorithm — something hard to accomplish with the previous technology. </p>\n<p>Secondly, Flink provides <strong>low latency and high throughput</strong> computation, something that is a must-have for our application. Prior to the migration, the team was operating on an abstraction layer on top of SQS, executed with Python. Due to Python’s global interpreter lock, concurrency and parallelism are very limited. We tried to increment the processing instances, but having so many instances meant it was very hard to find resources by our <a href=\"https://engineeringblog.yelp.com/2015/11/introducing-paasta-an-open-platform-as-a-service.html\">container management system PaaSTA</a> that made our deployments take hours to complete. Flink’s low latency, high throughput architecture is a great fit for the time-sensitive and real-time elements of our product. </p>\n<p>Finally, Amazon SQS provides <strong>at-least-once guarantees</strong> that is <strong>incompatible</strong> with our use case since having duplicate pushes in the output stream could lead to duplicate push notifications to the user resulting in negative user experience. Flink’s exactly-once semantics guarantee that our use case leads to superior user experience as each notification will only be sent once to the user. </p>\n<p>Looking closer at the impact that Apache Flink had in our development process, we observed the following: Using Flink resulted in 10X increase in visits recall, being able to scale our Machine Learning predictions to thousands per second, decreasing our operations from hundreds of Python instances down to 14 Flink instances and finally being 5X more cost-efficient compared to our previous technology stack.</p>\n<p><img src=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-why%20we%20chose%20Flink.png?width=600&amp;name=Yelp-realtime%20store%20predictions-why%20we%20chose%20Flink.png\" alt=\"Yelp-realtime store predictions-why we chose Flink\" width=\"600\" srcset=\"https://www.ververica.com/hs-fs/hubfs/Yelp-realtime%20store%20predictions-why%20we%20chose%20Flink.png?width=600&amp;name=Yelp-realtime%20store%20predictions-why%20we%20chose%20Flink.png\" sizes=\"(max-width: 600px) 100vw, 600px\"></p>\n<p>The overall experience with Flink was very positive, the communication with the community and the mailing lists were very friendly and welcoming and I can only recommend Flink for similar use cases to ours. If you want to find out more about our use case and our journey with Apache Flink, you can access my <a href=\"https://www.ververica.com/resources/flink-forward-san-francisco-2019/realtime-store-visit-predictions-at-scale\">Flink Forward presentation</a> below or even hear more news about how Yelp is using Flink in the upcoming <a href=\"https://europe-2019.flink-forward.org/conference-program\">Flink Forward Europe 2019</a> event, this October in Berlin.</p>\n<p><a href=\"https://www.youtube.com/watch?v=1J2ERNudLik&amp;list=PLDX4T_cnKjD1ida8K59YPR3lfWOq6IhV_&amp;index=27&amp;t=0s\"><img src=\"https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-View-presentation.png?width=300&amp;name=%5B2019-02%5D-View-presentation.png\" alt=\"[2019-02]-View-presentation\" width=\"300\" srcset=\"https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-View-presentation.png?width=150&amp;name=%5B2019-02%5D-View-presentation.png 150w, https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-View-presentation.png?width=300&amp;name=%5B2019-02%5D-View-presentation.png 300w, https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-View-presentation.png?width=450&amp;name=%5B2019-02%5D-View-presentation.png 450w, https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-View-presentation.png?width=600&amp;name=%5B2019-02%5D-View-presentation.png 600w, https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-View-presentation.png?width=750&amp;name=%5B2019-02%5D-View-presentation.png 750w, https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-View-presentation.png?width=900&amp;name=%5B2019-02%5D-View-presentation.png 900w\" sizes=\"(max-width: 300px) 100vw, 300px\"></a><a href=\"https://www.ververica.com/contact\"><img src=\"https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-Contact-us.png?width=300&amp;name=%5B2019-02%5D-Contact-us.png\" alt=\"[2019-02]-Contact-us\" width=\"300\" srcset=\"https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-Contact-us.png?width=150&amp;name=%5B2019-02%5D-Contact-us.png 150w, https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-Contact-us.png?width=300&amp;name=%5B2019-02%5D-Contact-us.png 300w, https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-Contact-us.png?width=450&amp;name=%5B2019-02%5D-Contact-us.png 450w, https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-Contact-us.png?width=600&amp;name=%5B2019-02%5D-Contact-us.png 600w, https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-Contact-us.png?width=750&amp;name=%5B2019-02%5D-Contact-us.png 750w, https://www.ververica.com/hs-fs/hubfs/%5B2019-02%5D-Contact-us.png?width=900&amp;name=%5B2019-02%5D-Contact-us.png 900w\" sizes=\"(max-width: 300px) 100vw, 300px\"></a></p> <p><span><strong>About the author: </strong></span></p>\n<p><span><strong><img src=\"https://www.ververica.com/hs-fs/hubfs/image5.jpg?width=146&amp;name=image5.jpg\" alt=\"image5\" width=\"146\" srcset=\"https://www.ververica.com/hs-fs/hubfs/image5.jpg?width=73&amp;name=image5.jpg 73w, https://www.ververica.com/hs-fs/hubfs/image5.jpg?width=146&amp;name=image5.jpg 146w, https://www.ververica.com/hs-fs/hubfs/image5.jpg?width=219&amp;name=image5.jpg 219w, https://www.ververica.com/hs-fs/hubfs/image5.jpg?width=292&amp;name=image5.jpg 292w, https://www.ververica.com/hs-fs/hubfs/image5.jpg?width=365&amp;name=image5.jpg 365w, https://www.ververica.com/hs-fs/hubfs/image5.jpg?width=438&amp;name=image5.jpg 438w\" sizes=\"(max-width: 146px) 100vw, 146px\"></strong></span></p>\n<p>Luca works as a Software Engineer on the Core Machine Learning team at Yelp. He was previously at Yelp’s User Location Intelligence team where part of his job involved data mining massive data sets at Yelp. He was also responsible for designing and scaling the backend for analyzing high-volume geospatial data from millions of Yelp’s mobile users. He was previously the main open source contributor to Yelp’s asynchronous client Fido.</p>\n</div>",
    "url": "https://www.ververica.com/blog/how-yelp-uses-flink-for-predicting-store-visits-in-real-time",
    "published": "2019-09-25T03:26:30.547093Z",
    "created_at": "2019-09-25T03:26:30.550046Z",
    "original": null,
    "twitter_id": null,
    "twitter_thread_ids": [],
    "extracted_content_url": "https://extract.feedbin.com/parser/feedbin/69db6e4044c30254e9148fab7aab6bff195e1057?base64_url=aHR0cHM6Ly93d3cudmVydmVyaWNhLmNvbS9ibG9nL2hvdy15ZWxwLXVzZXMtZmxpbmstZm9yLXByZWRpY3Rpbmctc3RvcmUtdmlzaXRzLWluLXJlYWwtdGltZQ==",
    "images": null,
    "enclosure": null,
    "extracted_articles": [],
    "json_feed": null
  },
  {
    "id": 2215845159,
    "feed_id": 1658782,
    "title": "A case study about compression and binary formats for a REST service",
    "author": "Juliano Julio Costa",
    "summary": "Juliano Julio Costa A couple of years ago, back when I was working at Expedia, I came across a very peculiar project. It had large requests, tiny responses, and response times were meant to be very fast. You may have indirectly used this service if you",
    "content": "<div><section class=\"cz da db dc dd\"><div class=\"de x\"><figure class=\"df de x paragraph-image\"><img alt=\"An airplane taking off on a sunset\" class=\"cu n o di x\" src=\"https://miro.medium.com/max/2560/1*tYXl7ofI2L0-180P0oF8Wg.png\" width=\"1280\"></figure></div>\n<div class=\"y du x cs cq cr\">\n<div><div class=\"eh\"><div class=\"as ar\">\n<div><a href=\"https://medium.com/@julianojuliocosta?source=post_page-----7de9c4535cb8----------------------\"><img alt=\"Juliano Julio Costa\" class=\"l ei ej ek\" src=\"https://miro.medium.com/fit/c/96/96/2*s3uiIsnL1VTGPM82gvfmRg.jpeg\" width=\"48\"></a></div>\n<div class=\"el x l\">\n<div class=\"ar\"><div><span class=\"br b bs bt bu bv l dx ax\"><div class=\"em ar as en\"><span class=\"br eo ep bt dj eq er es et eu dx\"><a class=\"bb bc bd be bf bg bh bi bj bk ev bn bo bp bq\" href=\"https://medium.com/@julianojuliocosta?source=post_page-----7de9c4535cb8----------------------\">Juliano Julio Costa</a></span></div></span></div></div>\n<span class=\"br b bs bt bu bv l bw bx\"><span class=\"br eo ep bt dj eq er es et eu bw\"></span></span>\n</div>\n</div></div></div>\n<p id=\"8f4a\" class=\"fk fl dx bs fm b fn fo fp fq fr fs ft fu fv fw fx\">A couple of years ago, back when I was working at Expedia, I came across a very peculiar project. It had large requests, tiny responses, and response times were meant to be very fast.</p>\n<p id=\"c938\" class=\"fk fl dx bs fm b fn fo fp fq fr fs ft fu fv fw fx\">You may have indirectly used this service if you ever been to one of Expedia’s sites looking for a Flight and Hotel bundle. This service is responsible for choosing…</p>\n</div></section></div>",
    "url": "https://medium.com/@julianojuliocosta/a-case-study-about-compression-and-binary-formats-for-a-rest-service-7de9c4535cb8",
    "published": "2019-07-23T13:25:20.009000Z",
    "created_at": "2019-09-25T03:25:13.089821Z",
    "original": null,
    "twitter_id": null,
    "twitter_thread_ids": [],
    "extracted_content_url": "https://extract.feedbin.com/parser/feedbin/05612df6a0ca74d5bbdc074e75b0d350a4333aab?base64_url=aHR0cHM6Ly9tZWRpdW0uY29tL0BqdWxpYW5vanVsaW9jb3N0YS9hLWNhc2Utc3R1ZHktYWJvdXQtY29tcHJlc3Npb24tYW5kLWJpbmFyeS1mb3JtYXRzLWZvci1hLXJlc3Qtc2VydmljZS03ZGU5YzQ1MzVjYjg=",
    "images": null,
    "enclosure": null,
    "extracted_articles": [],
    "json_feed": null
  },
  {
    "id": 2215838986,
    "feed_id": 1658782,
    "title": "Down The Rabbit Hole of Performance Monitoring",
    "author": null,
    "summary": "To validate this assumption, we filter our data by a single (popular) CPU - as we’re CPU-limited, the GPU usually doesn’t have an effect on overall frame time. This is what we saw. Top plot is number of players, the middle line is CPU frame time in ms, and",
    "content": "<div>\n<p>To validate this assumption, we filter our data by a single (popular) CPU - as we’re CPU-limited, the GPU usually doesn’t have an effect on overall frame time.</p>\n<p>This is what we saw. Top plot is number of players, the middle line is CPU frame time in ms, and the bottom line is GPU frame time in ms, all plotted by date.</p>\n<p>Previously we’d measured an improvement in frame time of 4.2ms, but here we’ve measured a much more sensible change of 0.5ms. The CPU graph overall has less noise as well, the variance seems to be around +/- 1.5ms. Note the different colours in the top “Number of Players” plot - each colour indicates a new deploy with new code and data to PBE. The GPU time seems to be even smoother. Looking even closer, the 0.5ms dip in CPU time seems to be due to a relatively small sample size in the first day of the transition to the new patch (the deploy happened later in the day), which introduced more noise.</p>\n<div> <p>This is promising; let’s extend the domain to look at more data. Looking at the next patch cycle, we notice even less of a discontinuity. </p>\n<div class=\"rtecenter\"><img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole8.png\"></div>\n<p>This is all looking good now. There’s still some noise in the data, but given that this is PBE with a much smaller number of players, this could be acceptable. But how accurate are these values? How can we verify that these numbers are correct?</p>\n<p>As luck would have it, with the introduction of patch 8.13, we introduced a fix for a stall on the CPU. This stall was exactly 2ms - a great test for the accuracy of our data. If we see a change of 2ms in our data then we can be pretty confident that our data is reliable.</p>\n<p class=\"rtecenter\"><img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole9.png\"></p>\n<p>The improvement in frame time from patch 8.12 to 8.13 was 1.93ms - which is close enough to 2.0ms for me to finally have confidence in our data.</p>\n<div> <p>Like with all good problems, in retrospect the answer is obvious. Different CPUs run<em> League</em> at different speeds. A low-end machine will run slower than a high-end machine, so the distribution of machine specs will have an impact on the average frame times. If more low spec machines are playing the game at a given time, then the average frame time will be higher; if more higher spec machines are playing, then the frame time will be lower. This explains the diurnal behaviour of average frame times - at certain times of the day, there are more fast machines playing than at other times. The distribution of CPUs varies by time of day (which is very interesting in itself). So in order to collect accurate information we need to filter by CPU (and possibly GPU) power. Given that these metrics have an impact on the frame times we measure, we have to ask ourselves, “What else could have an impact on our frame times? What else should we be measuring?”</p>\n</div>\n<h3>Frame Time Distribution</h3>\n<p>To answer that, let’s take a step back and look at the <strong>distribution </strong>of average frame times. A histogram of frame times might show us outliers or unexpected modalities. The graph below is that histogram: fast frames on the left, slow frames on the right - and the higher the bar, the more games that had the average frame time.</p>\n<div class=\"rtecenter\"><img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole10.png\"></div>\n<p>This graph is surprising - I was hoping for a nice Gaussian curve with a smooth shape but this shows spikes in a few places: 7ms, 9ms, 12ms, and 16ms. Those frame times correspond roughly to 144Hz, 120Hz, 80Hz, and 60Hz, and indicate that there are concentrations of players at those frame rates. Of course this is the result of the graphics quality settings for the game, where players can lock their frame rates to 144fps, 120fps, 80fps, or 60fps. </p>\n<p>If we colour the histogram for those players who lock their frame rates we see the following:</p>\n<div class=\"rtecenter\"><img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole11.png\"></div>\n<p>Here, we can clearly see the number of players that have capped their frame rates. If we remove those players then the histogram becomes smoother, but there’s still a big spike around 60Hz. </p>\n<h3>Gathering More Data</h3>\n<p>To try and determine what other factors are at play here, we collected lots of different information that could possibly have an impact on frame times and plotted them.</p>\n<div class=\"rtecenter\"><img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole12.png\"></div>\n<p>This mess of coloured boxes shows the frame time histogram (top left) as well as what each player’s settings were - their screen resolution and display mode, what CPU they used, vsync state, antialiasing state, frame cap settings, and all the graphics quality settings, as well as game modes and memory available. In this view we can select any or all of these different settings to filter by them. </p>\n<p>The view below shows the frame time distribution for all games played at 1920x1080 with AA on and vsync off, frame capping off, graphics quality set to “Medium High,” for all URF games running on the most common CPUs.</p>\n<div class=\"rtecenter\"><img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole13.png\"></div>\n<p>Check out the top left chart - this selection of settings gives us a nice Gaussian curve! Well, almost - there are still some games that run at 60fps, but that doesn’t seem to be <em>League</em> related. It could be HW related, like the GPU locking to 60Hz due to some external setting (if you have any ideas, please let me know).</p>\n<div> <p>This is all very interesting, but what does it show us? It tells us that if we carefully gather the frame time data from players and collate them by CPU power, graphics settings, and game mode frame cap settings, we get a nice clean distribution of frames times. If we monitor that set of machines over time, we should see a relatively accurate indication of average frame time values over time (hopefully with minimal noise), allowing us to identify trends and/or regressions.</p>\n<p>By way of an example, here is some current data. This first plot is all of the frame times from all games played with filtering (times in ms on the vertical axis, time by day horizontally). The labels are the patch versions. As we noticed before, our patches vary by up to 5 or 6 milliseconds. </p>\n<div class=\"rtecenter\"><img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole_14.png\"></div>\n<p>Now, let’s look at all SR games in North America:</p>\n<p class=\"rtecenter\"><img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole_15.png\"></p>\n<p>That’s better, but we’re still seeing a lot of noise throughout a patch. Refining further, we’ll only look at games which have no frame cap (well, locked to a max of 240fps) and have vsync off.</p>\n<div class=\"rtecenter\"><img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole_16.png\"></div>\n<p>This is better again, but we’re still seeing odd transitions in and out of a patch cycle. Enhancing one more time, we’ll look at only machines within have a particular range of performance. We’ll use <a href=\"https://www.passmark.com/\">PassMark</a> for now, and just look at CPUs with a PassMark score of between 7,000 and 8,000 (the higher the score the faster the computer). This is midrange for North America.</p>\n<div class=\"rtecenter\">\n<img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole_17.png\">\n</div>\n<p>Now this looks good! Day by day we can see very slight variations in frame times (+/-0.2ms at worst for 9.13 and 9.14, with the rest around +/-0.05ms). Transitions from patch to patch are generally pretty smooth, except for 9.13 and 9.14, which stand out. Those patches are almost 1ms slower on average. In our original plots, we could see that those patches were slower, but it wasn’t clear by how much, and we would’ve had to wait a few days to see if it was a consistent trend or just noise. With this data, we can see immediately that there is a performance regression and we can attribute it to the change in patch. In this case the slowdown was due to the Arcade effects.</p>\n<p>If we plot all of the different bands of PassMarks individually (in groups of 1,000), we see this:</p>\n<div class=\"rtecenter\"><img alt src=\"http://pages.feedbinusercontent.com/sites/default/files/rabbithole_18.png\"></div>\n<p>This data is fantastic! It allows us to make performance extrapolations as well as accurately pinpoint changes in performance. For example, if a developer is working on a machine which has a PassMark of 15,000 and adds functionality which slows the game by 0.5ms, then we can say with some confidence that a player with a PassMark of 2,000 will have a performance drop of about 2.5ms. </p>\n<p>If you must have frames per second, then this corresponds to a developer’s machine dropping from 168fps to 152fps, and the players dropping from 39fps to 35fps. Knowing the average PassMark score for a region also allows us to make educated guesses as to the performance impact in that region.</p>\n<h2>Conclusion</h2>\n<p>In retrospect, this all feels pretty obvious. All the factors mentioned above have a marked impact on the speed of a game - the CPU in particular. Those factors <strong>must </strong>be taken into consideration when measuring and comparing performance, so collecting it is crucial. </p>\n<p>Keep in mind that we’re still just measuring the average frame time over an entire game. That’s a pretty crude metric, so we need to collect a lot of data in order to reduce the noise inherent in that measurement. Fortunately, <em>League</em> has a pretty large player base, so we have a lot of data to sift through (which is a problem in itself).</p>\n<p>What this gives us is the ability to see when a performance regression has slipped through QA or was triggered by a micropatch. What it doesn’t give us is the ability to determine exactly what caused the slowdown (or speed up). </p>\n<p>We need a different set of information for that... but that’s a story for another time. </p>\n</div>\n</div>\n</div>",
    "url": "https://technology.riotgames.com/news/down-rabbit-hole-performance-monitoring",
    "published": "2019-09-25T03:18:06.112524Z",
    "created_at": "2019-09-25T03:18:06.114715Z",
    "original": null,
    "twitter_id": null,
    "twitter_thread_ids": [],
    "extracted_content_url": "https://extract.feedbin.com/parser/feedbin/8712b7fbe19b85439103866c3dfef823a12713b7?base64_url=aHR0cHM6Ly90ZWNobm9sb2d5LnJpb3RnYW1lcy5jb20vbmV3cy9kb3duLXJhYmJpdC1ob2xlLXBlcmZvcm1hbmNlLW1vbml0b3Jpbmc=",
    "images": null,
    "enclosure": null,
    "extracted_articles": [],
    "json_feed": null
  },
  {
    "id": 2215831949,
    "feed_id": 1658782,
    "title": "Apollo GraphQL",
    "author": null,
    "summary": "Don't miss GraphQL Summit, Oct 30 - 31 in San Francisco | See the Lineup > Scaling the benefits of GraphQL with a cross-brand data graph travel booking sites in 70+ countries transactions booked on mobile As the world’s travel platform, Expedia Group",
    "content": "<div id=\"gatsby-focus-wrapper\">\n<p class=\"css-1x775y4\"><span class=\"css-1qff7ex ez9w66e1\">Don't miss GraphQL Summit, Oct 30 - 31 in San Francisco | <a href=\"https://summit.graphql.com/\"><strong>See the Lineup &gt;</strong></a></span></p>\n<p class=\"body\"><section class=\"case-study\"><section class=\"section hero \"><div class=\"container\"><div class=\"row css-gx0lhm\">\n<div class=\"col-12 col-sm-12 col-md-7 text\">Scaling the benefits of GraphQL with a cross-brand data graph</div>\n<div class=\"col-12 col-sm-12 col-md-5\"><div class=\"hero-card\">\n<div class=\"stat-item\"><div class=\"stat-desc\">travel booking sites in 70+ countries</div></div>\n<div class=\"stat-item\"><div class=\"stat-desc\">transactions booked on mobile</div></div>\n</div></div>\n</div></div></section><section class=\"section body \"><div class=\"container\">\n<div class=\"row first-row css-gx0lhm\">\n<div class=\"col-12 col-md-7\">\n<p>As the world’s travel platform, Expedia Group manages customer experiences across more than 200 booking sites and 25 brands including Brand Expedia, Orbitz, Travelocity, Vrbo, Hotels.com and Egencia. Continuously improving these experiences requires the creativity and careful orchestration of thousands of developers and dozens of backend service teams. And because today's travelers increasingly use multiple touchpoints when planning, shopping and traveling, ensuring a seamless experience across an ever-growing set of teams, geographies, and capabilities poses a real challenge for Expedia Group.</p>\n<p>“As you’d expect with a company of our history and scale, we operate multiple technology stacks, most built in-house, some added during acquisitions, and a few dating back to the dot-com era,” said Dan Boerner, Distinguished Product Manager at Expedia Group. “As time progressed, that architectural complexity began to leak into the customer experiences, and teams found themselves duplicating work across platforms and managing ever-evolving service APIs rather than creating next-generation travel solutions for our customers.”</p>\n<p>Something had to be done. So a team within Brand Expedia set out to combine an ambitious vision with an agile approach to completely transform the way they build and deliver customer experiences.</p>\n<p>Adopting a common data graph while moving away from heavy clients with tight bindings to REST APIs has been transformational. Features ship faster and it takes far less effort to deliver great customer experiences across each of their client platforms.</p>\n<h3>Challenges of a large and complex platform</h3>\n<p>Over the past decade, Brand Expedia group built a broad set of traditional REST services for its native and web clients. In this model, each client front-end was connected directly to a large number of underlying services.</p>\n<p>While this approach worked, it slowed client teams down, as each team had to learn about every API, onboard, and then configure specific endpoints. With these APIs constantly evolving, improving, and moving to the cloud, it took more and more time for both client and service teams to make progress together.</p>\n<p>The rise of native mobile clients added more complexity. Mobile-tuned APIs were created to serve those mobile applications, but that required an extra step each time a new capability was added to the core service. As a result, native apps ended up waiting for access to the latest features and the customer experiences began to diverge between clients. Also, because the service APIs weren’t designed to deliver display-ready content, each client platform had to duplicate core business logic. Subtle differences in that logic, as well as client-specific experiments, all contributed to a diverging customer experience and a duplication of effort.</p>\n<br><p class=\"image-title\">BEFORE ADOPTING A DATA GRAPH: CLIENT AND SERVICE COMPLEXITY</p>\n<img src=\"https://d33wubrfki0l68.cloudfront.net/5ea994157e9e43056942229e18e878c9766883ce/c6b94/static/client-complexity-14834da9e6e0ba14c0ab029894a06b07.png\"><p>As Boerner explained, “Much of the mobile app team’s work had nothing to do with creating experiences for customers because they were constantly figuring out which API to call, onboarding those APIs, and dealing with version and endpoint changes. All of these distractions required additional resources and slowed our feature delivery.\"</p>\n<p>Despite dedicated resources, the underlying problem persisted and continued to affect the customer experience. “The client-service complexity became a real bottleneck,” Boerner added. “Asking a native app team to keep track of tens of service teams so they can escalate production issues became a source of real frustration, and a real distraction for a team focused on creating great customer experiences.\"</p>\n</div>\n<div class=\"col-12 col-md-5\">\n<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMgAAAAdCAYAAADvqyMCAAAABGdBTUEAALGPC/xhBQAADNFJREFUeAHtmnuwV1UVxy8hIAKSmspDESQUlUdBhCKoUxamoDMYZtPDP4weKOJQU4M5Nurko9SmTGOgwTFJEAVDIgFzxIBMAhQB5RHcCyIoCgQI8Qjt+7mcdWfd1T6/3+/CZeLab818717vs19r73N+0KiiTIczAzcouLdL8ID4ZZncWe2tQkvhV8JcoUzlGfi/moEpGu2HDgOz0TdVW+n0/xLfKbOVmwY0Ax9rQH1tSF3l9ujoOnys+H5OLrMNZAbKBXJkForb4x2X+t/iFzm5zDaQGSgXyOEtVKOc8D3SXy48K/DtMVRYIZSpgc3AMQ2sv0dbd/n+yKPFMlAkZWrAM5BXIHxkXiJ0FVoLm4WFQnxN4ARtLHjidSJFPMvfWB9IBk2c8wHxPr6v5PMEYlcJ8wRvl5hL9Ku/0E04SXhPWCK8JPDcUoi+DRC6CPsFfqFaIBjl3SDYmUNv32tBocXHxkmfVwrcOtZHdH6dGD/zVCo1l+MlQidhp8Aavi4YFepnM3NSy2GwL5MvVttdeEzYnumsob98b/UQbN6Xip8v2JjE1qJSxsgc4GfEeli+QmPoIL8LhE8Im4Q5wlbhkKiFom4XGDQTErFGum8IRu3EsPG8351mdO2J4jcGv0GSBwfdE5KhTwtsZp8XnkIdLviNJ7EWMVmjBHxjPDL9uFHwm05iLSL/COFdIeZ4RToWH5oqeLv9ioVtfbCxWSLx6lUp+BzwzPMXBOhewdvpVynEPNwmUBQ+Hn6W0EaAqgRvPxmliA3l9W9J5oD7g9NTdEbM50jhbcHHGY/+JiE177eEmB9LjjRZCstFe4Vz4FdCs1nRtJRugsCBYjZaCmuckFqPc6SfIgwT6MPzQg0xWCrdJ8vj2cjNs8i4yenQ+ZnNmklifK4HM0OMJS/V/n7w97HwEwV/mkisJhZ3nhD9U/Kf5XdCdVTtPyxgXIwYz6brIxxOgdyj+JjXyyzkECH6lVIgHHQsrs8X+XWynypUBT8rEDaQj6FAvhd0ViD4vhBsPtbz+HFgeqrvAmFvcpD550b+H7Jb/31fKAwOpzHCM2agw6uFmKSQzCZqlCVgw3tfcrFI0LWCt70m+VgMIm4Rb5smeYXTvSk+dYoTc5fgiZwvCz5fMX6O/JsInn4mIRW3WfoNzrZc/AwnE1PqDfKtEGfP+6f0a52NsY93Mn6lFMhjIcbyM5+Mw2TWsMrJ6AsVyPzgywZrJkS95c9rOcS44Yzqu0B+rsT27B3iKQZuFtNZy1uK7UWx1dRFf5kD3hLOrdboz+8EC7KWhblS6C58TZgpmM3a66SDmKT4SvQb6doKWwTz3y2+5qHiBzub+dBOFzoIRj3FLBS8DzdVZ3NQe3ew4/ukcLXAGK4RnhJ8DngWx+gsMQcE70PRdTMHtWwKXlG8j/EDnV/eK9bx8tkW4lnAiwQ7cFigR4KPPWOE9IWon4zmay397eiCPiV+sWB231qBxFesPfJnbioFDrKpwinC7YKPh39U+LzQPmsnqI0+t0lnVJ8FYs9Zp+T0gddCiEvg14LZrf0+xkKU2hSc+im6Q0pLTFslNBKgc4RdgrcvC/J3JXtKFQibOEWcOK8KPv8DmSODp/i8jffhFN0opffbLrlF5vjLYFsoOd4wuDJmitjngS+lQG4IcRslnyCk6BdSxmcUK5DHQ8yzkm2N/DOaSXg9+PKsvALB9ohgG05s9Q848XX42xgSFMe9Uz6tMr/6LpD3lJfiTdHtUvo5XZdy8rrRIYBqzyMmZ5HgH/BZ5zws2Lzf087P2FggfGy1M2OivVA6n3N55vPNoH8uEetV8TYckhlXhjx+bD4e/nRhn+D7U0qBxML6OslyiMLdJPhnFCoQCuFd5/+B+DOFPLpUBp8bvlCBtA2JvhriZwR7FGcH/6GZQ30XyHfig53MQVsp+HF3dfZaLBu+dy1NRcXvg+xFJpzr1ZOPHydD6gbYIP31Pijj6aSnpRI4UfPorzLsdEbeF9kUvZwOttAYsPN64Il45sK/svE9sMA7Bf5NyZzAeRTHZn5nGZO1s4LsxV0S5npFEb617LwaGa0VA/LoRRko8hTF/jMfFKsnv/bo+aYpRNEe4wvF1sVWaE4Z7wsh2dlBrhHZFHZimHKVMTltnDi/IISMTsRxYm9N6KOqlGevdkFNxHNNx+vU+zj3GjY1BjZX4xqPg//u4sQkuzKpLazkddBomxhO/EJUl2fEV7U1hRLLtl9YX8THzHyDRIrzviI6BDna494L7ock7lVUVZHIuM/8mtQKpUBYJE/+FPV6eCp+eFByknqy7wKvu17CF70ihz8jR+/V3ocbjXfgWHxn+oDAc1r8IOgYAzeTLxz/nOBeI5biU+OcMdudgg19vJNTbF2ewSnvqdA84HeMwKvioVLcOx2LJIr2GF8kvCRzM3m1KeIZ53RHnj8FsjwYL3fyHPGvCVQcHz58tMaH+1OB92O+KyLxGvSoEE8c9J56SuBGyCN+CDjJGdeLp0jiq44fw5OyLxE4id8W6G98zUHHr2K8ChrxbwSfNCHRtpaue0Jvqjg201cZk7X9g+zFxhL6eUURngLxh0VnyR0KxJCbDZWivP5737h3LvPGBP+loIvrZmb2ZaSULvqYfJExiZZxXRj0lUGuJX5G0ocObJSLM492atsXAYsIsbn3CJaLzTjTyehnCJ4oJvO39kHvEPjZwX9cZj9NLT9BWg7aqzMbG73YGJpmvuPV+hyxv5lbdfNw8CVuoHOgeH0uK+zRQc8m41UxRTdL6XPAj0g5Ot2kEPOMs3mW2+PV4Ev+kzMn+uufvSnT+6atBPaL+XFYfc47OJ65MT/a/YI967pgmyg5EvPk4wc4B37c8ba1ko9zds8OC74c/EWLb1YIovO8KvUQjhWKEZ15Q/CdHCSZCXgn6EdKNsLHx8AzyfcJtmnFVv+cGBce3z4YM4qbmzy/FXoJeZOVhdY0fcXF/kyQzr8G0a/7BfJH31IKhEPHHyTkeF5Ab8QpN0rYK8RnFCsQNk6MmSZdG8Goi5j5QvRDtk3Lt6W3pwpELhVjgx99/pFA8UC0twhxLA9hzIh95p9F0X05s7F5b03Y7cDBLRYIuRhfR8HTcAnR927vkMdzFW8RfCeN52TGRqV5PC7ZrmE2ovnTjhGMrhLjbWwObhtosOBtL0jm5kG3TZgpvCjsErwfPBvXEwtbJUQ/ZDZzagyzpfeFKLH6v7HEHO9LP0eYJdAv7BuFv2S8+ZdSIAqpuCPEEc8G+pswXbA52C2eG8Dy044QilHqMCF2lbBesHxPi1/nZPR1LRAKaU3IYfn53jLet6ul5/vLiNuM1y3vA8+a7UjoH5POE3vKYlnryZm8T+3fBeaQ9TIfa9+SzheaxHy6QKbNggUXahfIr3WW6poQw+BbZDZrxgcfJuM4IRbIE9INEVKns+8PG6mlEIlvlErB++bxK+XXPiaQ3EpgfHlx6Dk06PvU4FdqgfBayuYs9AxsI4V7g98IycWIMcwVCuVnc7QVqoJfXQtE4RVnC2tDnrxnsz+6CJF6ScGGzoszPcXob3Ty+FuBvUPRpgrCctDyvXa+UCfqIG8+an0iz3OS/lRoIkAdBR5kPlyNfYVILFilYH60YwU2mddRIBBFsk3wNnjyPyQ0F/KIyeFGwzfGI3NSPyzEIpaqhihefFI5tkp/ZeZ5qAVCOEXyE2G3EPuJbrgAHUqBENdMuEtI5edWPk2Adgr++R+v1v73/+bdlOnzGk7icUJqzsi/Xxgj+JtDYi0aIGmJ4PvjefbH6bUiDgqxQNCeISwSfLzx86Q/VyhKjXI8OkvP5u0qcFNw2iwTpghMqFEbMcCIxeAaTxGnlffFh0Xi+jOaLOYrmcANMVQ4T+AK5uSZJmwQSiFyM4ZuwokCry0rhKeELUIpxGJQDJx4LDBzwAHCOKFOAvNjxOlm80O/7SDBvlQ4ABOIguYZ+FM03GzMg/WxnfhTBCPG/54JJbSt5HOpQF/p20LhFQEiN2trtE8MhQUx5z2quYN/GD9jKEbkZDzdhZME+koc61ysyORSPQeXqe0msP92CW8ILwmLhRTtkdL6TRHw3QKxvxl7f4GbkVvlOeFloUHQIPXSqpqWE6JM9TcDfYqkulN2P/9zi/gfrebUDVIvfbVKq5dk5SRH1Qzco94sECYJpyZ6dq10o4J+YpDL4v94Bso3yJFZgB8qrb8ZeCX8o3C/MFZYKHg7PK92TYWGSEfsBuE9s0wfvRng+8tTcwlXZPB64zeLuUrgG6RMbgbKr1huMj5C7E0ay+XCohLG9Cf59Bb4AaNMYQbyfsUKbkdMPFOZh7jsLBKvAmWqvxngQ32g0FPg1zB+KXtXoHimC/ys2tDpZg3A3oZ4XeRVsl7oP3XoyWDYZxWvAAAAAElFTkSuQmCC\"><p>A travel platform to orchestrate the movement of people and the delivery of travel experiences on both a local and global basis.</p>\n<p>Legacy REST infrastructure isn’t suited for modern apps, leading to slow development and inconsistencies across clients.</p>\n<p>Apollo Data Graph Platform to modernize the application architecture with GraphQL and a single cross-brand data graph.</p>\n<ul>\n<li>Faster development of mobile and web products.</li>\n<li>Faster resolution of time-to-root-cause and time-to-fix live issues.</li>\n<li>Avoid weeklong outages caused by API changes impacting specific clients.</li>\n<li>Less time to maintain consistency between platforms.</li>\n</ul>\n<br>\n</div>\n</div>\n<div class=\"col-12 col-md-7 quote\">\n<div class=\"content\">“Much of the mobile app team’s work had nothing to do with creating experiences for customers because they were constantly figuring out what API to call, onboarding those APIs, and dealing with version and endpoint changes.”</div>\n<div class=\"title\">Distinguised Product Manager at Expedia Group</div>\n</div>\n<div class=\"row css-gx0lhm\"><div class=\"col-12 col-md-7\">\n<p>When Brand Expedia group built their first Progressive Web App (PWA) for Expedia, Travelocity, and Orbitz brands, they followed the Backend-for-Frontend (BFF) pattern. The general approach held promise: let the BFF talk directly to the services and present a clean, non-service-specific API to the front-end. With this model, clients no longer had to include the business and orchestration logic and could enjoy an API built just for them. It worked well initially, but the teams quickly learned that BFFs just aren't designed to scale. Since BFFs are tuned for a single client— in this case, the web—to make it work everywhere, Expedia Group would have had to write a BFF for each and every client platform, with duplicated logic and custom code in each.</p>\n<br><p class=\"image-title\">EXPERIMENTING WITH BFF FOR A PROGRESSIVE WEB APP</p>\n<img src=\"https://d33wubrfki0l68.cloudfront.net/47d762cde33422da9345e9a7bf0497fc5fb28768/76710/static/experimenting-bb657684779fcf903f23cfda5ab2d19b.png\"><p>As Boerner explained, “when our native app team tried to replace the legacy mobile API with their own BFF, they found it difficult to keep up-to-date with all the test-and-learn experimentation going on in the web BFF. Ultimately, we decided it would be too time consuming to create a custom front-end service for each client and domain.”</p>\n<p>That’s when team began to explore a data graph approach with GraphQL and Apollo.</p>\n<h3>The move to one data graph</h3>\n<p>With their BFF experience in hand, and the dual goals of moving the rest of the website pages to the new PWA platform and aligning capabilities and experiences between all client platforms, the team began to explore the use of GraphQL to connect the entire organization’s app data and services into one central data graph. Their goal: a single graph, understood and discoverable by all teams, built to empower a new set of cohesive customer experiences.</p>\n<p>With a single entry point for clients to connect to, client teams were freed from directly connecting to multiple services or managing communications across multiple, extended teams. Meanwhile, service owners could easily expose their data via a schema that allowed clients to retrieve exactly the portion of data needed with a simple query.</p>\n<br><p class=\"image-title\">AFTER ADOPTING A DATA GRAPH: A FEDERATED SERVICES ARCHITECTURE TO SCALE</p>\n<img src=\"https://d33wubrfki0l68.cloudfront.net/b2ff2e886776c39d459bd9dd751e764755ab065b/61b8d/static/adopting-7dfd9697bf7774ccbf5bb9604449fa3e.png\"><p>Expedia Group turned this effort into a formal initiative, which now serves as the foundation of their new and modern application development stack, and supports their strategy to create seamless customer experiences across all their client platforms.</p>\n<p>“When your client code doesn’t need to know which underlying service provides the data, all kinds of good things start to happen, for both the client and service teams,” said Boerner. “Client teams are freed from complexity and service teams have a single contract to maintain, which frees them up to evolve their back-ends faster and with less risk.”</p>\n<p>Though given a broad charter, the team knew from the start that they needed an iterative approach to building and operating this single data graph. It needed to have all the benefits of a single data graph, but without requiring that a single central team manage such a large schema. So, aligned with the \"one graph, federated implementation\" architecture described at principledgraphql.com, Brand Expedia group set out to distribute ownership of the data graph.</p>\n</div></div>\n<div class=\"col-12 col-md-7 quote\"><div class=\"content\">“Apollo Federation will allow us to implement our existing schema linking in a safer, declarative manner, while opening up a whole new level of broader federation opportunities across the wider enterprise”</div></div>\n<div class=\"row css-gx0lhm\"><div class=\"col-12 col-md-7\">\n<p>The first effort by the team was to develop a schema stitcher leveraging Apollo Server called the “Loom,” which worked with their open-source <a href=\"https://github.com/ExpediaGroup/graphql-kotlin\">graphql-kotlin</a> to stitch together GraphQL services for each domain schema into a single graph. The Loom also allowed simple schema linking between common schema objects like Geography. While this initial stitching implementation worked, the schema linking required custom code for each link. When Apollo announced their Apollo Federation, a new architecture for composing multiple GraphQL services into a single graph, the team was immediately intrigued.</p>\n<p>“Apollo Federation will allow us to implement our existing schema linking in a safer, declarative manner, while opening up a whole new level of broader federation opportunities across the wider enterprise,” explained Boerner.</p>\n<h3>Migration to Apollo graph management</h3>\n<p>At scale, the team knew that expanding the data graph across and within teams would require powerful management capabilities to improve the development experience and protect the graph.</p>\n<p>“As our initial GraphQL rollouts began to show promise, the power of the technical approach was clear. Equally clear was the need to have all the powerful monitoring, management, and operational capabilities built into our platform to support tens of teams and hundreds of developers,” said Boerner. “When we learned about Apollo’s Data Graph Platform and the Apollo Graph Manager, it became a classic build-vs.-buy decision for us. Apollo gave us the tools we didn’t have, while allowing us to integrate with our existing operational infrastructure.\"</p>\n<p>For Expedia Group, leveraging tools and tech from Apollo freed up the team for other priorities. As Boerner put it, \"If our small platform team had to build all the tech we use from Apollo Platform, we'd have much less time to help onboard new teams, evangelize our design principles, or ultimately solve our customer problems.”</p>\n</div></div>\n<div class=\"col-12 col-md-7 quote\"><div class=\"content\">“Our new PWA clients have a tiny fraction of the business logic of our older clients because we’ve moved it behind the graph where it’s shared by all clients…”</div></div>\n<div class=\"row css-gx0lhm\"><div class=\"col-12 col-md-7\">\n<p>Apollo provided Expedia Group with a complete graph management solution, giving them a means to monitor, detect, and prevent schema breaks, as well as operationalize the data graph—all at scale. It also makes a unified data graph possible by sharing management and portable code, queries, and fixes across teams.</p>\n<p>Since adopting Apollo, code complexity has decreased dramatically. “Our new PWA clients have a tiny fraction of the business logic of our older clients because we’ve moved it behind the graph where it’s shared by all clients,” said Boerner. “This also means that fixes made in the shared layer are picked up by all clients, so that’s a big win in terms of reducing technical debt and fulfilling our mission to create a seamless customer experience, regardless of the client platform.”</p>\n<h3>Developer experience and productivity improves</h3>\n<p>Almost immediately after adopting the Apollo platform, Expedia Group saw an improvement in the speed and efficiency of the developers working with the single graph and GraphQL. Ben Munge, lead developer on Expedia Group’s Native App iOS Team, saw how Apollo’s platform enabled developers to thread the graph through tools they were already using.</p>\n<p>“The power of the Apollo tooling to reduce developer effort and ensure that the service code is always a true reflection of the schema made it a great option for us,” he said. “Using generated code has greatly reduced the number of bugs and minimized the development and testing effort compared to implementing this integration manually. We develop our queries in Xcode using the Apollo GraphQL plugin. We also leverage GraphQL Playgrounds to explore the schema and develop queries. Once a query is set, we use the Apollo iOS tools to update our schema and regenerate the API.”</p>\n<p>Munge also uses the platform to track down issues and monitor the health of services during debugging. “There were a lot of pluses to the Apollo platform,” he added. “Speed was one of them. By partnering with Apollo, we can greatly reduce the time to create new experiences and to resolve time-to-root-cause and time-to-fix live issues.”</p>\n<h3>Keeping the graph healthy and efficient</h3>\n<p>Expedia Group recognized the data graph as an ideal central location to collaborate across product teams, so they took the vital step of creating a new group to create and manage their growing graph community. This became a key part of their agile API strategy.</p>\n<p>Using Apollo’s data graph platform, developers across the organization can monitor the health of the graph and discover how back-end services are used.</p>\n<p>“We can take the graph metrics from Apollo and plug them into our operational fabric, Grafana, Splunk, etc.” said Boerner. “But those tools are designed for general purpose, and we find that Apollo’s dashboard gives a better 360-degree GraphQL-native view of clients, operations, schema changes, and failures so that our developers get a much clearer view of how our graph is performing. We also see reductions in the time it takes to determine root cause during a service disruption, as Apollo Graph Manager allows us to quickly see exactly which clients and queries are affected.”</p>\n<p>It also became important for managing changes to the underlying services and schemas, so that any individual change from a team wouldn’t break existing queries—or the customer experience.</p>\n</div></div>\n<div class=\"col-12 col-md-7 quote\"><div class=\"content\">“Schema validation at PR commit is a game changer. We've already detected and prevented a number of schema changes that would have led to weeklong service outages for our native app customers.”</div></div>\n<div class=\"row css-gx0lhm\"><div class=\"col-12 col-md-7\">\n<p>“Since customers run a variety of app versions, we have to ensure that even older clients are still compatible with our graph,” said Boerner. “To protect these clients, we use Apollo’s Github integration coupled with Schema Validation to ensure backward compatibility at all times by validating all schema changes against the client queries from the previous week of client requests.”</p>\n<p>In the past, teams would make an API change on behalf of web clients and inadvertently break native apps. As Boerner explained, \"Schema validation at PR commit is a game changer. We've already detected and prevented a number of schema changes that would have led to weeklong service outages for our native app customers. We modeled loss reductions from schema validation and were surprised at how quickly the technology would pay for itself.\"</p>\n<p>It’s these types of central operations that ensure the data graph is a reliable resource even as it evolves.</p>\n<h3>What’s next</h3>\n<p>“GraphQL is becoming the standard front-end API for all our customer-facing applications, and teams are working on external partner APIs that leverage GraphQL as we strive to leverage technologies that create consistency and simplicity.”</p>\n<p>Today, Expedia Group is expanding the use of the data graph across more teams, which is a great opportunity for everyone in the organization to think in terms of a truly unified customer experience.</p>\n<p>\"As we work to leverage and share more capabilities across Expedia Group, GraphQL and Federation are strategically important tools.\" said Boerner.</p>\n<p>GraphQL is also enabling opportunities to align across different product types. “Across all lines of business, we are identifying the common capabilities that allow a user to execute a search, browse and filter results, view details, and make a purchase,” said Ben Munge, Senior iOS Software Engineer. “The service architecture needs to be designed with this unified experience in mind. Why should the response structure differ based the product we’re selling? Imagine if Amazon had separate services for household goods, electronics, and books.”</p>\n</div></div>\n<div class=\"col-12 col-md-7 quote\">\n<div class=\"content\">“We’re excited about the opportunities to connect our data graph with our Unified Design System”</div>\n<div class=\"title\">Director of User Experience at Expedia Group</div>\n</div>\n<div class=\"row css-gx0lhm\"><div class=\"col-12 col-md-7\">\n<p>Looking ahead, the core team is exploring advanced capabilities like server-driven UI, powered by a graph that dynamically adjusts the user experience across all clients based on machine learning models.</p>\n<p>\"We’re excited about the opportunities to connect our data graph with our Unified Design System to power a set of more scalable user experiences that allow server-side experimentation,” said Tyler Fleck, Director of User Experience. “Trying out new ideas across all our clients without the need to make any client-specific changes speeds up the design and learning process, and ultimately leads to better customer experiences and outcomes.”</p>\n<p>What started as a bottom-up project with a small team focused on building a proof-of-concept multi-tenant graph has grown both intentionally and organically as teams throughout the company demonstrated the value of GraphQL and the Apollo Platform. Expedia Group is now focused on building on the groundswell of adoption across mobile web, iOS, and Android; onboarding service teams to publish their capabilities to the graph; and demonstrating the value across the company and across the customer experience. “GraphQL is helping us bring the world within reach for millions of travelers,\" said Boerner. We believe we are just scratching the surface of what this transformation will unlock for our customers.”</p>\n</div></div>\n</div></section><section class=\"section question__section \"></section><section class=\"section blog \"></section></section></p>\n</div>",
    "url": "https://www.apollographql.com/customers/expediagroup/",
    "published": "2019-09-25T03:00:37.005093Z",
    "created_at": "2019-09-25T03:00:37.007492Z",
    "original": null,
    "twitter_id": null,
    "twitter_thread_ids": [],
    "extracted_content_url": "https://extract.feedbin.com/parser/feedbin/e6ff37e17d338432bb5fb32abdae2b236af1e466?base64_url=aHR0cHM6Ly93d3cuYXBvbGxvZ3JhcGhxbC5jb20vY3VzdG9tZXJzL2V4cGVkaWFncm91cC8=",
    "images": null,
    "enclosure": null,
    "extracted_articles": [],
    "json_feed": null
  },
  {
    "id": 2215640299,
    "feed_id": 1658782,
    "title": "What Really Brought Down the Boeing 737 Max?",
    "author": "William Langewiesche",
    "summary": "Skip to content Skip to site index Feature Malfunctions caused two deadly crashes. But an industry that puts unprepared pilots in the cockpit is just as guilty. CreditCreditPhoto illustration by Matt Dorfman Sept. 18, 2019 Updated 6:48 a.m. ET On Oct. 29,",
    "content": "<div><article id=\"story\" class=\"css-1ygeb3d e1qksbhf0\"><span><meta>\n<meta></span><div id=\"fullBleedHeaderContent\">\n<header class=\"css-19m1grm e2e4ar60\"><div class=\"css-rmz92m\"><figure class=\"sizeFull layoutVertical css-1tdrw34\"><div class=\"css-1t9vdok\">\n<span class=\"css-1dv1kvn\">Image</span><img class=\"css-vusr4p\" src=\"https://static01.nyt.com/images/2019/09/22/magazine/22mag-boeing1/22mag-boeing1-articleLarge-v7.jpg?quality=75&amp;auto=webp&amp;disable=upscale\" srcset=\"https://static01.nyt.com/images/2019/09/22/magazine/22mag-boeing1/22mag-boeing1-articleLarge-v7.jpg?quality=90&amp;auto=webp 600w, https://static01.nyt.com/images/2019/09/22/magazine/22mag-boeing1/22mag-boeing1-jumbo-v7.jpg?quality=90&amp;auto=webp 1013w, https://static01.nyt.com/images/2019/09/22/magazine/22mag-boeing1/22mag-boeing1-superJumbo-v7.jpg?quality=90&amp;auto=webp 2025w\" sizes=\"100vw\">\n</div>\n<figcaption class=\"css-17ai7jg emkp2hg0\"><span class=\"emkp2hg2 css-6mpy6q e1z0qqy90\"><span class=\"css-1ly73wi e1tej78p0\">Credit</span><span><span class=\"css-1dv1kvn\">Credit</span><span>Photo illustration by Matt Dorfman</span></span></span></figcaption></figure></div>\n<div class=\"css-hy7cq4\"><div class=\"css-6cn7ki\">\n<div class=\"css-1q44qq5 e1suatyy0\"><header class=\"css-1nf2dl3 e1suatyy1\"><section class=\"css-1pllgza e1suatyy2\"><div class=\"css-kdb5os er09x8g0\">\n<a class=\"css-1rn5q1r\" href=\"https://www.nytimes.com/2019/09/18/magazine/boeing-737-max-crashes.html#site-content\">Skip to content</a><a class=\"css-1rn5q1r\" href=\"https://www.nytimes.com/2019/09/18/magazine/boeing-737-max-crashes.html#site-index\">Skip to site index</a>\n</div></section></header></div>\n<p class=\"css-som4qd e6idgb70\">Feature</p>\n<p class=\"css-12vbmur e1wiw3jv0\">Malfunctions caused two deadly crashes. But an industry that puts unprepared pilots in the cockpit is just as guilty.</p>\n</div></div></header><div class=\"css-nwzfg5 e1xwzt920\"><p class=\"css-2trrvf\"><span class=\"css-1f9pvn2 magazine\"></span><span class=\"emkp2hg2 css-6mpy6q e1z0qqy90\"><span class=\"css-1ly73wi e1tej78p0\">Credit</span><span><span class=\"css-1dv1kvn\">Credit</span><span>Photo illustration by Matt Dorfman</span></span></span></p></div>\n<div class=\"css-3016mu e1xwzt921\"><div class=\"css-acwcvw epjyd6m0\"><ul class=\"css-1xtbm1r epjyd6m3\">\n<li class=\"css-i49r68\"><div class=\"css-3486v e16638kd1\">\n<time class=\"css-1sbuyqj e16638kd4\">Sept. 18, 2019</time><time class=\"css-1v4b6rn e16638kd5\">Updated <span class=\"css-epvm6\">6:48 a.m. ET</span></time>\n</div></li>\n<li class=\"css-1ncq2h5 epjyd6m1\">\n</ul></div></div>\n</div>\n<section class=\"meteredContent css-1i2y565\"><div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\"><span class=\"css-ggqk20 ethc9we0\">O</span>n Oct. 29, 2018, Lion Air Flight 610 taxied toward the runway at the main airport in Jakarta, Indonesia, carrying 189 people bound for Bangka Island, a short flight away. The airplane was the latest version of the Boeing 737, a gleaming new 737 Max that was delivered merely three months before. The captain was a 31-year-old Indian named Bhavye Suneja, who did his initial flight training at a small and now-defunct school in San Carlos, Calif., and opted for an entry-level job with Lion Air in 2011. Lion Air is an aggressive airline that dominates the rapidly expanding Indonesian market in low-cost air travel and is one of Boeing’s largest customers worldwide. It is known for hiring inexperienced pilots — most of them recent graduates of its own academy — and for paying them little and working them hard. Pilots like Suneja who come from the outside typically sign on in the hope of building hours and moving on to a better job. Lion Air gave him some simulator time and a uniform, put him into the co-pilot’s seat of a 737 and then made him a captain sooner than a more conventional airline would have. Nonetheless, by last Oct. 29, Suneja had accumulated 6,028 hours and 45 minutes of flight time, so he was no longer a neophyte. On the coming run, it would be his turn to do the flying.</p>\n<p class=\"css-exrw3m evys1bk0\">His co-pilot was an Indonesian 10 years his elder who went by the single name Harvino and had nearly the same flight experience. On this leg, he would handle the radio communications. No reference has been made to Harvino’s initial flight training. He had accumulated about 900 hours of flight time when he was hired by Lion Air. Like thousands of new pilots now meeting the demands for crews — especially those in developing countries with rapid airline growth — his experience with flying was scripted, bounded by checklists and cockpit mandates and dependent on autopilots. He had some rote knowledge of cockpit procedures as handed down from the big manufacturers, but he was weak in an essential quality known as airmanship. Sadly, his captain turned out to be weak in it, too.</p>\n<p class=\"css-exrw3m evys1bk0\">“Airmanship” is an anachronistic word, but it is applied without prejudice to women as well as men. Its full meaning is difficult to convey. It includes a visceral sense of navigation, an operational understanding of weather and weather information, the ability to form mental maps of traffic flows, fluency in the nuance of radio communications and, especially, a deep appreciation for the interplay between energy, inertia and wings. Airplanes are living things. The best pilots do not sit in cockpits so much as strap them on. The United States Navy manages to instill a sense of this in its fledgling fighter pilots by ramming them through rigorous classroom instruction and then requiring them to fly at bank angles without limits, including upside down. The same cannot be expected of airline pilots who never fly solo and whose entire experience consists of catering to passengers who flinch in mild turbulence, refer to “air pockets” in cocktail conversation and think they are near death if bank angles exceed 30 degrees. The problem exists for many American and European pilots, too. Unless they make extraordinary efforts — for instance, going out to fly aerobatics, fly sailplanes or wander among the airstrips of backcountry Idaho — they may never develop true airmanship no matter the length of their careers. The worst of them are intimidated by their airplanes and remain so until they retire or die. It is unfortunate that those who die in cockpits tend to take their passengers with them.</p>\n<p class=\"css-exrw3m evys1bk0\">It was a blue-sky morning in Jakarta, with a few clouds floating offshore to the north. The flight was assigned a standard departure route over the Java Sea. At 6:20 a.m., it was cleared for takeoff. To anyone observing the airplane externally, for instance from the control tower, the takeoff would have appeared ordinary as the Boeing lumbered down the runway and lifted into the air. The first external hint of trouble came about a minute later, after a departure controller cleared the flight for a climb to 27,000 feet. Harvino asked the controller to confirm the airplane’s current altitude as shown on the controller’s display. The request was unusual, and it went unexplained. The controller answered that he showed the altitude as 900 feet, and Harvino acknowledged him without comment as if he concurred.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">Twenty-five seconds later (a long interlude in flight), Harvino requested a clearance to “some holding point” where the airplane could linger in the sky. The request was surprising. The controller did not provide a holding point but asked about the nature of the problem. Harvino answered, “Flight-control problem.” He did not mention which kind, but before they die, pilots are rarely so descriptive. Harvino did not declare an emergency. The controller asked about their intended altitude. Harvino answered 5,000 feet, which was strangely low and to this day remains unexplained.</p>\n<p class=\"css-exrw3m evys1bk0\">Two and a half minutes after takeoff, as the airplane was climbing through 2,175 feet, it suddenly went into a violent 700-foot dive, rounding out of it at 1,475 feet and pulling into an uncertain climb. No turn was associated with the plunge, so the airplane’s problem seemed to be unrelated to roll control and the age-old menace of a spiral dive. Right from the start of the investigation, suspicions focused on Lion Air 610’s trim mechanism — and specifically on the possibility of a failure known as a runaway trim. Trim refers to an aerodynamic condition related to pitch — the nose-up-or-down attitude of an airplane in flight. It can be thought of as a balance point, or the nose attitude at which an airplane naturally rides when no up-or-down elevator-control deflections are applied. That is a slight simplification, but good enough. Trim is routinely adjusted in flight. In the Boeing 737, the adjustments are made by the use of thumb switches on the control wheels when the pilots are “hand flying” the airplane manually, as they would on takeoff and landing. The thumb switches control an electrohydraulic mechanism that changes the angle of the horizontal stabilizer — the all-important tail surface that counteracts the natural pitching effects of the wings and provides the necessary aerodynamic balance for flight. In its functioning, the electric trim is smooth, powerful and usually well behaved. On occasion, however, it may start running on its own volition and prompt the airplane to nose up or down. That’s a runaway trim. Such failures are easily countered by the pilot — first by using the control column to give opposing elevator, <a class=\"css-1g7m0tk\" href=\"https://www.nytimes.com/interactive/2018/11/16/world/asia/lion-air-crash-cockpit.html?module=inline\">then by flipping a couple of switches to shut off the electrics</a> before reverting to a perfectly capable parallel system of manual trim. But it seemed that for some reason, the Lion Air crew might not have resorted to the simple solution.</p>\n<p class=\"css-exrw3m evys1bk0\">Lion Air 610 climbed to 5,000 feet and stayed there shakily for an additional six minutes. Soon it was out over open water. At some point, Harvino declared the crew’s intent to return to the Jakarta airport. Air-traffic control approved the return and later advised the crew to plan on Runway 25 Left, the one closest to their position. But nothing occurred as a result. The airplane kept flying away from the airport. Harvino asked the controller for the airplane’s speed across the ground. This was another unusual question, given that multiple independent indications of speed should have been available in the cockpit. The controller answered that the groundspeed was 322 knots (371 miles per hour). At that altitude, it was nearing the 737’s maximum engineered aerodynamic airspeed of approximately 340 knots. The airplane was flying unusually fast.</p>\n<p class=\"css-exrw3m evys1bk0\">It should have been obvious to air-traffic control that the pilots were struggling, but maybe because they had not declared an emergency, the controller continued to treat them routinely, repeatedly instructing them to maintain their chosen altitude of 5,000 feet and issuing multiple new compass headings to steer. Each new heading involved a banked turn, and each bank complicated the crew’s ability to keep the nose from dropping. It is hard to imagine what the controller was thinking. One of his headings steered the flight away from conflicting traffic, when instead it was the traffic that should have been steered away from the flight. Equally unfortunate was the acquiescence of Suneja and Harvino, who dutifully complied with every air-traffic control request.</p>\n<p class=\"css-exrw3m evys1bk0\">At 6:31 a.m., 11 minutes into the flight, Suneja got on the radio for the first time. He did not know their altitude, he told the controller, because all their altitude indicators were showing different values. This is unlikely and has never been explained. Perhaps reflecting the strain he felt, Suneja misidentified himself as Lion Air 650. Appropriately, the controller acknowledged Suneja’s transmission without quibbling and responded, “No restriction.” He meant that Suneja was cleared to fly at whatever altitude he chose. But apparently Suneja did not understand. A few seconds later, he unnecessarily asked the controller for a block clearance to all altitudes 3,000 feet above and below his current altitude for traffic avoidance. The controller, who had just heard Suneja say he did not know his altitude, asked him what altitude he wanted. Suneja answered, “Five thou.”</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">Suneja was shepherding 188 hapless souls through the sky, 189 if you include his own, and struggling with a confusing failure of some kind. Under stress, his performance had become abysmal. Right from the start — months before the cockpit voice recorder was found and listened to — his obsession with altitude clearances could only be explained as a pilot drowning in minutiae. “Five thou” was his final transmission. Twelve minutes into the flight, Lion Air 610 disappeared from radar.</p>\n<p class=\"css-exrw3m evys1bk0\"><em class=\"css-2fg4z9 e1gzwzxm0\">[</em><a class=\"css-1g7m0tk\" href=\"https://www.nytimes.com/interactive/2019/business/boeing-737-crashes.html?module=inline\"><em class=\"css-2fg4z9 e1gzwzxm0\">Read highlights from The Times’s coverage of the 737 Max crashes and the fallout.</em></a><em class=\"css-2fg4z9 e1gzwzxm0\">]</em></p>\n<p class=\"css-exrw3m evys1bk0\"><strong class=\"css-8qgvsz ebyp5n10\">Airline crashes are </strong>rare, and rarer still are crashes that force the grounding of an entire fleet. Lion Air 610 was not immediately among them. But about four months later, on March 10, 2019, an equally new 737 Max flown by Ethiopian Airlines went down on departure from Addis Ababa with the loss of everyone aboard, and within a week all further flights of the 737 Max were stopped worldwide.</p>\n<p class=\"css-exrw3m evys1bk0\">After both accidents, the flight-data recordings indicated that the immediate culprit was a sensor failure tied to a new and obscure control function that was unique to the 737 Max: the Maneuvering Characteristics Augmentation System (MCAS). The system automatically applies double-speed impulses of nose-down trim, but only under circumstances so narrow that no regular airline pilot will ever experience its activation — unless a sensor fails. Boeing believed the system to be so innocuous, even if it malfunctioned, that the company did not inform pilots of its existence or include a description of it in the airplane’s flight manuals.</p>\n<p class=\"css-exrw3m evys1bk0\">The system in question is complicated, and we will return to it later, but for now it is enough to know that after the loss of Lion Air 610, the company suggested that the 737 Max was as safe as its predecessors. Its tone was uncharacteristically meek, but not for lack of conviction. The company seemed hesitant to point the finger at a prickly customer — Lion Air — that had several billion dollars’ worth of orders on the table and could withdraw them at any time. The dilemma is familiar to manufacturers after major accidents in which it is usually some pilot and not an airplane that has gone wrong. Nonetheless, Boeing’s reticence allowed a narrative to emerge: that the company had developed the system to elude regulators; that it was all about shortcuts and greed; that it had cynically gambled with the lives of the flying public; that the Lion Air pilots were overwhelmed by the failures of a hidden system they could not reasonably have been expected to resist; and that the design of the MCAS was unquestionably the cause of the accident.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class><div class=\"css-17dprlf\"><iframe src=\"https://www.nytimes.com/interactive/2019/admin/100000006719728.embedded.html?\" class=\"css-sqdgy8\" width=\"100%\"></iframe></div></div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">But none of this was quite true. The rush to lay blame was based in part on a poor understanding not just of the technicalities but also of Boeing’s commercial aviation culture. The Max’s creation took place in suburban Seattle among engineers and pilots of unquestionable if bland integrity, including supervising officials from the Federal Aviation Administration. Although Boeing’s designers were aware of timetables and competitive pressures, the mistakes they made were honest ones, or stupid ones, or maybe careless ones, but not a result of an intentional sacrifice of safety for gain. As always, there was a problem with like-mindedness and a reluctance by team players to stand out from the crowd. Even more pernicious was the F.A.A.’s longstanding delegation of regulatory authority to Boeing employees — a worry that is perennially available to chew on if you like and may indeed be related to the configuration of the troublesome system as it was installed. Nonetheless, in Seattle, at the level where such small choices are made, corruption, like cynicism, is rare.</p>\n<p class=\"css-exrw3m evys1bk0\">That is not meant as a blanket defense of Boeing. On the corporate level, the company is the worst sort of player — a corrosive agent that spreads money around Washington, pushes exotic weapons on Congress, toys with nuclear annihilation, sells all sorts of lesser instruments of death to oppressive regimes around the world and dangerously distorts American society in the ways that President Dwight D. Eisenhower warned against in his prescient 1961 farewell address. But hardly any of that matters in the story of the 737 Max. What sent an expensive new Boeing into the ocean on that beautiful, bright morning in Indonesia? It is understandable to look for a simple answer. Laying the blame on a poorly implemented system, even a complex one, made the accident relatively easy to understand and also provided for a material solution: Simply fix the system. But the focus on a single shoddy component — as the news media and government regulators have rushed to do — has obscured the larger forces that ultimately made these accidents possible.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">The paradox is that the failures of the 737 Max were really the product of an incredible success: a decades-long transformation of the whole business of flying, in which airplanes became so automated and accidents so rare that a cheap air-travel boom was able to take root around the world. Along the way, though, this system never managed to fully account for the unexpected: for the moment when technology fails and humans — a growing population of more than 300,000 airline pilots of variable and largely unpredictable skills — are required to intervene. In the drama of the 737 Max, it was the decisions made by four of those pilots, more than the failure of a single obscure component, that led to 346 deaths and the worldwide grounding of the entire fleet.</p>\n<p class=\"css-exrw3m evys1bk0\"><strong class=\"css-8qgvsz ebyp5n10\">If you were</strong> to choose a location in the developing world in which to witness the challenges facing airline safety — the ossification of regulations and in many places their creeping irrelevance to operations; the corruption of government inspectors; the corruption of political leaders and the press; the pressure on mechanics, dispatchers and flight crews to keep unsafe airplanes in the air; the discouragement, fatigue and low wages of many airline employees; the willingness of bankers and insurers to underwrite bare-bones operations at whatever risk to the public; the cynicism of investors who insist on treating air travel as just another business opportunity; and finally the eagerness of the manufacturers to sell their airplanes to any airline without restraint — you would be hard pressed to find a more significant place than Indonesia.</p>\n<p class=\"css-exrw3m evys1bk0\">The country began deregulating its airline industry in the late 1990s in the hope of providing for the sort of fast, low-cost travel that might help bind its islands together. No-frills newcomers who cared nothing for prestige rushed in to compete for the business of bargain-conscious passengers and undercut the flagship national airline, Garuda, in a booming domestic market that started growing at a rate second only to China’s. The free-for-all soon raised questions about how to manage safety. That is a polite way of putting it. A race to the bottom comes to mind.</p>\n<p class=\"css-exrw3m evys1bk0\">At the forefront of the boom was a streetwise Jakarta local named Rusdi Kirana, then 36, who came from a humble background, once sold typewriters for a living and became an airport freelancer hustling for scraps of opportunity among the passengers moving through the terminal buildings. Initially that meant wheeling suitcases to and from the curb, holding up name signs in the arrival flows or spotting people who might appreciate some friendly guidance. He was good at the hustle, but little else has been reported about his early work at the airport, except that in the 1990s he and his brother started what they called a travel agency. This was in a pre-electronic era, when the airlines issued paper tickets. In Jakarta, the airport terminals had become marketplaces where thousands of passengers in search of cheap flights hunted for last-minute discounts offered by airlines wanting to fill empty seats at any price. Kirana and his brother stepped in as middlemen, acquiring tickets by the fistful from airline clerks and scalping them to the crowds. The mechanics of the scheme remain murky, but even Garuda profited from Kirana’s hustle. No one complained.</p>\n<p class=\"css-exrw3m evys1bk0\">Kirana’s travel agency did not make him rich, but it apparently convinced him that a large, unexploited market existed in Indonesia for cheap flights, and that someday, because of the country’s island geography, air travel might be seen as routine by ordinary people. At the time, the industry remained regulated. Kirana seemed to believe that it was price rather than convenience that counted and that the trips would have to cost about the same as those by ferry and bus. To achieve that, he would have to use his own airplanes and control every aspect of the operation. More important than reducing costs, he would have to fill his airplanes to capacity and keep them flying. He would call the airline Lion Air. To save money, he sketched out the logo and uniforms himself. He approached the Transportation Ministry to inquire about licensing the airline and was laughed off and advised to set up a condom factory instead. But when the industry was deregulated shortly afterward, Kirana could not be denied. He leased a decrepit Boeing 737, and in June 2000, Lion Air started operations, offering low-cost flights on two of Indonesia’s most popular routes.</p>\n<p class=\"css-exrw3m evys1bk0\">Within five years, domestic passenger traffic doubled and then tripled. Lion Air’s fleet grew by even larger multiples as the airline gobbled up an increasing share of the market, and Kirana turned out to be a master of financial dealings. The public flocked to him even while reviling his airline for its poor on-time performance and, soon enough, for its safety record. He did not appear to care about the complaints that came in. One afternoon, he pointed to a trash can in his office and said to a businessman I know, “Here’s my complaints department.” People called him ruthless, but shrewd is a better description. Having given up at typewriter sales, he was determined to succeed at something else. He told the businessman that it is a mistake in an airline venture to get wrapped up in the romance and art of flying, because money is what counts. He may have been right, except that this approach reduces pilots to journeymen and ignores the role of airmanship in safety.</p>\n<p class=\"css-exrw3m evys1bk0\">The twist is that Kirana could have built his airline on the Airbus 320, an airplane that is less challenging to fly, but instead chose the equivalent Boeing 737, which counts on pilots as the last resort if something mechanical or otherwise goes wrong. I have been unable to speak to Kirana despite multiple attempts to reach him, so I do not know if he cares about these distinctions. For sure, though, he cares that once an airline makes a choice between Airbus and Boeing, changing manufacturers is expensive to do. Simulators, shop equipment, stocks of spare parts and training curriculums have to change. Kirana has become a major Airbus customer — but for other airlines he now controls. As for Lion Air, having begun with Boeing, it stuck with Boeing and by 2005 placed an order for up to 60 Next-Generation 737-900ERs. ER stands for extended range. The 900 is a 220-passenger airplane. The model was unpopular and had garnered not a single customer before Lion Air came along. The deal came close to $4 billion. This got Boeing’s attention.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">The deregulated Indonesian airline industry was also attracting attention, but not of the desirable kind. Accompanying the drastic expansion in traffic was a disproportionate rise in accidents. There were many contributing factors, mostly among the budget carriers but affecting Garuda as well: an onrush of inexperienced pilots willing to work long hours for low pay; discouragement among mechanics, ramp workers and dispatchers; pressure to keep airplanes flying despite component failures that should have grounded them; the falsification of cargo and passenger manifests; dual maintenance and flight logs; and corruption permeating the entire system, including even air-traffic control.</p>\n<p class=\"css-exrw3m evys1bk0\">In Jakarta, a graybeard captain, speaking to me on the condition of anonymity, described the attitude of the new owners toward their pilots. He said: “The pilots passed the check ride! They can fly the airplanes!” Also, in some owners’ view, the semiannual simulator training is wasteful because the simulators are costly to run and maintain, and while the pilots are playing around in them (while collecting their pay), they are not out producing revenue. Normally two pilots train in a simulator at a time, with an instructor seated behind them — so, three in the box. I was told that in Indonesian simulators, there are sometimes seven in there: two pilots flying, one instructing and four others standing up and logging the time.</p>\n<p class=\"css-exrw3m evys1bk0\">One Indonesian newcomer was a low-cost airline called Adam Air, which was a Lion Air competitor for several years. Its disregard of safety ran the gamut and resulted in the dispatch of shabby airplanes in the hands of beleaguered pilots. (Former Adam Air employees could not be reached for comment.) Many pilots quit out of disgust or fear. I know how it feels, because as a young man I flew for fly-by-night cargo operators in the United States and suffered most of the survivable failures known to pilot-kind — engine failure, engine fire, electrical failure, electrical fire, radio failure, radar failure, pressurization failure, wing-flap failure, landing-gear failure, gyroscopic failure, airspeed-indication failure, altimeter failure, anti-ice failure, personal (girlfriend) failure, tail-tin-canning lightning-strike failure and trim failures at least four times. By trim failures, I mean runaway trims. Our mechanics laughed about “pencil whipping” the airplanes into the air, and we agreed that the paperwork was a joke. The F.A.A. inspected it and never caught on. But we carried only freight. One winter night, one of our pilots died. He was taken down by a de-icing failure over high terrain inbound to Los Angeles, and none of us were surprised.</p>\n<p class=\"css-exrw3m evys1bk0\">But Adam Air carried unwitting passengers. Its president director was a wealthy young man named Adam Suherman, who lived in Los Angeles for a few years. One day, he went back to Jakarta and, with the help of family money, started an airline. It began flying in December 2003. One of its 737s — an airplane that had been around the block for 18 years and was leased from Wells Fargo — was written up by pilots for recurring defects 154 times over the final three months of 2006. The number was high because the defects were not fixed. By far the largest number of defects was related to discrepancies between the airplane’s two independent inertial reference systems, navigational and flight instrumentation drivers that are important to the safe completion of a flight.</p>\n<p class=\"css-exrw3m evys1bk0\">Speaking about Adam Air, Dave Carbaugh, a former Boeing test pilot and one of the world’s top aviators, who trained airline pilots throughout Asia, told me: “They kept dispatching a faulty aircraft. Eventually they ran into a crew that couldn’t handle it.” <a class=\"css-1g7m0tk\" href=\"https://reports.aviation-safety.net/2007/20070101-0_B734_PK-KKW.pdf\">It happened</a> on New Year’s Day in 2007. While flying through an area of bad weather at 35,000 feet, the crew noticed discrepancies between the navigational systems; while fiddling with a solution, they switched off the autopilot unintentionally and drifted into a bank that turned into an uncontrolled spiral dive, during which the descent rate exceeded 50,000 feet per minute and the airplane approached the speed of sound before the captain pulled the wings off in flight. All 102 occupants died in terror.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-79elbk\"><div class=\"css-1a48zt4 ehw59r15\"><figure class=\"css-jcw7oy e1g7ppur0\"><div class=\"css-1xdhyk6 erfvjey0\">\n<span class=\"css-1ly73wi e1tej78p0\">Image</span><img alt=\"The cockpit voice recorder from Lion Air Flight 610 was recovered in January 2019, 11 weeks after the crash.\" class=\"css-1m50asq\" src=\"https://static01.nyt.com/images/2019/09/22/magazine/22-mag-boeing-05/22-mag-boeing-05-articleLarge.jpg?quality=75&amp;auto=webp&amp;disable=upscale\" srcset=\"https://static01.nyt.com/images/2019/09/22/magazine/22-mag-boeing-05/22-mag-boeing-05-articleLarge.jpg?quality=90&amp;auto=webp 600w, https://static01.nyt.com/images/2019/09/22/magazine/22-mag-boeing-05/22-mag-boeing-05-jumbo.jpg?quality=90&amp;auto=webp 1024w, https://static01.nyt.com/images/2019/09/22/magazine/22-mag-boeing-05/22-mag-boeing-05-superJumbo.jpg?quality=90&amp;auto=webp 2048w\" sizes=\"((min-width: 600px) and (max-width: 1004px)) 84vw, (min-width: 1005px) 60vw, 100vw\">\n</div>\n<figcaption class=\"css-1l44abu e1xdpqjp0\"><span class=\"css-i48y28 e13ogyst0\">The cockpit voice recorder from Lion Air Flight 610 was recovered in January 2019, 11 weeks after the crash.</span><span class=\"css-nt1l96 e1z0qqy90\"><span class=\"css-1ly73wi e1tej78p0\">Credit</span><span>Willy Kurniawa/Reuters</span></span></figcaption></figure></div></div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\"><p class=\"css-exrw3m evys1bk0\">Seven weeks later, another Adam Air 737 flew an erratic approach to the Surabaya airport among thunderstorms and made a landing so hard that <a class=\"css-1g7m0tk\" href=\"https://reports.aviation-safety.net/2007/20070221-0_B733_PK-KKV.pdf\">its fuselage cracked and was badly bent</a>, leaving the aft section drooping toward the pavement. No passengers were seriously injured, but the airplane had to be written off. The airline did not provide investigators with the identities of its pilots and was not forced to. Their training histories and qualifications therefore remain unknown. In 2008, Adam Air lost yet another 737 and was grounded by the Indonesian government. The airline declared bankruptcy and ceased operations. Adam Suherman faded from view. The more important point was that Adam Air no longer posed a threat to the flying public.</p></div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\"><strong class=\"css-8qgvsz ebyp5n10\">By 2007, Garuda,</strong> the national airline, had a notoriously bad safety record. Two weeks after Adam Air’s bent-airplane episode in Surabaya, a Garuda captain at the controls of a 737 bound for another airport on the island of Java allowed the airplane to get too high on the approach and tried to resolve the problem by pointing the nose down and diving at the runway despite the co-pilot’s calls to abort the approach and circle around. The captain got the airplane going so fast that when he called for flaps to configure for landing, the co-pilot did not dare extend them for fear of structural damage and did not communicate his doubts to the captain. Investigators later criticized the co-pilot for poor teamwork, specifically for not taking control of the airplane, but short of clubbing the captain into submission, there wasn’t much he could do. <a class=\"css-1g7m0tk\" href=\"https://www.nytimes.com/2007/03/08/world/asia/08indo.html?module=inline\">The airplane landed long</a>, touched down going 100 miles an hour too fast, bounced three times and went careering off the far end of the runway, slicing through an airport perimeter fence and sliding across a road, a ditch and an embankment before coming to rest in a rice paddy and bursting into flames. Because rescue vehicles could not cross the ditch, firefighters could not get their equipment close enough to suppress the flames effectively, and the fire burned for more than two hours. The captain and the co-pilot were not hurt, but 21 people died and others were severely injured.<br></p>\n<p class=\"css-exrw3m evys1bk0\">Garuda was the last straw. From 2003 to 2007, the Indonesian accident rate as measured by fatal flights per million departures had grown to be 15 times as high as the global average. The United States Embassy in Jakarta advised Americans to avoid travel on Indonesian airlines, though within Indonesia that was practically impossible to do. As usual, the numbers worked in favor of individual travelers: Even on the worst Indonesian airlines in the worst of times, the chances of being killed were minuscule. But for foreign governments that had become the self-anointed guardians of their citizens worldwide, the exposure was similar to that of the airplane manufacturers, though less consequential: Inevitably, accidents would continue to occur in Indonesia, and foreigners would die, and it would be hard for their officials to duck accountability unless the officials had registered concern in advance.</p>\n<p class=\"css-exrw3m evys1bk0\">In 2007, the European Union and the United States permanently banned all Indonesian airlines from their national territories. This was done for reasons of safety. The ban was largely symbolic, because the Indonesians were focused on their expanding regional markets and had no immediate plans to open such long-distance routes, but it signaled official disapproval of Indonesia’s regulatory capabilities and served as a public critique of a group of airlines, some of which were out of control. Residents of Europe and the United States generally did not know or care, but many of the ordinary Indonesians who had grown to hate their airlines were in favor of the ban simply as a form of punishment. Deregulation had transformed Indonesia into a complicated Wild East of flying, inhabited by consumers who were immune to prestige, just as Lion Air’s Kirana had predicted.</p>\n<p class=\"css-exrw3m evys1bk0\">The ban put Boeing and Airbus into a delicate position. They would now be selling airplanes to officially declared unsafe airlines that the American and European authorities expected would keep killing and injuring their passengers at a rate that would be unacceptable in the West. By 2007, the biggest of those airlines was Lion Air. That year, it placed a new order for 40 additional 737s, and Boeing happily agreed to fill it. In 2011, Lion Air returned to the table with what at the time was the largest commercial order in aviation history, <a class=\"css-1g7m0tk\" href=\"https://boeing.mediaroom.com/2011-11-17-Boeing-Lion-Air-Announce-Historic-Commitment-for-up-to-380-737s\">a $22 billion deal</a> for 230 units of the 737, including 201 units of the coming 737 Max. The deal was finalized during an Asean summit meeting in Bali that was attended by President Barack Obama. Photographs <a class=\"css-1g7m0tk\" href=\"https://www.cnn.com/2011/11/18/business/boeing-lion-air-indonesia-analysis/index.html\">show Obama</a> looking on approvingly as Kirana and a senior Boeing executive signed the contract. No mention was made in the associated news reports that Lion Air was considered to be a dangerous airline and that it was banned from the United States.</p>\n<p class=\"css-exrw3m evys1bk0\">Lion Air had been contributing to the casualties almost since its inception. By the time of the signing ceremony in Bali, it was responsible for 25 deaths, a larger number of injuries, five total hull losses and an unreported number of damaged airplanes. An old truth in aviation is that no pilot crashes an airplane who has not previously dinged an airplane somehow. Scratches and scrapes count. They are signs of a mind-set, and Lion Air had plenty of them, generally caused by rushed pushbacks from the gates in the company’s hurry to slap airplanes into the air. Kirana was once asked why Lion Air was experiencing so many accidents, and he answered sincerely that it was because of the large number of flights. Another question might have been why, despite so many crashes, the death toll was not higher. The answer was that all of Lion Air’s accidents happened during takeoffs and landings and therefore at relatively low speed, either on runways or in their immediate obstacle-free vicinities. These were the brief interludes when the airplanes were being flown by hand. The reason crashes never happened during other stages of flight is most likely that the autopilots were engaged.</p>\n<p class=\"css-exrw3m evys1bk0\">Boeing knew it had a problem. A widespread culture of corruption lay at the core, but that was beyond anyone’s ability to reform. Instead, Boeing decided to intervene at its own expense to raise standards at Lion Air and try to reduce its contributions to the accident rate. Both Boeing and Airbus had taken larger such actions before. Foremost were their epic interventions in China that gathered speed in the late 1980s and endured for years. At the start, civil aviation in China was a mess, with one of the highest accident rates in the world.</p>\n<p class=\"css-exrw3m evys1bk0\">Dave Carbaugh, the former Boeing test pilot, spent his first 10 years with the company traveling the globe to teach customers how to fly its airplanes. He mentioned the challenge of training pilots in Asia. “Those were the rote pilots,” he said, “the guys standing up in the back of a sim. They saw a runaway trim. They saw where and how it was handled in the curriculum — always on Sim Ride No. 3. And so on their Sim Ride No. 3, they handled it correctly, because they knew exactly when it was coming and what was going to happen. But did they get exposed anywhere else? Or did they discuss the issues involved? No. It was just a rote exercise. This is Step No. 25 of learning to fly a 737. Period.” I asked about China specifically. He said: “The Chinese? They were probably the worst.” He spent every other month in China for years. He said: “They saw flying from Beijing to Tianjin as 1,352 steps to do. Yet if they flew from Beijing to Guangzhou, it was 1,550 steps. And they didn’t connect the two. It would get so rote that they just wouldn’t deviate. I remember flying with a captain who would never divert no matter how many problems I gave him. I asked him, ‘How come?’ He said, ‘Because the checklist doesn’t say to divert.’ ”</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">That changed over time. With the support of the Chinese government, which went so far as to delegate some regulatory functions to foreigners like Carbaugh, the manufacturers were able to instill a rigorous approach to safety in a small cadre of pilots and managers, who in turn were able to instill it in others. The effort was made not out of the goodness of the manufacturers’ hearts, but out of calculations related to risk and self-preservation. It is widely seen to have been a success. Today the Chinese airlines are some of the safest in the world.</p>\n<p class=\"css-exrw3m evys1bk0\">This was the history that Boeing had in mind 10 years ago when it decided to intervene with Lion Air. Carbaugh said: “Boeing spent a shitpot full of money trying to bring those folks up to Western standards. We could only do so much, but we knew we had to try. It was an extraordinary effort.” But it was not good enough. Lion Air continued to crash airplanes around runways as it had before. The Indonesian authorities lacked the political will to rein that in. It is no secret that Rusdi Kirana prioritized efficiency over regulation. Recently he made it clear that he also resented Boeing as being presumptuous and typically condescending. “They look down on my airline and my country,” he told Reuters. “They treat us as third-world.”</p>\n<p class=\"css-exrw3m evys1bk0\"><strong class=\"css-8qgvsz ebyp5n10\">It was perhaps</strong> inevitable that the relationship between boeing and Lion Air would prove fractious. Boeing became the world’s pre-eminent commercial airplane manufacturer in part because it developed a coherent design philosophy that relied on pilots’ airmanship as the last line of defense. It made sense in an era when airplanes were vulnerable to weather and prone to failures and pilots intervened regularly to keep airplanes from crashing. By the 1980s, however, the situation had evolved. It became apparent that because of engineering improvements, very few accidents were caused by airplanes anymore, and almost all resulted from pilot error. This occurred at a time when airlines were being deregulated, discount carriers were springing up, major new markets were beginning to appear in developing countries, pilots’ unions were being busted, pilots’ salaries were in steep decline and airmanship globally was being eroded by an increasing reliance on cockpit automation, production-line training and a rote approach to flying.</p>\n<p class=\"css-exrw3m evys1bk0\">In the face of these changes, Boeing clung resolutely to its pilot-centric designs, but in Toulouse, France, the relative newcomers at the European consortium called Airbus were not nearly as shy. Led by an outspoken former military test pilot turned chief engineer named Bernard Ziegler, Airbus decided to take on Boeing by creating a robotic new airplane that would address the accelerating decline in airmanship and require minimal piloting skills largely by using digital flight controls to reduce pilot workload, iron out undesirable handling characteristics and build in pilot-proof protections against errors like aerodynamic stalls, excessive banks and spiral dives. The idea was that it would no longer be necessary to protect the public from airplanes if Airbus could get airplanes to protect themselves from pilots.</p>\n<p class=\"css-exrw3m evys1bk0\">The approach was diametrically opposed to Boeing’s. Ziegler announced that he was going to build an airplane that even his concierge could fly. The implicit insult won him the enmity of some French airline pilots, who then as now thought highly of themselves. Ziegler told me he received death threats and lived under police protection for a while. But his efforts led to the smartest airplane ever built, a single-aisle medium-range “fly-by-wire” masterpiece called the A320 that entered the global market in 1988, led the way to all other Airbus models since and has been locked into a seesaw battle with Boeing’s relatively conventional 737s for the past 30 years.</p>\n<p class=\"css-exrw3m evys1bk0\">You might think that the 737 would have grown increasingly disadvantaged given the New World qualities of the A320, but in my estimation pilots have managed to crash the 320 at about the same rate, largely because of confusion over automation. In other more positive ways, the 737 and A320 were closely matched: same payloads and performance, same operating costs, same potential for profit-making. That threatened to change in 2010 when Airbus introduced a version of the 320 called the Neo (for “new engine option”) that offered large improvements in fuel efficiency, range and payload. The following year, American Airlines warned that it might abandon Boeing and buy hundreds of the new Airbus models. Boeing responded with a rush program to re-engineer the 737, modify the wings and make other changes to improve the performance of the airplane and give it some perceptible advantage over the A320Neo.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class><div class=\"css-17dprlf\"><iframe src=\"https://www.nytimes.com/interactive/2019/admin/100000006719732.embedded.html?\" class=\"css-sqdgy8\" width=\"100%\"></iframe></div></div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\"><p class=\"css-exrw3m evys1bk0\">The rush took five years to complete. Boeing called the result the Max. To keep costs down, as with all previous iterations, the redesign had to lie within the original 1968 F.A.A. certification of the type and not be treated officially as a new airplane. Airbus had similar requirements for the Neo. In its marketing literature comparing the Max to the earlier Next-Generation 737, Boeing wrote: “same pilot type rating, same ground handling, same maintenance program, same flight simulators, same reliability.” Equally important was that it had to have the same flying characteristics. This was a regulatory necessity if the Max was to escape onerous reclassification as a new airplane. And there was a problem. Boeing test pilots discovered that the Max had unusual stall characteristics when the wing flaps were up and the engines were thrusting.</p></div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">Aerodynamic stalls are central to the Boeing 737 saga, so let’s explore them briefly now. Airplanes fly because their wings greet the oncoming air at a positive angle, known as an angle of attack. The faster an airplane flies, the lower the angle of attack needs to be to generate the necessary lift. Conversely, the slower an airplane flies, the greater the angle of attack needs to be. But at some point, the angle of attack becomes too great for the oncoming air to negotiate smoothly. As the airplane approaches that critical angle, the first event is a stall warning in the cockpit. In the 737, it is a rattling “stick shaker” that vibrates the control columns and is meant as an urgent warning to lower the nose. If the pilot does not respond, the airflow starts to boil across the top of the wings, sometimes causing buffets that shake the airplane, before separating from the wings conclusively at the moment of the stall. At that point, the wings’ effectiveness is hugely degraded, roll control becomes difficult and the nose drops unavoidably in what is known as a G-break, so called because it may be felt as a brief lessening of the normal (unaccelerated) 1-G pull of gravity.</p>\n<p class=\"css-exrw3m evys1bk0\">The nose drop can be drastic, typically about 30 degrees in a classic 737. Now fully stalled, the airplane enters into a precipitous, low-airspeed descent — a condition referred to as mushing that if left unattended will lead to a catastrophic impact with the ground. The event does not take long. In January 2015, when an Air France crew stalled a twin-aisle Airbus 330 on a night flight from Rio de Janeiro to Paris, the descent required merely three minutes and 30 seconds from 38,000 feet to the ocean’s surface. Start to finish, that was an exercise in poor airmanship. Investigators later determined that the Air France flight — a heavy jet stalling at absurdly high angles of attack — passed the point of possible recovery as it mushed down through 12,000 feet. After that, it was just as a co-pilot said before <a class=\"css-1g7m0tk\" href=\"https://www.bea.aero/docspa/2009/f-cp090601.en/pdf/f-cp090601.en.pdf\">pancaking into the Atlantic</a>: “[Expletive], we’re dead.”</p>\n<p class=\"css-exrw3m evys1bk0\">The Max’s stall characteristics, which indirectly bear on the accidents, have been widely reported as being an unusual tendency to pitch up when the airplane is flown at high angles of attack, in realms beyond the stick shaker where airline pilots never go. But pitching up into a stall is a characteristic of all jets with underslung engines, and the tendency in the Max, though slightly stronger than in previous 737s, was probably not sufficiently different to rouse the F.A.A. during the airplane’s testing and certification process. Rather, it was an entirely new characteristic that caused regulatory concern. During stall testing in the Max, the area of buffet was found to be unusually wide, and the G-break, when it occurred, was unusually mild. More important, within the buffet zone as the airplane approached the stall, the control forces — the necessary backpressure on the control column — did not increase in a conventional linear manner as they had in previous 737s and as certification standards required. As a mild behavioral quirk, this was a remote concern, and it occurred in an area of the flight envelope where airline pilots never go. But if the Max was to avoid designation as an entirely new model, the control-force problem needed to be addressed.</p>\n<p class=\"css-exrw3m evys1bk0\">Some at Boeing argued for an aerodynamic fix, but the modifications would have been slow and expensive, and Boeing was in a hurry. Its solution was to create synthetic control forces by cooking up a new automated system known as the MCAS to roll in a burst of double-speed nose-down stabilizer trim at just the right moment, calculated largely by angle of attack. There were two other conditions for MCAS activation: the wing flaps had to be up and the autopilot off. The logic of those conditions is clear, but not worth the digression here. After some initial tweaking, the system produced control forces that closely mimicked those of the earlier 737 models, allowing the Max to avoid onerous recertification. Indeed, on initial impulse the artificial forces were so realistic that Boeing convinced itself (and the F.A.A.) that there was no need to even introduce the MCAS to the airplane’s future pilots. The omission meant that the possibility of a false positive in cruising flight — a pushover occurring where it naturally would not — would likewise not be addressed. Boeing believed that in the worst case, a false positive would present as a mere runaway trim, a problem any pilot would know how to handle. The 737 features two prominent toggle switches on the center pedestal whose sole purpose is to deal with such an event — a pilot simply switches them off to disengage the electric trim. They are known as trim cutout switches. They are big and fat and right behind the throttles. There is not a 737 pilot in the world who is unaware of them. Boeing assumed that if necessary, 737 Max pilots would flip them much as previous generations of 737 pilots had. It would be at most a 30-second event. This turned out to be an obsolete assumption.</p>\n<p class=\"css-exrw3m evys1bk0\">It took several months and the slow and reluctant release of investigative findings before the inside story of the tragedy of Lion Air 610 could be told. That story actually starts three days before the accident, when the same airplane — under different flight numbers and Lion Air crews — experienced errors in airspeed and altitude indications on the captain’s (left side) flight display that weren’t properly addressed. Those indications are driven by a combination of sensors on the surface of the airplane. A set of independent duplicate sensors drive the co-pilot’s (right side) display. A third standby system provides additional independent backup and allows for intuitive troubleshooting when any one of the three systems fails: If two indications agree and the third one does not, the odd one out is obviously the one to ignore. This sort of arrangement helps to explain why flying a Boeing is not normally an intellectual challenge. Furthermore, the airplane provides an alert when airspeed or altitude indications disagree.</p>\n<p class=\"css-exrw3m evys1bk0\">All the faulty indications on that airplane were only ever on the captain’s side. The respective crews wrote them up repeatedly. During intervals on the ground, the airline’s technicians ran built-in tests, got coded responses and did plug-out plug-in reboot attempts of the mindless sort performed at automotive service centers. None of it worked here, but the technicians kept zeroing the fault messages and approving the airplane for flight. Two days before the final flight, the airplane was in Bali, and technicians did more of the same. Additionally, in response to an error message indicating possible failures in angle-of-attack information, they replaced the angle-of-attack vane on the nose of the airplane on the captain’s side. Angle-of-attack vanes are exposed to the winds and are vulnerable to impact, ice and wear. The replacement vane put onto this airplane in Bali was older than the airplane itself. It was a used part that had been provided by a shop in Miramar, Fla., and shipped to Lion Air one year before. In the maintenance log in Bali, the company technicians documented replacing the angle-of-attack vane and testing it. They wrote, “Installation test and heater test result good.”</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">I had some doubts whether these tests were really run, and I mentioned these doubts to John Goglia, a no-nonsense Bostonian who spent 35 years as an airline mechanic and an additional nine years as a board member of the competent crash-investigation unit of the United States government, the National Transportation Safety Board. Goglia has followed the investigations surrounding the 737 Max closely. Speaking of the Lion Air mechanics, he said: “They’re full of shit. They suspected they found the problem in Bali. So they replaced one problem with another — a dubious unit from Cockroach Corner in Miami. Cockroach Corner is the source of tons of suspected unapproved parts. Many of those repair stations in Miami are junk peddlers.” And the Lion Air mechanics? He said: “They didn’t finish, whatever the log says. They didn’t do an adequate check of the systems.” If they had, in Goglia’s view, they would have seen that the unit was faulty.</p>\n<p class=\"css-exrw3m evys1bk0\">According to the official narrative, which — discounting its omissions — seems to be mostly true, when a fresh crew arrived to take the next run, a night flight 600 miles west to Jakarta, a technician showed the new captain the maintenance log and explained that the angle-of-attack sensor on the left side had been replaced. The captain informed the co-pilot and said that he himself would do the flying. They would have a hitchhiker in the cockpit, sitting on the jump seat just behind them. He was an off-duty pilot and, according to one Indonesian pilot I spoke to, a 737 Max captain for a Lion Air subsidiary. For mysterious reasons, this man was not mentioned in subsequent Indonesian accounts. When I asked a senior investigator about the omission, he explained that it was because the investigators had been busy. Only recently and reluctantly have the Indonesians acknowledged the third pilot’s presence, though, as it happened, he played an important role.</p>\n<p class=\"css-exrw3m evys1bk0\">None of the Bali crew have been named, and access to them has been blocked. The airplane took off at 10:20 p.m. with 189 people aboard, or 190 if the ghost in the cockpit is included. Immediately after liftoff, the captain’s airspeed indication failed, airspeed-disagreement and altitude-disagreement warnings appeared on his flight display and his stick shaker began to rattle the controls in warning of an imminent stall.</p>\n<p class=\"css-exrw3m evys1bk0\">The Bali captain was enough of an airman to realize that he was dealing with an information failure only — not an actual stall. No direct mention has been made of this, but he must have immediately identified the replacement angle-of-attack vane on his side as the likely culprit. The co-pilot’s stick shaker had not activated. The second angle-of-attack sensor was functioning correctly. The captain held the airplane steady in the climb, confirmed that the right-side indications crosschecked with the standby instruments and transferred the flying to the co-pilot with instructions to follow a regular schedule of flap retractions and retrim the airplane as normal. The handoff was well done. The stick shaker continued to rattle, but that was merely an annoyance.</p>\n<p class=\"css-exrw3m evys1bk0\">But then there was a change. What had been an information failure suddenly turned into a flight-control one. Soon after the flaps were retracted, the airplane developed a mind of its own and rolled in a fast burst of nose-down trim. Apparently, this caused such a lurch that back in the cabin some passengers started praying. It was just the MCAS kicking in, because the three conditions necessary to trigger it had combined: The flaps were up, the autopilot was off and the captain’s angle-of-attack sensor was showing a stall.</p>\n<p class=\"css-exrw3m evys1bk0\">One of Boeing’s bewildering failures in the MCAS design is that despite the existence of two independent angle-of-attack sensors, the system did not require agreement between them to conclude that a stall had occurred. Inside the cockpit, none of the pilots knew any of this or had ever heard of the MCAS. To them the event must have looked like a runaway trim, much as Boeing had expected. But there were two differences that may have confused them. The first was the severity of the pitch-down trim, which ran twice as fast a regular runaway — hence the praying in the cabin. The second was that it lasted about only 10 seconds, then stopped for five seconds, then started again. The pattern repeated and would have kept repeating to the limits of nose-down trim, an extreme imbalance never approached in regular flight. This is another of Boeing’s bewildering failures — the implementation of an automated nose-down input meant to make for an authentic control feel but allowed to keep at it again and again while throwing the airplane wildly out of trim. No one I spoke to from Boeing, Airbus or the N.T.S.B. could explain the reasoning here.</p>\n<p class=\"css-exrw3m evys1bk0\">MCAS trimming can be thwarted and even overpowered by counter-trimming with the sustained use of the thumb switches on the control yokes, but in the confusion of the encounter in Bali, the counter-trimming went only so far. After three MCAS impulses, the co-pilot said that his control column had grown so heavy that he could hardly hold the nose up. They were about six minutes into the flight and still on the runway heading. The captain formally declared a condition of urgency by making a “pan-pan” call to air-traffic control. He reported an instrument failure and asked to continue flying straight ahead. The controller approved the request and asked if the crew wanted to return to the airport. The captain answered, “Stand by.” Over the next two minutes, while the co-pilot fought to maintain control of the airplane, the captain went wandering through the checklists trying to figure out what to do.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-79elbk\"><div class=\"css-1a48zt4 ehw59r15\"><figure class=\"css-jcw7oy e1g7ppur0\"><figcaption class=\"css-1l44abu e1xdpqjp0\"><span class=\"css-i48y28 e13ogyst0\">Ethiopian Airlines Flight 302 crashed near Addis Ababa in March 2019.</span><span class=\"css-nt1l96 e1z0qqy90\"><span class=\"css-1ly73wi e1tej78p0\">Credit</span><span>Michael Tewelde/Agence France-Press/Getty Images</span></span></figcaption></figure></div></div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">Finally the ghost in the jump seat intervened. It is impossible to know if he was a better airman than the pilots in the front or simply had the advantage of an overview. Either way, he recommended the obvious — shutting off the electric trim by flipping the cutout switches. The captain flipped the switches, the trim stopped running away and the MCAS was disabled. It was that easy.</p>\n<p class=\"css-exrw3m evys1bk0\">With the captain’s stick shaker continuing to rattle and the trim switches set to the off (cutout) position, the crew flew to Jakarta without further issue, adjusting trim as sometimes necessary by use of the manual trim wheels mounted on both sides of the central pedestal, and landed just before midnight. Investigators do not seem to have explored why the pilots required nearly five minutes to handle what normally might have been a 30-second adventure, or why they required a cockpit guest to provide the solution. Such questions were overshadowed by the subsequent failures of the accident crew on Flight 610.</p>\n<p class=\"css-exrw3m evys1bk0\">After pulling up to the gate in Jakarta, the Bali captain informed a company mechanic about “the aircraft problem” and in the maintenance log noted only three anomalies — the captain’s airspeed and altitude indication errors and the illumination of a warning light related to a system known as Feel Differential Pressure. That was it. Apparently the captain noted nothing about the failure of the newly installed angle-of-attack sensor, or the activation of the stick shaker, or the runaway trim, or the current position of the trim cutout switches. If true, it was hard to conclude anything other than that this was severe and grotesque negligence. Dave Carbaugh, the former Boeing test pilot, had the most charitable view of the matter. “I suspect that the pilot wrote what you see in the log, and he verbally told maintenance that, ‘Hey, the trim was running down, and we had to use the stabilizer cutout switches, and we flew the airplane back manually,’ ” he said. “And maintenance took no action on that, because the airplane had made it back to Jakarta. They just checked the fault messages and cleared them and called it a day. That’s my best guess. They were just hellbent to release that airplane.”</p>\n<p class=\"css-exrw3m evys1bk0\">According to the written record, the mechanics responded to the captain’s reports by flushing out a couple of air-data units, cleaning an electrical plug and declaring success after running some ground tests. Given the scope of the night’s events, the report was so off-base that I questioned whether any of the recorded maintenance had even taken place. I was not the only one with questions. John Goglia, with his vast knowledge, shared my concerns. Falsified maintenance records? They are as common as they are difficult to discern. One reason for them is that no one expects a pilot to go out and crash the next day. Goglia said: “They say they flushed the pitot-static in an 800-hour airplane? That’s a sure sign right there.” About the Bali crew, he said: “They pull up to the gate. They had a stick shaker. The No. 1 culprit is the angle-of-attack vane. But they don’t say anything? The trim switches are off. They leave the airplane. The next morning, the accident crew comes out. They go through the checklist. Those two switches are still off? They turn them on? What’s not known is who did that. The first officer? He didn’t know what he was doing? He didn’t tell the captain?”</p>\n<p class=\"css-exrw3m evys1bk0\">It is hard to believe that any pilot entering that cockpit could have been so sloppy. But one thing is obvious: Throughout the subsequent fatal flight, neither member of the accident crew gave those switches a thought.</p>\n<p class=\"css-exrw3m evys1bk0\"><strong class=\"css-8qgvsz ebyp5n10\">The Lion Air 610</strong> accident crew — Capt. Bhavye Suneja and his co-pilot, First Officer Harvino — arrived at the airport before dawn to prepare for the flight. Each had been through pro forma runaway-trim training in Lion Air simulators (hint: watch for it in Sim Ride No. 3), but they had never heard of the MCAS and had no way of guessing from the maintenance log that none of the airplane’s recent failures had been resolved, that some of the entries might have been fraudulent, that serious failures had occurred on the previous flight that had not been recorded or addressed or that the angle-of-attack sensor on the captain’s side was a slapped-on unit from Cockroach Corner that was 20 degrees out of whack. Instead, they thought they had a healthy airplane, and a nice new one, too.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">That much can be discerned by a close study of the flight data that have been parsed out, as well as from glimpses into the cockpit provided by certain summaries of the audio recordings. Suneja was at the controls. Everything seemed fine during the takeoff roll, but as soon as he hauled back on his control column and the airplane lifted off, the angle-of-attack sensor went haywire, the stick shaker began to rattle the left-side controls and Suneja lost reliable indications of airspeed and altitude on his flight display. In other words, the airplane misbehaved exactly as it had the night before. Once again, everything was fine on the co-pilot’s side. Suneja, however, did not turn the flying over to Harvino but retained it for himself, despite the vibrations of the controls in his hands.</p>\n<p class=\"css-exrw3m evys1bk0\">In the aftermath of the accident, it turned out that a warning light indicating disagreement between the two angle-of-attack sensors was absent from the airplane because it was being offered on the Max only as part of an optional angle-of-attack instrumentation package. On previous models, the light had come as standard equipment. The change was a result of an error somewhere in the bowels of Boeing. Critics have since loudly blamed it for the difficulty in countering the MCAS when the system receives false indications of a stall. But the truth is that the MCAS is easy to counter — just flip the famous switches to kill it. Furthermore, when you have a maintenance log that shows the replacement of an angle-of-attack sensor two days before and then you have an associated stick shaker rattling away while the other stick shaker remains quiet, you do not need an idiot light to tell you what is going on. At any rate, the recognition of an angle-of-attack disagreement — however pilots do or do not come to it — has no bearing on this accident, so we will move on.</p>\n<p class=\"css-exrw3m evys1bk0\">With the stick shaker sounding off, Suneja might have chosen to discontinue the trip and immediately return for a landing. Instead, two minutes after takeoff, Harvino asked air-traffic control for clearance to proceed to “some holding point” where he and Suneja could figure things out. The mood in the cockpit was calm. When Harvino mentioned a “flight-control problem,” he was wrong. They had a stick shaker sounding off and some unreliable indications, but the still-unknown MCAS had not yet engaged because the wing flaps remained extended. The only control problem they had was some hand-flown sloppiness from Suneja, who allowed a minor drift-down to occur before continuing with the climb.</p>\n<p class=\"css-exrw3m evys1bk0\">In reaction to the drift-down, the controller asked them what altitude they wanted, and Harvino opted for 5,000 feet. It was a poorly considered level that turned into a murderous one as the pilots tied themselves to it under circumstances that changed. I spoke to a heavy-jet pilot with global experience who said that had he been flying that 737, he would have scratched for all the altitude he could get — probably 20,000 feet — and after the first few vectors would have ignored air-traffic control and “pointed the damned airplane toward Nevada.” He meant he would have pared down to the essentials and sought to buy time.</p>\n<p class=\"css-exrw3m evys1bk0\">As the airplane climbed through 2,150 feet, Harvino retracted the wing flaps, and the MCAS kicked in for the first time, ambushing Suneja with its 10 seconds of double-fast nose-down trim and resulting in the 700-foot plunge seen on radar by the controller. Suneja countered by using his thumb switch to apply a burst of nose-up trim as he hauled back on the control column and returned the airplane to its climb. Adding to the workload, the controller chose this moment to issue the first needless turn and to formally clear the flight to 5,000 feet. Harvino dutifully responded. Suneja then ordered him to put the wing flaps back down to where they had been. It was the best move of the morning and seems to have been based on a rule of thumb that if you do something in a cockpit and are rewarded by some unwanted event, do not waste time wondering what the connection is — undo that something you just did.</p>\n<p class=\"css-exrw3m evys1bk0\">Suneja knew they had experienced some kind of runaway trim, but now with the flaps extended (and therefore with the unknown MCAS neutralized) it did not happen again. This would have been a good time to quit and go home. Instead, Suneja leveled at 5,000 and 30 seconds later ordered the flaps retracted. He may have made that choice because the airplane was flying at aerodynamic speeds in excess of 300 knots, which is not only fast for that altitude but also at least 50 knots faster than the maximum flap speed and enough to generate a loud overspeed clacker in the cockpit. He did not know about the MCAS, it’s true, but he had just experienced a violent runaway trim after flap retraction, and you might think he would have had the wherewithal to leave the flaps alone and throttle back to slow or, alternatively, pull into a climb to achieve the same result while also buying time. But no, he stuck obediently to 5,000 feet, left the throttles forward and retracted the flaps.</p>\n<p class=\"css-exrw3m evys1bk0\">This time he was ready when the MCAS engaged, and he managed to avoid a dive by counter-trimming and hanging tight. The surprise was that after the assault ended, the MCAS paused and came at him again and again. In the right seat, Harvino was fumbling through checklists with increasing desperation, trying to figure out which one might apply. Over in the left seat, Suneja was confronting a rabid dog. The MCAS was fast and relentless. Suneja could have disabled it at any time with the flip of the two trim cutout switches, but this apparently never came to mind, and he had no ghost in the jump seat to offer the advice. The fight continued for the next five minutes, during which time the MCAS mounted more than 20 attacks and began to prevail.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\"><p class=\"css-exrw3m evys1bk0\">As a reminder, the horizontal stabilizer is the large tail surface that can be angled down or up by the trimming mechanisms to change the airplane’s pitch; the “elevators” are the hinged control surfaces mounted behind it and are manipulated by the use of primary controls to adjust the pitch. Normally, these two movable surfaces function in agreement to the same end — nose-up elevator, nose-up trim; nose-down elevator, nose-down trim. But the relationship reverses with a runaway. In the unusual case in which a pilot does not switch off the electric trim, the elevator has to be used against the runaway stabilizer to keep an airplane from getting out of control. By certification standards, the elevator will succeed at this at all aerodynamic speeds up to the maximum, which, again, is approximately 340 knots in the 737. The catch is that as the airspeed increases, so does the power of the stabilizer in relation to the elevators. The slope becomes slippery toward the end. If an inattentive crew allows a runaway trim to drop the nose too far below the horizon and the crew reacts with full up elevator, the nose will rise as certification standards require, but it may remain below the horizon for a period sufficient to allow the airspeed to continue to increase and bust right through the maximum speed, at which point recovery becomes impossible if you don’t lay into the electric trim.</p></div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-79elbk\"><div class=\"css-1a48zt4 ehw59r15\"><figure class=\"css-jcw7oy e1g7ppur0\"><figcaption class=\"css-1l44abu e1xdpqjp0\"><span class=\"css-i48y28 e13ogyst0\">Relatives of Yared Getachew, a 29-year-old pilot who was the captain of Ethiopian Airlines Flight 302, at the crash site in March.</span><span class=\"css-nt1l96 e1z0qqy90\"><span class=\"css-1ly73wi e1tej78p0\">Credit</span><span>Jemal Countess/Getty Images</span></span></figcaption></figure></div></div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">The story is complicated because the counter-trim that Suneja had been thumbing to beat back the dog was working, and with greater effect at higher speeds, to the point that full nose-down trim would have been avoidable even if the cutout switches were not thrown, so long as the pilots stayed in the fight. But panic was growing in the cockpit. What little the Indonesian investigators have said about the voice recordings, they have described that much. The air-traffic control record shows the same. Suddenly it was the captain, Suneja, who was on the radio, and his transmissions made little sense. Apparently he had taken over the desperate search through the checklists and handed the flying to Harvino. This was a mistake, because Harvino was in no condition to fend off the MCAS attacks. He gave a few feeble inputs of nose-up trim with his thumb switch and began calling on God for a miracle. The MCAS ignored his entreaties and pitched the airplane into a steepening dive at airspeeds that quickly exceeded the engineered limits. Harvino stopped even trying to thumb the trim. Suneja hauled his control column all the way back, giving full up elevator to no avail. The nose dropped farther as the stabilizer prevailed. The crew of an offshore oil platform saw the airplane in a nearly vertical dive before it hit the water.</p>\n<p class=\"css-exrw3m evys1bk0\"><strong class=\"css-8qgvsz ebyp5n10\">The MCAS as</strong> it was designed and implemented was a big mistake. It remains unclear exactly what went wrong at Boeing — who decided what, and why — but a small collective breakdown had obviously occurred, and the F.A.A. had gone along for the ride. Nonetheless, the lethargy of the company’s initial response to the loss of Lion Air 610 seemed rooted less in fear or feelings of remorse than in genuine incredulity that these two pilots had been so incompetent as to plunge into the sea because of what amounted to a runaway trim. Eight days after the accident, <a class=\"css-1g7m0tk\" href=\"http://www.avioesemusicas.com/wp-content/uploads/2018/10/TBC-19-Uncommanded-Nose-Down-Stab-Trim-Due-to-AOA.pdf\">Boeing issued a worldwide bulletin </a>for 737 Max pilots in which it continued to avoid mention of the MCAS but emphasized longstanding procedures provided in the “Runaway Stabilizer Non Normal Checklist (NNC).” The company was willing to leave its communications to that. Privately, it would start working on a fix for the MCAS. Meanwhile, even after the accident, there still seemed to the company to be no reason to burden pilots with descriptions of the system.</p>\n<p class=\"css-exrw3m evys1bk0\">One day later, however, the F.A.A. repeated the same information in the form of <a class=\"css-1g7m0tk\" href=\"https://theaircurrent.com/wp-content/uploads/2018/11/B737-MAX-AD-1107.pdf\">an “Emergency Airworthiness Directive,”</a> a regulatory mandate to change the airplane’s flight manual. That same day, the Indonesians followed suit, as did the rest of the world. “Emergency” is a riveting word, and it provided the urgency that Boeing had lacked. Requests for information started flooding into Seattle. Two days later, Boeing finally came forward. Under the title “Boeing Correspondence: Multi Operator Messages,” it sent a two-paragraph email that named the MCAS for the first time.</p>\n<p class=\"css-exrw3m evys1bk0\">Events would soon show that the situation was far worse than Boeing realized — to the extent that disseminating full descriptions of the MCAS was not sufficient to keep another accident from happening. But for what it’s worth, if asked at the time, I would have agreed with the company. It seemed highly unlikely that Lion Air’s mistakes would be repeated anytime soon. In my own flying life, each of the four trim runaways I have experienced has been at most a 10-second problem — eight seconds to be surprised, and two seconds to flip the electric trim off. Who could be confused? When I mentioned this to Larry Rockliff, a former Canadian military and Airbus test pilot, he shrugged me off. “Look,” he said, “we know as a fact that half of airline pilots graduated in the bottom half of their class.”</p>\n<p class=\"css-exrw3m evys1bk0\">If only they were so easy to rank. Bernard Ziegler, the founding father of the Airbus fly-by-wire designs, once told me that the company ran tests and found that 90 percent of airline pilots believed that they could extract maximum performance from an airplane during emergency pull-ups away from the ground, but that only 10 percent actually could. Rockliff said, “More like 0.1 percent.” The Airbus answer was to automate the pull-ups and let computers do the job. Boeing’s answer was to continue to rely on pilots.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">This spring, I drove an hour west of the Jakarta airport to a compound known as Lion City. There, 2,500 flight attendants live in dormitories and batches of pilot recruits sit through up to six months of initial ground school before moving on to four to five months of flight training in Cessna 172s, followed by guaranteed jobs as co-pilots for the Lion Air Group. The pedagogical approach is that of a production line, with no accommodation for creativity or the unexpected. The tuition is $60,000. About 150 to 200 students pass through every year. The completion rate for the flight training is an astonishing 95 percent. When I asked how the completion rate could be so high, the head of training explained that it is because of aptitude testing at the start. For instance, applicants must have graduated from high school. In other words, when it comes to predicting the competence of its pilots, Lion Air has achieved the clairvoyance that has long eluded Boeing and Airbus, both of which have spent decades in that pursuit without finding good answers.</p>\n<p class=\"css-exrw3m evys1bk0\">At Lion City, I stood in front of a class of buzz-cut clean-shaven young recruits in white uniform shirts and narrow black neckties — the new checklist children of global aviation. At a loss for words, I said, “Congratulations.” Dutifully and in perfect unison they answered, “Thank you, sir.” The visit was an education for me. Boeing is aware of this academy and feeder facilities just like it all over the world. The situation is evidently grave. I left Lion City struck that Boeing has not reacted with greater urgency to the larger problems now faced.</p>\n<p class=\"css-exrw3m evys1bk0\"><strong class=\"css-8qgvsz ebyp5n10\">The second accident</strong> occurred when <a class=\"css-1g7m0tk\" href=\"https://leehamnews.com/wp-content/uploads/2019/04/Preliminary-Report-B737-800MAX-ET-AVJ.pdf\">Ethiopian Airlines Flight 302,</a> a 737 Max bound for Nairobi with 157 people aboard, hit the ground near Addis Ababa in a screaming dive. The airplane was captained by a 29-year-old pilot named Yared Getachew, who had graduated from the airline’s production-line academy 10 years before and had accumulated 8,122 hours of flight time. His co-pilot was a 25-year-old named Ahmed Nur Mohammod Nur, who had graduated from the academy just a few months before and had started serving as a 737 co-pilot when he had merely 154 hours of flight time. Since then, he had gained another 207 hours.</p>\n<p class=\"css-exrw3m evys1bk0\">Both men were aware of the Lion Air tragedy. They had been briefed on the MCAS system and knew the basics: that it provided repetitive 10-second bursts of nose-down trim, that it could be held at bay through vigorous use of the control yoke thumb switches to counter-trim, that it would not activate if the flaps were down or the autopilot was on, that it could be deactivated by shutting off the electric trim through use of the now-famous cutout switches on the center pedestal and that afterward the airplane could be trimmed using the manual trim wheel.</p>\n<p class=\"css-exrw3m evys1bk0\">The airplane rolled down the runway at 8:38 a.m. with a standard takeoff flap setting and Getachew at the controls. Immediately after liftoff, the angle-of-attack measurement on his side failed, setting off his stick shaker and distorting his indications of airspeed and altitude. It is not known why the angle-of-attack measurement failed. The vane on that side seemed to be the original unit. As in Indonesia, all indications on the co-pilot’s side were evidently correct because they crosschecked to the standby instruments and were not accompanied by a stick shaker. Airmanship 101. The situation was obvious enough for almost any pilot. Roughly one minute after takeoff and 1,000 feet above the ground, they engaged the autopilot on the captain’s side. The choice to use the captain’s side was strange because the instrument failure was clearly on that side, but the autopilot gracefully agreed to help. The airplane wobbled a bit, perhaps because the captain’s air data was confusing.</p>\n<p class=\"css-exrw3m evys1bk0\">A few seconds later, air-traffic control cleared the flight to 34,000 feet. Despite the troubles in the cockpit, the co-pilot, Mohammod, acknowledged the clearance, changed the autopilot mode, dialed in the target altitude and selected a climb airspeed of 238 knots, apparently because he was flying by rote. Similarly, Getachew took this moment to be really dumb: Despite the activation of his stick shaker and the likelihood that it related to erroneous angle-of-attack measurements on his side, despite knowing what had occurred in Indonesia, despite the information he had received about the MCAS and despite the need to return to the airport, he ordered Mohammod to raise the flaps. Mohammod did, and five seconds later the autopilot disengaged, perhaps because the captain’s indications became even more erratic than before. Getachew instructed Mohammod to advise air-traffic control that they were having flight-control problems, even though until then the only problem they had experienced was with instruments and their indications.</p>\n<p class=\"css-exrw3m evys1bk0\">Getachew had neglected to throttle back from the full takeoff thrust setting. And now the MCAS kicked in. It gave a nine-second nose-down burst that stopped the climb and forced the airplane into a slight descent. Because of the descent, a ground-proximity “DON’T SINK” warning sounded. Getachew pulled the nose up. The MCAS kicked in again. Three more ground-proximity warnings sounded. Getachew asked for help with the nose-up trim, a request that did not make sense because the dual use of electric thumb switches is no more powerful than a single use. Mohammod said: “Stab trim cutout! Stab trim cutout!” And Getachew concurred. Mohammod flipped the switches. That should have ended the story, but it didn’t.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">The airplane was now so far out of trim that Getachew had to hold his control column halfway back (meaning half up-elevator) to keep the nose from dropping. It was urgent to retrim the airplane using the manual trim wheel. But there was a big problem: The pilots had still not throttled back from takeoff thrust, and the airplane now in level flight was going extremely fast, at least 25 knots faster than the maximum operating speed of 340 knots, and was rapidly accelerating into realms beyond the flight-testing range. The excessive speed was amply clear in the cockpit, where an overspeed clacker was sounding off, but neither pilot thought to reduce the thrust and slow. The flight-data recorder later showed that the throttles remained at a takeoff setting until the end.</p>\n<p class=\"css-exrw3m evys1bk0\">The speed, meanwhile, was producing such large aerodynamic forces on the tail that the manual trim wheel lacked the mechanical power to overcome them, and the trim was essentially locked into the position where the MCAS had left it — not fully nose-down, but dangerously out of whack. The only way to retrim the airplane at these speeds would be to use the much more powerful electrohydraulic mechanism associated with the thumb switches, which, however, would require the pilots first to flip the cutout switches back to “normal,” exposing the airplane to further attacks from the MCAS.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-79elbk\"><div class=\"css-1a48zt4 ehw59r15\"><figure class=\"css-jcw7oy e1g7ppur0\"><figcaption class=\"css-1l44abu e1xdpqjp0\"><span class=\"css-i48y28 e13ogyst0\">The cockpit of a grounded Lion Air Boeing 737 Max in Indonesia.</span><span class=\"css-nt1l96 e1z0qqy90\"><span class=\"css-1ly73wi e1tej78p0\">Credit</span><span>Dimas Ardian/Bloomberg, via Getty Images</span></span></figcaption></figure></div></div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">But something slightly different occurred. On Getachew’s orders, Mohammod flipped the cutout switches to reactivate the electric trim, but apparently less to use the thumb switch — Getachew gave it only two halfhearted tries — than to activate the autopilot as a way of disabling the MCAS. The record shows four attempts in rapid succession to engage the autopilot, all of which were refused because autopilots are not recovery devices and will not engage if they sense pressures on the control column — meaning that an airplane is being flown out of trim.</p>\n<p class=\"css-exrw3m evys1bk0\">This airplane had heavy pressures on the controls — remember, Getachew was muscling his control column halfway back. Now, in apparent desperation to persuade the autopilot to engage, Getachew did the unthinkable and released his pressure on the control column. The column snapped forward, and the airplane responded by violently pitching down, 20 degrees below the horizon. Just then, with the stick shaker still rattling, the MCAS kicked in and achieved full nose-down trim, doubling the angle of the dive. As the speed shot through 450 knots, the pilots hauled back on their control columns to no effect. Six minutes after takeoff, the airplane hit the ground doing approximately 600 miles an hour. It buried itself into a 30-foot-deep crater in farmland about 32 miles southeast of the airport. Within a week, the Boeing 737 Max was grounded worldwide.</p>\n<p class=\"css-exrw3m evys1bk0\"><strong class=\"css-8qgvsz ebyp5n10\">The formal investigations</strong> <a class=\"css-1g7m0tk\" href=\"https://reports.aviation-safety.net/2018/20181029-0_B38M_PK-LQP_PRELIMINARY.pdf\">continue today</a>, and you might hope that their findings would lead to a more complete understanding of the accidents. Each appears to comply with guidelines laid out in a document known as Annex 13 that is disseminated by the International Civil Aviation Organization, a United Nations agency. Each is led by government officials of the countries where the airplanes crashed — Indonesia and Ethiopia — and joined, respectively, by Lion Air and Ethiopian Airlines, by Boeing as the airplane’s builder and by the N.T.S.B. as investigators from the country of the airplanes’ manufacture. Australian and French investigators have been involved, too.</p>\n<p class=\"css-exrw3m evys1bk0\">Knowledgeable observers, however, are skeptical that the investigations can proceed unimpeded. Dennis Jones, a retired N.T.S.B. investigator with a long career of international experience, suggested to me diplomatically that Annex 13 is a typical United Nations construct that does not necessarily accommodate national and political variations in intent to get at the truth no matter where it may lie. He was speaking specifically about Malaysia’s investigation into the mysterious disappearance of Flight 370, the Malaysia Airlines Boeing 777 lost in 2014, a case to which he was assigned. He came away from it impressed by some of the Malaysian investigators because of their efforts to explore the evidence despite powerful political constraints.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">The process in Jakarta has been similarly problematic. The official investigation is proceeding under the gaze of Lion Air’s founder, Rusdi Kirana, who has acquired political power and wealth. According to sources familiar with both investigations, Boeing and the N.T.S.B. have been largely excluded and denied access to such basic evidence as the complete flight-data recordings and the audio from the cockpit. A representative from the Indonesian investigation rebuts this claim and said that all parties have “access to all investigation data.” Important leads, meanwhile, are not being pursued, entire angles are being overlooked and the release of information to the public has been unusually restricted. This is occurring in a country where assumptions are widespread that regulators, investigators and reporters alike are on Lion Air’s payroll.</p>\n<p class=\"css-exrw3m evys1bk0\">This year, two New York Times reporters, Hannah Beech and Muktita Suhartono, spoke to a former investigator who said that after a previous Lion Air accident, an airline employee tried to hand him a black garbage bag full of cash. The surprise was that the investigator did not accept it. <a class=\"css-1g7m0tk\" href=\"https://www.nytimes.com/2019/03/21/world/asia/lion-air-crash-families-lawsuits.html?module=inline\">Beech and Suhartono wrote</a>: “Such payments from Lion Air were common because transportation-safety officials were poorly paid, former investigators said. A former high-level Lion Air employee confirmed that when he worked at the company, clandestine payments to government investigators, even for restaurants and prostitutes, were routine.” I admired the reporters’ restraint in their use of the past tense. It is not clear that anything has changed.</p>\n<p class=\"css-exrw3m evys1bk0\">In the case of the Ethiopian investigation, we have an airline and an investigative body that historically have not been able to isolate themselves from the country’s dysfunctional political life. Carbaugh mentioned to me that he was serving as Boeing’s chief pilot of safety in 2010 when an Ethiopian crew lost control of a 737 NG, the predecessor of the Max, killing all 90 people aboard. The airplane had just departed from Beirut. The subsequent investigation was led by a brilliant Lebanese airline pilot named Mohammed Aziz, who after nearly two years of obstructionism and obfuscations by the Ethiopians <a class=\"css-1g7m0tk\" href=\"https://www.bea.aero/docspa/2010/et-b100125.en/pdf/et-b100125.en.pdf\">produced a report</a> laying the blame squarely on the pilots, who had overshot assigned compass headings left and right, overbanked repeatedly, stalled twice and, for lack of airmanship, entered a lethal high-G spiral dive.</p>\n<p class=\"css-exrw3m evys1bk0\">The report was passed around for comment before publication. The French, Americans and Lebanese all agreed that it was complete. Ethiopia vociferously disagreed. Shortly before the report was to be released in 2012, Carbaugh stopped by Addis Ababa to demonstrate a new 787 Dreamliner, four of which the airline had ordered. He told me that a senior official from Ethiopian Airlines asked him to come to his office for a private talk. According to Carbaugh, the official said: “The report is coming out. Boeing has influence over the N.T.S.B. and the Lebanese. You need to get them to change the findings. They need to say that an Israeli shoot-down or a bomb was a possible cause of the accident.”</p>\n<p class=\"css-exrw3m evys1bk0\">Carbaugh told me that he answered: “Sir, here’s the data. Here’s what it says. Here’s what happened. Eyewitnesses who saw a flash, that was probably the landing lights coming out of the bottom of the clouds. There was no Israeli missile, no explosion, no lightning strike. That’s not what happened. The facts speak for themselves. Boeing works on behest of the N.T.S.B. on a technical basis. We don’t control the outcome.”</p>\n<p class=\"css-exrw3m evys1bk0\">The official was incredulous and mentioned the airline’s relationship with Boeing. He insisted that the report be changed.</p>\n<p class=\"css-exrw3m evys1bk0\">Carbaugh wasn’t going to argue. “We can’t,” he said.</p>\n<p class=\"css-exrw3m evys1bk0\">The Ethiopian Airlines Flight 302 investigation currently underway may look from a distance like an Annex 13 effort, but it is riddled with furtiveness and fear. One example can stand for much of the rest: After the cockpit voice recorder was dug out of the wreckage, it was shielded from the N.T.S.B. and whisked to Paris. There, for reasons unknown, French accident investigators agreed to download its contents in private onto a drive for an immediate return to Addis Ababa, where the information remains mostly locked away today and has been withheld in full form from any outside observers.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div>\n<div class=\"css-1fanzo5 StoryBodyCompanionColumn\">\n<div class=\"css-53u6y8\">\n<p class=\"css-exrw3m evys1bk0\">It is a forlorn hope, but you might wish that investigators like those in Indonesia and Ethiopia would someday have the self-confidence to pursue full and transparent investigations and release all the raw data associated with the accidents. When I mentioned this to Carbaugh, he said: “I think the information will never get released. Too damning. And if they don’t want to release the information, they won’t. And the U.N. and I.C.A.O. probably won’t have the gumption to demand that they do.” He thought for a moment and said, “Oh, they may do it years down the road, when nobody gives a shit anymore.” I said it is hard to believe that such a moment will come. Sounding resigned, if not fatigued, he said, “Yeah, but that’s the way it goes.”</p>\n<p class=\"css-exrw3m evys1bk0\"><strong class=\"css-8qgvsz ebyp5n10\">The 737 Max</strong> remains grounded under impossibly close scrutiny, and any suggestion that this might be an overreaction, or that ulterior motives might be at play, or that the Indonesian and Ethiopian investigations might be inadequate, is dismissed summarily. To top it off, while the technical fixes to the MCAS have been accomplished, other barely related imperfections have been discovered and added to the airplane’s woes. All signs are that the reintroduction of the 737 Max will be exceedingly difficult because of political and bureaucratic obstacles that are formidable and widespread. Who in a position of authority will say to the public that the airplane is safe?</p>\n<p class=\"css-exrw3m evys1bk0\">I would if I were in such a position. What we had in the two downed airplanes was a textbook failure of airmanship. In broad daylight, these pilots couldn’t decipher a variant of a simple runaway trim, and they ended up flying too fast at low altitude, neglecting to throttle back and leading their passengers over an aerodynamic edge into oblivion. They were the deciding factor here — not the MCAS, not the Max. Furthermore, it is certain that thousands of similar crews are at work around the world, enduring as rote pilots and apparently safe, but only so long as conditions are routine. Airbus has gone further than Boeing in acknowledging this reality with its robotic designs, though thereby, unintentionally, steepening the very decline it has tried to address. Boeing is aware of the decline, but until now — even after these two accidents — it has been reluctant to break with its traditional pilot-centric views. That needs to change, and someday it probably will; in the end Boeing will have no choice but to swallow its pride and follow the Airbus lead.</p>\n<p class=\"css-exrw3m evys1bk0\">These broader implications, however, have been lost in the noise. After President Trump weighed in on the basis of no perceptible knowledge, and the F.A.A. was forced to retreat from its initial defense of the airplane, Boeing had to accept a public onslaught. The onslaught has included congressional hearings, federal investigations, calls for the criminal prosecution of Boeing executives, revelations by whistle-blowers, attacks in the news media, the exploitation of personal tragedy and the construction of a whole new economic sector built around perceptions of the company’s liability. Boeing has grown largely silent, perhaps as much at the request of its sales force as of its lawyers. To point fingers at important clients would risk alienating not only those airlines but others who have been conditioned to buy its airplanes, no matter how incompetent their pilots may be.</p>\n</div>\n<aside class=\"css-o6xoe7\"></aside>\n</div></section><div class=\"bottom-of-article\"><div class=\"css-1yif149\">\n<p>William Langewiesche is a newly named writer at large for the magazine. He is a former national correspondent for The Atlantic and international correspondent for Vanity Fair, where he covered a wide variety of subjects throughout the world. He grew up in aviation and got his start as a pilot before turning to journalism. This is his first article for the magazine.</p> </div></div></article></div>",
    "url": "https://www.nytimes.com/2019/09/18/magazine/boeing-737-max-crashes.html",
    "published": "2019-09-18T09:00:03.000000Z",
    "created_at": "2019-09-24T21:41:49.738452Z",
    "original": null,
    "twitter_id": null,
    "twitter_thread_ids": [],
    "extracted_content_url": "https://extract.feedbin.com/parser/feedbin/2a7c534ca4fd85a6839c7ea3e5b70a511b842cff?base64_url=aHR0cHM6Ly93d3cubnl0aW1lcy5jb20vMjAxOS8wOS8xOC9tYWdhemluZS9ib2VpbmctNzM3LW1heC1jcmFzaGVzLmh0bWw=",
    "images": {
      "original_url": "https://static01.nyt.com/images/2019/09/22/magazine/22-mag-boeing-05/22-mag-boeing-05-articleLarge.jpg?quality=75&auto=webp&disable=upscale",
      "size_1": {
        "cdn_url": "https://images.feedbinusercontent.com/50a15f4/50a15f497e9ca9ca7fab5f1117796a34b7f2545d.jpg",
        "width": 542,
        "height": 304
      }
    },
    "enclosure": null,
    "extracted_articles": [],
    "json_feed": null
  }
]